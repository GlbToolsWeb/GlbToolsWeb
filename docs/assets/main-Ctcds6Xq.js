import"./style-6fJ1xWKc.js";const i=document.getElementById("atlas-form"),n=document.getElementById("status"),a=document.getElementById("submit-btn"),r=i.elements.models,y=document.getElementById("file-chips"),s=document.querySelector(".uploader"),L=document.getElementById("hero-upload");let m=null,l=null;function w(t){if(y.innerHTML="",!t.length){y.innerHTML='<span class="chip">No files selected</span>';return}Array.from(t).forEach(e=>{const o=document.createElement("span");o.className="chip",o.textContent=e.name,y.appendChild(o)})}function b(){m=null,a.type="submit",a.textContent="Generate Atlas",a.disabled=!1,a.onclick=null}L&&L.addEventListener("click",()=>r?.click());function T(t,e){m=t,a.type="button",a.disabled=!1,a.textContent="Download atlas GLB",a.onclick=()=>{if(!m)return;const o=document.createElement("a");o.href=m,o.download=e||"output.atlas.glb",o.click()}}["dragenter","dragover","dragleave","drop"].forEach(t=>{s.addEventListener(t,e=>{e.preventDefault(),e.stopPropagation()})});["dragenter","dragover"].forEach(t=>{s.addEventListener(t,()=>s.classList.add("dragover"))});["dragleave","drop"].forEach(t=>{s.addEventListener(t,()=>s.classList.remove("dragover"))});s.addEventListener("drop",t=>{const e=new DataTransfer;Array.from(t.dataTransfer.files||[]).forEach(o=>{o.name.toLowerCase().endsWith(".glb")&&e.items.add(o)}),e.files.length&&(r.files=e.files,w(r.files),b())});i.addEventListener("submit",async t=>{if(t.preventDefault(),n.className="status",n.textContent="",a.disabled=!0,a.textContent="Processing...",!r.files.length){n.textContent="Please choose at least one GLB file.",n.classList.add("error"),b();return}const e={},o=i.elements.maxSize;o&&o.value&&(e.maxSize=o.value),e.padding="0",e.texcoord="0",e.maxBins="1",e.resizeMode="downscale",e.resizeCeil="4096";const d=i.elements.formatAll?.value||"webp";e.formatBasecolor=d,e.formatNormal=d,e.formatOrm=d,e.formatEmissive=d;const u=i.elements.quality;u&&u.value&&(e.quality=u.value),e.maps=["baseColor","normal","orm","emissive"].join(",");try{l||(l=new Worker(new URL(""+new URL("atlas-worker-DrRBoXLv.js",import.meta.url).href,import.meta.url),{type:"module"}));const f=Array.from(r.files),c=await new Promise((p,g)=>{const v=setTimeout(()=>g(new Error("Worker timed out")),12e4);l.onmessage=E=>{clearTimeout(v);const{error:h,glb:A,layout:D}=E.data||{};if(h)return g(new Error(h));p({glb:A,layout:D})},l.onerror=E=>{clearTimeout(v),g(E)},l.postMessage({files:f,opts:e})}),B=Uint8Array.from(atob(c.glb),p=>p.charCodeAt(0)),C=new Blob([B],{type:"model/gltf-binary"}),x=URL.createObjectURL(C),k=(r.files[0].name.replace(/\.glb$/i,"")||"output")+".atlas.glb";n.textContent="Done.",n.classList.add("success"),T(x,k),c.layout&&(console.log("[atlas] layout",c.layout),window.atlasLayout=c.layout)}catch(f){n.textContent=`Error: ${f.message}`,n.classList.add("error"),b()}});r.addEventListener("change",()=>w(r.files));
