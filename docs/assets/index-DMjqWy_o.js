(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}})();const d=document.getElementById("atlas-form"),l=document.getElementById("status"),s=document.getElementById("submit-btn"),i=d.elements.models,h=document.getElementById("file-chips"),u=document.querySelector(".uploader"),v=document.getElementById("hero-upload"),w=document.getElementById("hero-learn"),B=document.getElementById("sticky-submit");let f=null,m=null;function C(t){if(h.innerHTML="",!t.length){h.innerHTML='<span class="chip">No files selected</span>';return}Array.from(t).forEach(e=>{const r=document.createElement("span");r.className="chip",r.textContent=e.name,h.appendChild(r)})}function E(){f=null,s.type="submit",s.textContent="Generate Atlas",s.disabled=!1,s.onclick=null}function P(t){t&&t.scrollIntoView&&t.scrollIntoView({behavior:"smooth",block:"start"})}v&&v.addEventListener("click",()=>i?.click());w&&w.addEventListener("click",()=>{const t=document.getElementById("how");P(t)});B&&B.addEventListener("click",()=>d?.requestSubmit());function S(t,e){f=t,s.type="button",s.disabled=!1,s.textContent="Download atlas GLB",s.onclick=()=>{if(!f)return;const r=document.createElement("a");r.href=f,r.download=e||"output.atlas.glb",r.click()}}["dragenter","dragover","dragleave","drop"].forEach(t=>{u.addEventListener(t,e=>{e.preventDefault(),e.stopPropagation()})});["dragenter","dragover"].forEach(t=>{u.addEventListener(t,()=>u.classList.add("dragover"))});["dragleave","drop"].forEach(t=>{u.addEventListener(t,()=>u.classList.remove("dragover"))});u.addEventListener("drop",t=>{const e=new DataTransfer;Array.from(t.dataTransfer.files||[]).forEach(r=>{r.name.toLowerCase().endsWith(".glb")&&e.items.add(r)}),e.files.length&&(i.files=e.files,C(i.files),E())});d.addEventListener("submit",async t=>{if(t.preventDefault(),l.className="status",l.textContent="",s.disabled=!0,s.textContent="Processing...",!i.files.length){l.textContent="Please choose at least one GLB file.",l.classList.add("error"),E();return}const e={},r=d.elements.maxSize;r&&r.value&&(e.maxSize=r.value),e.padding="0",e.texcoord="0",e.maxBins="1",e.resizeMode="downscale",e.resizeCeil="4096";const c=d.elements.formatAll?.value||"webp";e.formatBasecolor=c,e.formatNormal=c,e.formatOrm=c,e.formatEmissive=c;const o=d.elements.quality;o&&o.value&&(e.quality=o.value),e.maps=["baseColor","normal","orm","emissive"].join(",");try{m||(m=new Worker(new URL(""+new URL("atlas-worker-BVAFNBV4.js",import.meta.url).href,import.meta.url),{type:"module"}));const n=Array.from(i.files),a=await new Promise((p,g)=>{const b=setTimeout(()=>g(new Error("Worker timed out")),12e4);m.onmessage=y=>{clearTimeout(b);const{error:L,glb:N,layout:O}=y.data||{};if(L)return g(new Error(L));p({glb:N,layout:O})},m.onerror=y=>{clearTimeout(b),g(y)},m.postMessage({files:n,opts:e})}),x=Uint8Array.from(atob(a.glb),p=>p.charCodeAt(0)),I=new Blob([x],{type:"model/gltf-binary"}),k=URL.createObjectURL(I),A=(i.files[0].name.replace(/\.glb$/i,"")||"output")+".atlas.glb";l.textContent="Done.",l.classList.add("success"),S(k,A),a.layout&&(console.log("[atlas] layout",a.layout),window.atlasLayout=a.layout)}catch(n){l.textContent=`Error: ${n.message}`,l.classList.add("error"),E()}});i.addEventListener("change",()=>C(i.files));
