(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function o(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(t){if(t.ep)return;t.ep=!0;const n=o(t);fetch(t.href,n)}})();const m=document.getElementById("atlas-form"),l=document.getElementById("status"),s=document.getElementById("submit-btn"),i=m.elements.models,h=document.getElementById("file-chips"),d=document.querySelector(".uploader"),v=document.getElementById("hero-upload");let f=null,u=null;function w(r){if(h.innerHTML="",!r.length){h.innerHTML='<span class="chip">No files selected</span>';return}Array.from(r).forEach(e=>{const o=document.createElement("span");o.className="chip",o.textContent=e.name,h.appendChild(o)})}function E(){f=null,s.type="submit",s.textContent="Generate Atlas",s.disabled=!1,s.onclick=null}v&&v.addEventListener("click",()=>i?.click());function P(r,e){f=r,s.type="button",s.disabled=!1,s.textContent="Download atlas GLB",s.onclick=()=>{if(!f)return;const o=document.createElement("a");o.href=f,o.download=e||"output.atlas.glb",o.click()}}["dragenter","dragover","dragleave","drop"].forEach(r=>{d.addEventListener(r,e=>{e.preventDefault(),e.stopPropagation()})});["dragenter","dragover"].forEach(r=>{d.addEventListener(r,()=>d.classList.add("dragover"))});["dragleave","drop"].forEach(r=>{d.addEventListener(r,()=>d.classList.remove("dragover"))});d.addEventListener("drop",r=>{const e=new DataTransfer;Array.from(r.dataTransfer.files||[]).forEach(o=>{o.name.toLowerCase().endsWith(".glb")&&e.items.add(o)}),e.files.length&&(i.files=e.files,w(i.files),E())});m.addEventListener("submit",async r=>{if(r.preventDefault(),l.className="status",l.textContent="",s.disabled=!0,s.textContent="Processing...",!i.files.length){l.textContent="Please choose at least one GLB file.",l.classList.add("error"),E();return}const e={},o=m.elements.maxSize;o&&o.value&&(e.maxSize=o.value),e.padding="0",e.texcoord="0",e.maxBins="1",e.resizeMode="downscale",e.resizeCeil="4096";const c=m.elements.formatAll?.value||"webp";e.formatBasecolor=c,e.formatNormal=c,e.formatOrm=c,e.formatEmissive=c;const t=m.elements.quality;t&&t.value&&(e.quality=t.value),e.maps=["baseColor","normal","orm","emissive"].join(",");try{u||(u=new Worker(new URL(""+new URL("atlas-worker-BVAFNBV4.js",import.meta.url).href,import.meta.url),{type:"module"}));const n=Array.from(i.files),a=await new Promise((p,g)=>{const b=setTimeout(()=>g(new Error("Worker timed out")),12e4);u.onmessage=y=>{clearTimeout(b);const{error:L,glb:N,layout:O}=y.data||{};if(L)return g(new Error(L));p({glb:N,layout:O})},u.onerror=y=>{clearTimeout(b),g(y)},u.postMessage({files:n,opts:e})}),B=Uint8Array.from(atob(a.glb),p=>p.charCodeAt(0)),C=new Blob([B],{type:"model/gltf-binary"}),x=URL.createObjectURL(C),A=(i.files[0].name.replace(/\.glb$/i,"")||"output")+".atlas.glb";l.textContent="Done.",l.classList.add("success"),P(x,A),a.layout&&(console.log("[atlas] layout",a.layout),window.atlasLayout=a.layout)}catch(n){l.textContent=`Error: ${n.message}`,l.classList.add("error"),E()}});i.addEventListener("change",()=>w(i.files));
