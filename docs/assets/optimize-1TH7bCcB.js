import"./style-6fJ1xWKc.js";const s=document.getElementById("opt-form"),r=document.getElementById("status"),n=document.getElementById("submit-btn"),a=s.elements.model,f=document.getElementById("file-chip");let i=null;const l=s.querySelector(".uploader");["dragenter","dragover","dragleave","drop"].forEach(e=>{l.addEventListener(e,t=>{t.preventDefault(),t.stopPropagation()})});["dragenter","dragover"].forEach(e=>{l.addEventListener(e,()=>l.classList.add("dragover"))});["dragleave","drop"].forEach(e=>{l.addEventListener(e,()=>l.classList.remove("dragover"))});l.addEventListener("drop",e=>{const t=new DataTransfer;Array.from(e.dataTransfer.files||[]).forEach(o=>{o.name.toLowerCase().endsWith(".glb")&&t.items.add(o)}),t.files.length&&(a.files=t.files,E(a.files[0]),p())});function E(e){if(f.innerHTML="",!e){f.innerHTML='<span class="chip">No file selected</span>';return}const t=document.createElement("span");t.className="chip",t.textContent=e.name,f.appendChild(t)}function p(){n.type="submit",n.textContent="Optimize",n.disabled=!1,n.onclick=null}function z(e,t){n.type="button",n.disabled=!1,n.textContent="Download optimized GLB",n.onclick=()=>{const o=document.createElement("a");o.href=e,o.download=t||"optimized.glb",o.click()}}s.addEventListener("submit",async e=>{if(e.preventDefault(),r.className="status",r.textContent="",n.disabled=!0,n.textContent="Processing...",!a.files.length){r.textContent="Please choose a GLB file.",r.classList.add("error"),p();return}const t=s.elements.format?.value||"webp",o=s.elements.quality?.value||"85",h=s.elements.maxSize?.value||"4096",L={format:t,quality:o,maxSize:h};try{i||(i=new Worker(new URL(""+new URL("texture-optimizer-worker-e9E-he4F.js",import.meta.url).href,import.meta.url),{type:"module"}));const d=a.files[0],v=await new Promise((c,m)=>{const g=setTimeout(()=>m(new Error("Worker timed out")),12e4);i.onmessage=u=>{clearTimeout(g);const{error:b,glb:B}=u.data||{};if(b)return m(new Error(b));c({glb:B})},i.onerror=u=>{clearTimeout(g),m(u)},i.postMessage({file:d,opts:L})}),w=Uint8Array.from(atob(v.glb),c=>c.charCodeAt(0)),y=new Blob([w],{type:"model/gltf-binary"}),C=URL.createObjectURL(y),x=(d.name.replace(/\.glb$/i,"")||"optimized")+".optimized.glb";r.textContent="Done.",r.classList.add("success"),z(C,x)}catch(d){r.textContent=`Error: ${d.message}`,r.classList.add("error"),p()}});a.addEventListener("change",()=>E(a.files[0]));
