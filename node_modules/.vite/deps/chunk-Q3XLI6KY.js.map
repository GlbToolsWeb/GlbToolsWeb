{
  "version": 3,
  "sources": ["../../ktx-parse/src/constants.ts", "../../ktx-parse/src/create-default-container.ts", "../../ktx-parse/src/buffer-reader.ts", "../../ktx-parse/src/constants-internal.ts", "../../ktx-parse/src/util.ts", "../../ktx-parse/src/read.ts", "../../ktx-parse/src/write.ts", "../../@gltf-transform/extensions/src/constants.ts", "../../@gltf-transform/extensions/src/ext-mesh-gpu-instancing/instanced-mesh.ts", "../../@gltf-transform/extensions/src/ext-mesh-gpu-instancing/mesh-gpu-instancing.ts", "../../@gltf-transform/extensions/src/ext-meshopt-compression/constants.ts", "../../@gltf-transform/extensions/src/ext-meshopt-compression/decoder.ts", "../../@gltf-transform/extensions/src/ext-meshopt-compression/encoder.ts", "../../@gltf-transform/extensions/src/ext-meshopt-compression/meshopt-compression.ts", "../../@gltf-transform/extensions/src/ext-texture-avif/texture-avif.ts", "../../@gltf-transform/extensions/src/ext-texture-webp/texture-webp.ts", "../../@gltf-transform/extensions/src/khr-draco-mesh-compression/decoder.ts", "../../@gltf-transform/extensions/src/khr-draco-mesh-compression/encoder.ts", "../../@gltf-transform/extensions/src/khr-draco-mesh-compression/draco-mesh-compression.ts", "../../@gltf-transform/extensions/src/khr-lights-punctual/light.ts", "../../@gltf-transform/extensions/src/khr-lights-punctual/lights-punctual.ts", "../../@gltf-transform/extensions/src/khr-materials-anisotropy/anisotropy.ts", "../../@gltf-transform/extensions/src/khr-materials-anisotropy/materials-anisotropy.ts", "../../@gltf-transform/extensions/src/khr-materials-clearcoat/clearcoat.ts", "../../@gltf-transform/extensions/src/khr-materials-clearcoat/materials-clearcoat.ts", "../../@gltf-transform/extensions/src/khr-materials-diffuse-transmission/diffuse-transmission.ts", "../../@gltf-transform/extensions/src/khr-materials-diffuse-transmission/materials-diffuse-transmission.ts", "../../@gltf-transform/extensions/src/khr-materials-dispersion/dispersion.ts", "../../@gltf-transform/extensions/src/khr-materials-dispersion/materials-dispersion.ts", "../../@gltf-transform/extensions/src/khr-materials-emissive-strength/emissive-strength.ts", "../../@gltf-transform/extensions/src/khr-materials-emissive-strength/materials-emissive-strength.ts", "../../@gltf-transform/extensions/src/khr-materials-ior/ior.ts", "../../@gltf-transform/extensions/src/khr-materials-ior/materials-ior.ts", "../../@gltf-transform/extensions/src/khr-materials-iridescence/iridescence.ts", "../../@gltf-transform/extensions/src/khr-materials-iridescence/materials-iridescence.ts", "../../@gltf-transform/extensions/src/khr-materials-pbr-specular-glossiness/pbr-specular-glossiness.ts", "../../@gltf-transform/extensions/src/khr-materials-pbr-specular-glossiness/materials-pbr-specular-glossiness.ts", "../../@gltf-transform/extensions/src/khr-materials-sheen/sheen.ts", "../../@gltf-transform/extensions/src/khr-materials-sheen/materials-sheen.ts", "../../@gltf-transform/extensions/src/khr-materials-specular/specular.ts", "../../@gltf-transform/extensions/src/khr-materials-specular/materials-specular.ts", "../../@gltf-transform/extensions/src/khr-materials-transmission/transmission.ts", "../../@gltf-transform/extensions/src/khr-materials-transmission/materials-transmission.ts", "../../@gltf-transform/extensions/src/khr-materials-unlit/unlit.ts", "../../@gltf-transform/extensions/src/khr-materials-unlit/materials-unlit.ts", "../../@gltf-transform/extensions/src/khr-materials-variants/mapping.ts", "../../@gltf-transform/extensions/src/khr-materials-variants/mapping-list.ts", "../../@gltf-transform/extensions/src/khr-materials-variants/variant.ts", "../../@gltf-transform/extensions/src/khr-materials-variants/materials-variants.ts", "../../@gltf-transform/extensions/src/khr-materials-volume/volume.ts", "../../@gltf-transform/extensions/src/khr-materials-volume/materials-volume.ts", "../../@gltf-transform/extensions/src/khr-mesh-quantization/mesh-quantization.ts", "../../@gltf-transform/extensions/src/khr-texture-basisu/texture-basisu.ts", "../../@gltf-transform/extensions/src/khr-texture-transform/transform.ts", "../../@gltf-transform/extensions/src/khr-texture-transform/texture-transform.ts", "../../@gltf-transform/extensions/src/khr-xmp-json-ld/packet.ts", "../../@gltf-transform/extensions/src/khr-xmp-json-ld/xmp.ts", "../../@gltf-transform/extensions/src/index.ts"],
  "sourcesContent": ["///////////////////////////////////////////////////\n// KTX2 Header.\n///////////////////////////////////////////////////\n\nexport const KHR_SUPERCOMPRESSION_NONE = 0;\nexport const KHR_SUPERCOMPRESSION_BASISLZ = 1;\nexport const KHR_SUPERCOMPRESSION_ZSTD = 2;\nexport const KHR_SUPERCOMPRESSION_ZLIB = 3;\n\nexport type Supercompression =\n\t| typeof KHR_SUPERCOMPRESSION_NONE\n\t| typeof KHR_SUPERCOMPRESSION_BASISLZ\n\t| typeof KHR_SUPERCOMPRESSION_ZSTD\n\t| typeof KHR_SUPERCOMPRESSION_ZLIB;\n\n///////////////////////////////////////////////////\n// Data Format Descriptor (DFD).\n///////////////////////////////////////////////////\n\nexport const KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT = 0;\nexport const KHR_DF_VENDORID_KHRONOS = 0;\nexport const KHR_DF_VERSION = 2;\n\nexport const KHR_DF_MODEL_UNSPECIFIED = 0;\nexport const KHR_DF_MODEL_RGBSDA = 1;\n// ...\nexport const KHR_DF_MODEL_ETC1 = 160;\nexport const KHR_DF_MODEL_ETC2 = 161;\nexport const KHR_DF_MODEL_ASTC = 162;\nexport const KHR_DF_MODEL_ETC1S = 163;\nexport const KHR_DF_MODEL_UASTC = 166;\n\nexport const KHR_DF_FLAG_ALPHA_STRAIGHT = 0;\nexport const KHR_DF_FLAG_ALPHA_PREMULTIPLIED = 1;\n\nexport const KHR_DF_TRANSFER_UNSPECIFIED = 0;\nexport const KHR_DF_TRANSFER_LINEAR = 1;\nexport const KHR_DF_TRANSFER_SRGB = 2;\nexport const KHR_DF_TRANSFER_ITU = 3;\nexport const KHR_DF_TRANSFER_NTSC = 4;\nexport const KHR_DF_TRANSFER_SLOG = 5;\nexport const KHR_DF_TRANSFER_SLOG2 = 6;\nexport const KHR_DF_TRANSFER_BT1886 = 7;\nexport const KHR_DF_TRANSFER_HLG_OETF = 8;\nexport const KHR_DF_TRANSFER_HLG_EOTF = 9;\nexport const KHR_DF_TRANSFER_PQ_EOTF = 10;\nexport const KHR_DF_TRANSFER_PQ_OETF = 11;\nexport const KHR_DF_TRANSFER_DCIP3 = 12;\nexport const KHR_DF_TRANSFER_PAL_OETF = 13;\nexport const KHR_DF_TRANSFER_PAL625_EOTF = 14;\nexport const KHR_DF_TRANSFER_ST240 = 15;\nexport const KHR_DF_TRANSFER_ACESCC = 16;\nexport const KHR_DF_TRANSFER_ACESCCT = 17;\nexport const KHR_DF_TRANSFER_ADOBERGB = 18;\n\nexport type Transfer =\n\t| typeof KHR_DF_TRANSFER_UNSPECIFIED\n\t| typeof KHR_DF_TRANSFER_LINEAR\n\t| typeof KHR_DF_TRANSFER_SRGB\n\t| typeof KHR_DF_TRANSFER_ITU\n\t| typeof KHR_DF_TRANSFER_NTSC\n\t| typeof KHR_DF_TRANSFER_SLOG\n\t| typeof KHR_DF_TRANSFER_SLOG2\n\t| typeof KHR_DF_TRANSFER_BT1886\n\t| typeof KHR_DF_TRANSFER_HLG_OETF\n\t| typeof KHR_DF_TRANSFER_HLG_EOTF\n\t| typeof KHR_DF_TRANSFER_PQ_EOTF\n\t| typeof KHR_DF_TRANSFER_PQ_OETF\n\t| typeof KHR_DF_TRANSFER_DCIP3\n\t| typeof KHR_DF_TRANSFER_PAL_OETF\n\t| typeof KHR_DF_TRANSFER_PAL625_EOTF\n\t| typeof KHR_DF_TRANSFER_ST240\n\t| typeof KHR_DF_TRANSFER_ACESCC\n\t| typeof KHR_DF_TRANSFER_ACESCCT\n\t| typeof KHR_DF_TRANSFER_ADOBERGB;\n\nexport const KHR_DF_PRIMARIES_UNSPECIFIED = 0;\nexport const KHR_DF_PRIMARIES_BT709 = 1;\nexport const KHR_DF_PRIMARIES_BT601_EBU = 2;\nexport const KHR_DF_PRIMARIES_BT601_SMPTE = 3;\nexport const KHR_DF_PRIMARIES_BT2020 = 4;\nexport const KHR_DF_PRIMARIES_CIEXYZ = 5;\nexport const KHR_DF_PRIMARIES_ACES = 6;\nexport const KHR_DF_PRIMARIES_ACESCC = 7;\nexport const KHR_DF_PRIMARIES_NTSC1953 = 8;\nexport const KHR_DF_PRIMARIES_PAL525 = 9;\nexport const KHR_DF_PRIMARIES_DISPLAYP3 = 10;\nexport const KHR_DF_PRIMARIES_ADOBERGB = 11;\n\nexport type Primaries =\n\t| typeof KHR_DF_PRIMARIES_UNSPECIFIED\n\t| typeof KHR_DF_PRIMARIES_BT709\n\t| typeof KHR_DF_PRIMARIES_BT601_EBU\n\t| typeof KHR_DF_PRIMARIES_BT601_SMPTE\n\t| typeof KHR_DF_PRIMARIES_BT2020\n\t| typeof KHR_DF_PRIMARIES_CIEXYZ\n\t| typeof KHR_DF_PRIMARIES_ACES\n\t| typeof KHR_DF_PRIMARIES_ACESCC\n\t| typeof KHR_DF_PRIMARIES_NTSC1953\n\t| typeof KHR_DF_PRIMARIES_PAL525\n\t| typeof KHR_DF_PRIMARIES_DISPLAYP3\n\t| typeof KHR_DF_PRIMARIES_ADOBERGB;\n\nexport const KHR_DF_CHANNEL_RGBSDA_RED = 0;\nexport const KHR_DF_CHANNEL_RGBSDA_GREEN = 1;\nexport const KHR_DF_CHANNEL_RGBSDA_BLUE = 2;\nexport const KHR_DF_CHANNEL_RGBSDA_STENCIL = 13;\nexport const KHR_DF_CHANNEL_RGBSDA_DEPTH = 14;\nexport const KHR_DF_CHANNEL_RGBSDA_ALPHA = 15;\n\nexport type Channel =\n\t| typeof KHR_DF_CHANNEL_RGBSDA_RED\n\t| typeof KHR_DF_CHANNEL_RGBSDA_GREEN\n\t| typeof KHR_DF_CHANNEL_RGBSDA_BLUE\n\t| typeof KHR_DF_CHANNEL_RGBSDA_STENCIL\n\t| typeof KHR_DF_CHANNEL_RGBSDA_DEPTH\n\t| typeof KHR_DF_CHANNEL_RGBSDA_ALPHA;\n\nexport const KHR_DF_SAMPLE_DATATYPE_FLOAT = 0x80;\nexport const KHR_DF_SAMPLE_DATATYPE_SIGNED = 0x40;\nexport const KHR_DF_SAMPLE_DATATYPE_EXPONENT = 0x20;\nexport const KHR_DF_SAMPLE_DATATYPE_LINEAR = 0x10;\n\nexport type SampleDatatype =\n\t| typeof KHR_DF_SAMPLE_DATATYPE_FLOAT\n\t| typeof KHR_DF_SAMPLE_DATATYPE_SIGNED\n\t| typeof KHR_DF_SAMPLE_DATATYPE_EXPONENT\n\t| typeof KHR_DF_SAMPLE_DATATYPE_LINEAR;\n\n///////////////////////////////////////////////////\n// VK FORMAT.\n///////////////////////////////////////////////////\n\nexport const VK_FORMAT_UNDEFINED = 0;\nexport const VK_FORMAT_R4G4_UNORM_PACK8 = 1;\nexport const VK_FORMAT_R4G4B4A4_UNORM_PACK16 = 2;\nexport const VK_FORMAT_B4G4R4A4_UNORM_PACK16 = 3;\nexport const VK_FORMAT_R5G6B5_UNORM_PACK16 = 4;\nexport const VK_FORMAT_B5G6R5_UNORM_PACK16 = 5;\nexport const VK_FORMAT_R5G5B5A1_UNORM_PACK16 = 6;\nexport const VK_FORMAT_B5G5R5A1_UNORM_PACK16 = 7;\nexport const VK_FORMAT_A1R5G5B5_UNORM_PACK16 = 8;\nexport const VK_FORMAT_R8_UNORM = 9;\nexport const VK_FORMAT_R8_SNORM = 10;\nexport const VK_FORMAT_R8_UINT = 13;\nexport const VK_FORMAT_R8_SINT = 14;\nexport const VK_FORMAT_R8_SRGB = 15;\nexport const VK_FORMAT_R8G8_UNORM = 16;\nexport const VK_FORMAT_R8G8_SNORM = 17;\nexport const VK_FORMAT_R8G8_UINT = 20;\nexport const VK_FORMAT_R8G8_SINT = 21;\nexport const VK_FORMAT_R8G8_SRGB = 22;\nexport const VK_FORMAT_R8G8B8_UNORM = 23;\nexport const VK_FORMAT_R8G8B8_SNORM = 24;\nexport const VK_FORMAT_R8G8B8_UINT = 27;\nexport const VK_FORMAT_R8G8B8_SINT = 28;\nexport const VK_FORMAT_R8G8B8_SRGB = 29;\nexport const VK_FORMAT_B8G8R8_UNORM = 30;\nexport const VK_FORMAT_B8G8R8_SNORM = 31;\nexport const VK_FORMAT_B8G8R8_UINT = 34;\nexport const VK_FORMAT_B8G8R8_SINT = 35;\nexport const VK_FORMAT_B8G8R8_SRGB = 36;\nexport const VK_FORMAT_R8G8B8A8_UNORM = 37;\nexport const VK_FORMAT_R8G8B8A8_SNORM = 38;\nexport const VK_FORMAT_R8G8B8A8_UINT = 41;\nexport const VK_FORMAT_R8G8B8A8_SINT = 42;\nexport const VK_FORMAT_R8G8B8A8_SRGB = 43;\nexport const VK_FORMAT_B8G8R8A8_UNORM = 44;\nexport const VK_FORMAT_B8G8R8A8_SNORM = 45;\nexport const VK_FORMAT_B8G8R8A8_UINT = 48;\nexport const VK_FORMAT_B8G8R8A8_SINT = 49;\nexport const VK_FORMAT_B8G8R8A8_SRGB = 50;\nexport const VK_FORMAT_A2R10G10B10_UNORM_PACK32 = 58;\nexport const VK_FORMAT_A2R10G10B10_SNORM_PACK32 = 59;\nexport const VK_FORMAT_A2R10G10B10_UINT_PACK32 = 62;\nexport const VK_FORMAT_A2R10G10B10_SINT_PACK32 = 63;\nexport const VK_FORMAT_A2B10G10R10_UNORM_PACK32 = 64;\nexport const VK_FORMAT_A2B10G10R10_SNORM_PACK32 = 65;\nexport const VK_FORMAT_A2B10G10R10_UINT_PACK32 = 68;\nexport const VK_FORMAT_A2B10G10R10_SINT_PACK32 = 69;\nexport const VK_FORMAT_R16_UNORM = 70;\nexport const VK_FORMAT_R16_SNORM = 71;\nexport const VK_FORMAT_R16_UINT = 74;\nexport const VK_FORMAT_R16_SINT = 75;\nexport const VK_FORMAT_R16_SFLOAT = 76;\nexport const VK_FORMAT_R16G16_UNORM = 77;\nexport const VK_FORMAT_R16G16_SNORM = 78;\nexport const VK_FORMAT_R16G16_UINT = 81;\nexport const VK_FORMAT_R16G16_SINT = 82;\nexport const VK_FORMAT_R16G16_SFLOAT = 83;\nexport const VK_FORMAT_R16G16B16_UNORM = 84;\nexport const VK_FORMAT_R16G16B16_SNORM = 85;\nexport const VK_FORMAT_R16G16B16_UINT = 88;\nexport const VK_FORMAT_R16G16B16_SINT = 89;\nexport const VK_FORMAT_R16G16B16_SFLOAT = 90;\nexport const VK_FORMAT_R16G16B16A16_UNORM = 91;\nexport const VK_FORMAT_R16G16B16A16_SNORM = 92;\nexport const VK_FORMAT_R16G16B16A16_UINT = 95;\nexport const VK_FORMAT_R16G16B16A16_SINT = 96;\nexport const VK_FORMAT_R16G16B16A16_SFLOAT = 97;\nexport const VK_FORMAT_R32_UINT = 98;\nexport const VK_FORMAT_R32_SINT = 99;\nexport const VK_FORMAT_R32_SFLOAT = 100;\nexport const VK_FORMAT_R32G32_UINT = 101;\nexport const VK_FORMAT_R32G32_SINT = 102;\nexport const VK_FORMAT_R32G32_SFLOAT = 103;\nexport const VK_FORMAT_R32G32B32_UINT = 104;\nexport const VK_FORMAT_R32G32B32_SINT = 105;\nexport const VK_FORMAT_R32G32B32_SFLOAT = 106;\nexport const VK_FORMAT_R32G32B32A32_UINT = 107;\nexport const VK_FORMAT_R32G32B32A32_SINT = 108;\nexport const VK_FORMAT_R32G32B32A32_SFLOAT = 109;\nexport const VK_FORMAT_R64_UINT = 110;\nexport const VK_FORMAT_R64_SINT = 111;\nexport const VK_FORMAT_R64_SFLOAT = 112;\nexport const VK_FORMAT_R64G64_UINT = 113;\nexport const VK_FORMAT_R64G64_SINT = 114;\nexport const VK_FORMAT_R64G64_SFLOAT = 115;\nexport const VK_FORMAT_R64G64B64_UINT = 116;\nexport const VK_FORMAT_R64G64B64_SINT = 117;\nexport const VK_FORMAT_R64G64B64_SFLOAT = 118;\nexport const VK_FORMAT_R64G64B64A64_UINT = 119;\nexport const VK_FORMAT_R64G64B64A64_SINT = 120;\nexport const VK_FORMAT_R64G64B64A64_SFLOAT = 121;\nexport const VK_FORMAT_B10G11R11_UFLOAT_PACK32 = 122;\nexport const VK_FORMAT_E5B9G9R9_UFLOAT_PACK32 = 123;\nexport const VK_FORMAT_D16_UNORM = 124;\nexport const VK_FORMAT_X8_D24_UNORM_PACK32 = 125;\nexport const VK_FORMAT_D32_SFLOAT = 126;\nexport const VK_FORMAT_S8_UINT = 127;\nexport const VK_FORMAT_D16_UNORM_S8_UINT = 128;\nexport const VK_FORMAT_D24_UNORM_S8_UINT = 129;\nexport const VK_FORMAT_D32_SFLOAT_S8_UINT = 130;\nexport const VK_FORMAT_BC1_RGB_UNORM_BLOCK = 131;\nexport const VK_FORMAT_BC1_RGB_SRGB_BLOCK = 132;\nexport const VK_FORMAT_BC1_RGBA_UNORM_BLOCK = 133;\nexport const VK_FORMAT_BC1_RGBA_SRGB_BLOCK = 134;\nexport const VK_FORMAT_BC2_UNORM_BLOCK = 135;\nexport const VK_FORMAT_BC2_SRGB_BLOCK = 136;\nexport const VK_FORMAT_BC3_UNORM_BLOCK = 137;\nexport const VK_FORMAT_BC3_SRGB_BLOCK = 138;\nexport const VK_FORMAT_BC4_UNORM_BLOCK = 139;\nexport const VK_FORMAT_BC4_SNORM_BLOCK = 140;\nexport const VK_FORMAT_BC5_UNORM_BLOCK = 141;\nexport const VK_FORMAT_BC5_SNORM_BLOCK = 142;\nexport const VK_FORMAT_BC6H_UFLOAT_BLOCK = 143;\nexport const VK_FORMAT_BC6H_SFLOAT_BLOCK = 144;\nexport const VK_FORMAT_BC7_UNORM_BLOCK = 145;\nexport const VK_FORMAT_BC7_SRGB_BLOCK = 146;\nexport const VK_FORMAT_ETC2_R8G8B8_UNORM_BLOCK = 147;\nexport const VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK = 148;\nexport const VK_FORMAT_ETC2_R8G8B8A1_UNORM_BLOCK = 149;\nexport const VK_FORMAT_ETC2_R8G8B8A1_SRGB_BLOCK = 150;\nexport const VK_FORMAT_ETC2_R8G8B8A8_UNORM_BLOCK = 151;\nexport const VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK = 152;\nexport const VK_FORMAT_EAC_R11_UNORM_BLOCK = 153;\nexport const VK_FORMAT_EAC_R11_SNORM_BLOCK = 154;\nexport const VK_FORMAT_EAC_R11G11_UNORM_BLOCK = 155;\nexport const VK_FORMAT_EAC_R11G11_SNORM_BLOCK = 156;\nexport const VK_FORMAT_ASTC_4x4_UNORM_BLOCK = 157;\nexport const VK_FORMAT_ASTC_4x4_SRGB_BLOCK = 158;\nexport const VK_FORMAT_ASTC_5x4_UNORM_BLOCK = 159;\nexport const VK_FORMAT_ASTC_5x4_SRGB_BLOCK = 160;\nexport const VK_FORMAT_ASTC_5x5_UNORM_BLOCK = 161;\nexport const VK_FORMAT_ASTC_5x5_SRGB_BLOCK = 162;\nexport const VK_FORMAT_ASTC_6x5_UNORM_BLOCK = 163;\nexport const VK_FORMAT_ASTC_6x5_SRGB_BLOCK = 164;\nexport const VK_FORMAT_ASTC_6x6_UNORM_BLOCK = 165;\nexport const VK_FORMAT_ASTC_6x6_SRGB_BLOCK = 166;\nexport const VK_FORMAT_ASTC_8x5_UNORM_BLOCK = 167;\nexport const VK_FORMAT_ASTC_8x5_SRGB_BLOCK = 168;\nexport const VK_FORMAT_ASTC_8x6_UNORM_BLOCK = 169;\nexport const VK_FORMAT_ASTC_8x6_SRGB_BLOCK = 170;\nexport const VK_FORMAT_ASTC_8x8_UNORM_BLOCK = 171;\nexport const VK_FORMAT_ASTC_8x8_SRGB_BLOCK = 172;\nexport const VK_FORMAT_ASTC_10x5_UNORM_BLOCK = 173;\nexport const VK_FORMAT_ASTC_10x5_SRGB_BLOCK = 174;\nexport const VK_FORMAT_ASTC_10x6_UNORM_BLOCK = 175;\nexport const VK_FORMAT_ASTC_10x6_SRGB_BLOCK = 176;\nexport const VK_FORMAT_ASTC_10x8_UNORM_BLOCK = 177;\nexport const VK_FORMAT_ASTC_10x8_SRGB_BLOCK = 178;\nexport const VK_FORMAT_ASTC_10x10_UNORM_BLOCK = 179;\nexport const VK_FORMAT_ASTC_10x10_SRGB_BLOCK = 180;\nexport const VK_FORMAT_ASTC_12x10_UNORM_BLOCK = 181;\nexport const VK_FORMAT_ASTC_12x10_SRGB_BLOCK = 182;\nexport const VK_FORMAT_ASTC_12x12_UNORM_BLOCK = 183;\nexport const VK_FORMAT_ASTC_12x12_SRGB_BLOCK = 184;\nexport const VK_FORMAT_R10X6_UNORM_PACK16 = 1000156007;\nexport const VK_FORMAT_R10X6G10X6_UNORM_2PACK16 = 1000156008;\nexport const VK_FORMAT_R10X6G10X6B10X6A10X6_UNORM_4PACK16 = 1000156009;\nexport const VK_FORMAT_G10X6B10X6G10X6R10X6_422_UNORM_4PACK16 = 1000156010;\nexport const VK_FORMAT_B10X6G10X6R10X6G10X6_422_UNORM_4PACK16 = 1000156011;\nexport const VK_FORMAT_R12X4_UNORM_PACK16 = 1000156017;\nexport const VK_FORMAT_R12X4G12X4_UNORM_2PACK16 = 1000156018;\nexport const VK_FORMAT_R12X4G12X4B12X4A12X4_UNORM_4PACK16 = 1000156019;\nexport const VK_FORMAT_G12X4B12X4G12X4R12X4_422_UNORM_4PACK16 = 1000156020;\nexport const VK_FORMAT_B12X4G12X4R12X4G12X4_422_UNORM_4PACK16 = 1000156021;\nexport const VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG = 1000054000;\nexport const VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG = 1000054001;\nexport const VK_FORMAT_PVRTC2_2BPP_UNORM_BLOCK_IMG = 1000054002;\nexport const VK_FORMAT_PVRTC2_4BPP_UNORM_BLOCK_IMG = 1000054003;\nexport const VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG = 1000054004;\nexport const VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG = 1000054005;\nexport const VK_FORMAT_PVRTC2_2BPP_SRGB_BLOCK_IMG = 1000054006;\nexport const VK_FORMAT_PVRTC2_4BPP_SRGB_BLOCK_IMG = 1000054007;\nexport const VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT = 1000066000;\nexport const VK_FORMAT_ASTC_5x4_SFLOAT_BLOCK_EXT = 1000066001;\nexport const VK_FORMAT_ASTC_5x5_SFLOAT_BLOCK_EXT = 1000066002;\nexport const VK_FORMAT_ASTC_6x5_SFLOAT_BLOCK_EXT = 1000066003;\nexport const VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT = 1000066004;\nexport const VK_FORMAT_ASTC_8x5_SFLOAT_BLOCK_EXT = 1000066005;\nexport const VK_FORMAT_ASTC_8x6_SFLOAT_BLOCK_EXT = 1000066006;\nexport const VK_FORMAT_ASTC_8x8_SFLOAT_BLOCK_EXT = 1000066007;\nexport const VK_FORMAT_ASTC_10x5_SFLOAT_BLOCK_EXT = 1000066008;\nexport const VK_FORMAT_ASTC_10x6_SFLOAT_BLOCK_EXT = 1000066009;\nexport const VK_FORMAT_ASTC_10x8_SFLOAT_BLOCK_EXT = 1000066010;\nexport const VK_FORMAT_ASTC_10x10_SFLOAT_BLOCK_EXT = 1000066011;\nexport const VK_FORMAT_ASTC_12x10_SFLOAT_BLOCK_EXT = 1000066012;\nexport const VK_FORMAT_ASTC_12x12_SFLOAT_BLOCK_EXT = 1000066013;\nexport const VK_FORMAT_A4R4G4B4_UNORM_PACK16_EXT = 1000340000;\nexport const VK_FORMAT_A4B4G4R4_UNORM_PACK16_EXT = 1000340001;\n\nexport type VKFormat =\n\t| typeof VK_FORMAT_UNDEFINED\n\t| typeof VK_FORMAT_R4G4_UNORM_PACK8\n\t| typeof VK_FORMAT_R4G4B4A4_UNORM_PACK16\n\t| typeof VK_FORMAT_B4G4R4A4_UNORM_PACK16\n\t| typeof VK_FORMAT_R5G6B5_UNORM_PACK16\n\t| typeof VK_FORMAT_B5G6R5_UNORM_PACK16\n\t| typeof VK_FORMAT_R5G5B5A1_UNORM_PACK16\n\t| typeof VK_FORMAT_B5G5R5A1_UNORM_PACK16\n\t| typeof VK_FORMAT_A1R5G5B5_UNORM_PACK16\n\t| typeof VK_FORMAT_R8_UNORM\n\t| typeof VK_FORMAT_R8_SNORM\n\t| typeof VK_FORMAT_R8_UINT\n\t| typeof VK_FORMAT_R8_SINT\n\t| typeof VK_FORMAT_R8_SRGB\n\t| typeof VK_FORMAT_R8G8_UNORM\n\t| typeof VK_FORMAT_R8G8_SNORM\n\t| typeof VK_FORMAT_R8G8_UINT\n\t| typeof VK_FORMAT_R8G8_SINT\n\t| typeof VK_FORMAT_R8G8_SRGB\n\t| typeof VK_FORMAT_R8G8B8_UNORM\n\t| typeof VK_FORMAT_R8G8B8_SNORM\n\t| typeof VK_FORMAT_R8G8B8_UINT\n\t| typeof VK_FORMAT_R8G8B8_SINT\n\t| typeof VK_FORMAT_R8G8B8_SRGB\n\t| typeof VK_FORMAT_B8G8R8_UNORM\n\t| typeof VK_FORMAT_B8G8R8_SNORM\n\t| typeof VK_FORMAT_B8G8R8_UINT\n\t| typeof VK_FORMAT_B8G8R8_SINT\n\t| typeof VK_FORMAT_B8G8R8_SRGB\n\t| typeof VK_FORMAT_R8G8B8A8_UNORM\n\t| typeof VK_FORMAT_R8G8B8A8_SNORM\n\t| typeof VK_FORMAT_R8G8B8A8_UINT\n\t| typeof VK_FORMAT_R8G8B8A8_SINT\n\t| typeof VK_FORMAT_R8G8B8A8_SRGB\n\t| typeof VK_FORMAT_B8G8R8A8_UNORM\n\t| typeof VK_FORMAT_B8G8R8A8_SNORM\n\t| typeof VK_FORMAT_B8G8R8A8_UINT\n\t| typeof VK_FORMAT_B8G8R8A8_SINT\n\t| typeof VK_FORMAT_B8G8R8A8_SRGB\n\t| typeof VK_FORMAT_A2R10G10B10_UNORM_PACK32\n\t| typeof VK_FORMAT_A2R10G10B10_SNORM_PACK32\n\t| typeof VK_FORMAT_A2R10G10B10_UINT_PACK32\n\t| typeof VK_FORMAT_A2R10G10B10_SINT_PACK32\n\t| typeof VK_FORMAT_A2B10G10R10_UNORM_PACK32\n\t| typeof VK_FORMAT_A2B10G10R10_SNORM_PACK32\n\t| typeof VK_FORMAT_A2B10G10R10_UINT_PACK32\n\t| typeof VK_FORMAT_A2B10G10R10_SINT_PACK32\n\t| typeof VK_FORMAT_R16_UNORM\n\t| typeof VK_FORMAT_R16_SNORM\n\t| typeof VK_FORMAT_R16_UINT\n\t| typeof VK_FORMAT_R16_SINT\n\t| typeof VK_FORMAT_R16_SFLOAT\n\t| typeof VK_FORMAT_R16G16_UNORM\n\t| typeof VK_FORMAT_R16G16_SNORM\n\t| typeof VK_FORMAT_R16G16_UINT\n\t| typeof VK_FORMAT_R16G16_SINT\n\t| typeof VK_FORMAT_R16G16_SFLOAT\n\t| typeof VK_FORMAT_R16G16B16_UNORM\n\t| typeof VK_FORMAT_R16G16B16_SNORM\n\t| typeof VK_FORMAT_R16G16B16_UINT\n\t| typeof VK_FORMAT_R16G16B16_SINT\n\t| typeof VK_FORMAT_R16G16B16_SFLOAT\n\t| typeof VK_FORMAT_R16G16B16A16_UNORM\n\t| typeof VK_FORMAT_R16G16B16A16_SNORM\n\t| typeof VK_FORMAT_R16G16B16A16_UINT\n\t| typeof VK_FORMAT_R16G16B16A16_SINT\n\t| typeof VK_FORMAT_R16G16B16A16_SFLOAT\n\t| typeof VK_FORMAT_R32_UINT\n\t| typeof VK_FORMAT_R32_SINT\n\t| typeof VK_FORMAT_R32_SFLOAT\n\t| typeof VK_FORMAT_R32G32_UINT\n\t| typeof VK_FORMAT_R32G32_SINT\n\t| typeof VK_FORMAT_R32G32_SFLOAT\n\t| typeof VK_FORMAT_R32G32B32_UINT\n\t| typeof VK_FORMAT_R32G32B32_SINT\n\t| typeof VK_FORMAT_R32G32B32_SFLOAT\n\t| typeof VK_FORMAT_R32G32B32A32_UINT\n\t| typeof VK_FORMAT_R32G32B32A32_SINT\n\t| typeof VK_FORMAT_R32G32B32A32_SFLOAT\n\t| typeof VK_FORMAT_R64_UINT\n\t| typeof VK_FORMAT_R64_SINT\n\t| typeof VK_FORMAT_R64_SFLOAT\n\t| typeof VK_FORMAT_R64G64_UINT\n\t| typeof VK_FORMAT_R64G64_SINT\n\t| typeof VK_FORMAT_R64G64_SFLOAT\n\t| typeof VK_FORMAT_R64G64B64_UINT\n\t| typeof VK_FORMAT_R64G64B64_SINT\n\t| typeof VK_FORMAT_R64G64B64_SFLOAT\n\t| typeof VK_FORMAT_R64G64B64A64_UINT\n\t| typeof VK_FORMAT_R64G64B64A64_SINT\n\t| typeof VK_FORMAT_R64G64B64A64_SFLOAT\n\t| typeof VK_FORMAT_B10G11R11_UFLOAT_PACK32\n\t| typeof VK_FORMAT_E5B9G9R9_UFLOAT_PACK32\n\t| typeof VK_FORMAT_D16_UNORM\n\t| typeof VK_FORMAT_X8_D24_UNORM_PACK32\n\t| typeof VK_FORMAT_D32_SFLOAT\n\t| typeof VK_FORMAT_S8_UINT\n\t| typeof VK_FORMAT_D16_UNORM_S8_UINT\n\t| typeof VK_FORMAT_D24_UNORM_S8_UINT\n\t| typeof VK_FORMAT_D32_SFLOAT_S8_UINT\n\t| typeof VK_FORMAT_BC1_RGB_UNORM_BLOCK\n\t| typeof VK_FORMAT_BC1_RGB_SRGB_BLOCK\n\t| typeof VK_FORMAT_BC1_RGBA_UNORM_BLOCK\n\t| typeof VK_FORMAT_BC1_RGBA_SRGB_BLOCK\n\t| typeof VK_FORMAT_BC2_UNORM_BLOCK\n\t| typeof VK_FORMAT_BC2_SRGB_BLOCK\n\t| typeof VK_FORMAT_BC3_UNORM_BLOCK\n\t| typeof VK_FORMAT_BC3_SRGB_BLOCK\n\t| typeof VK_FORMAT_BC4_UNORM_BLOCK\n\t| typeof VK_FORMAT_BC4_SNORM_BLOCK\n\t| typeof VK_FORMAT_BC5_UNORM_BLOCK\n\t| typeof VK_FORMAT_BC5_SNORM_BLOCK\n\t| typeof VK_FORMAT_BC6H_UFLOAT_BLOCK\n\t| typeof VK_FORMAT_BC6H_SFLOAT_BLOCK\n\t| typeof VK_FORMAT_BC7_UNORM_BLOCK\n\t| typeof VK_FORMAT_BC7_SRGB_BLOCK\n\t| typeof VK_FORMAT_ETC2_R8G8B8_UNORM_BLOCK\n\t| typeof VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK\n\t| typeof VK_FORMAT_ETC2_R8G8B8A1_UNORM_BLOCK\n\t| typeof VK_FORMAT_ETC2_R8G8B8A1_SRGB_BLOCK\n\t| typeof VK_FORMAT_ETC2_R8G8B8A8_UNORM_BLOCK\n\t| typeof VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK\n\t| typeof VK_FORMAT_EAC_R11_UNORM_BLOCK\n\t| typeof VK_FORMAT_EAC_R11_SNORM_BLOCK\n\t| typeof VK_FORMAT_EAC_R11G11_UNORM_BLOCK\n\t| typeof VK_FORMAT_EAC_R11G11_SNORM_BLOCK\n\t| typeof VK_FORMAT_ASTC_4x4_UNORM_BLOCK\n\t| typeof VK_FORMAT_ASTC_4x4_SRGB_BLOCK\n\t| typeof VK_FORMAT_ASTC_5x4_UNORM_BLOCK\n\t| typeof VK_FORMAT_ASTC_5x4_SRGB_BLOCK\n\t| typeof VK_FORMAT_ASTC_5x5_UNORM_BLOCK\n\t| typeof VK_FORMAT_ASTC_5x5_SRGB_BLOCK\n\t| typeof VK_FORMAT_ASTC_6x5_UNORM_BLOCK\n\t| typeof VK_FORMAT_ASTC_6x5_SRGB_BLOCK\n\t| typeof VK_FORMAT_ASTC_6x6_UNORM_BLOCK\n\t| typeof VK_FORMAT_ASTC_6x6_SRGB_BLOCK\n\t| typeof VK_FORMAT_ASTC_8x5_UNORM_BLOCK\n\t| typeof VK_FORMAT_ASTC_8x5_SRGB_BLOCK\n\t| typeof VK_FORMAT_ASTC_8x6_UNORM_BLOCK\n\t| typeof VK_FORMAT_ASTC_8x6_SRGB_BLOCK\n\t| typeof VK_FORMAT_ASTC_8x8_UNORM_BLOCK\n\t| typeof VK_FORMAT_ASTC_8x8_SRGB_BLOCK\n\t| typeof VK_FORMAT_ASTC_10x5_UNORM_BLOCK\n\t| typeof VK_FORMAT_ASTC_10x5_SRGB_BLOCK\n\t| typeof VK_FORMAT_ASTC_10x6_UNORM_BLOCK\n\t| typeof VK_FORMAT_ASTC_10x6_SRGB_BLOCK\n\t| typeof VK_FORMAT_ASTC_10x8_UNORM_BLOCK\n\t| typeof VK_FORMAT_ASTC_10x8_SRGB_BLOCK\n\t| typeof VK_FORMAT_ASTC_10x10_UNORM_BLOCK\n\t| typeof VK_FORMAT_ASTC_10x10_SRGB_BLOCK\n\t| typeof VK_FORMAT_ASTC_12x10_UNORM_BLOCK\n\t| typeof VK_FORMAT_ASTC_12x10_SRGB_BLOCK\n\t| typeof VK_FORMAT_ASTC_12x12_UNORM_BLOCK\n\t| typeof VK_FORMAT_ASTC_12x12_SRGB_BLOCK\n\t| typeof VK_FORMAT_R10X6_UNORM_PACK16\n\t| typeof VK_FORMAT_R10X6G10X6_UNORM_2PACK16\n\t| typeof VK_FORMAT_R10X6G10X6B10X6A10X6_UNORM_4PACK16\n\t| typeof VK_FORMAT_G10X6B10X6G10X6R10X6_422_UNORM_4PACK16\n\t| typeof VK_FORMAT_B10X6G10X6R10X6G10X6_422_UNORM_4PACK16\n\t| typeof VK_FORMAT_R12X4_UNORM_PACK16\n\t| typeof VK_FORMAT_R12X4G12X4_UNORM_2PACK16\n\t| typeof VK_FORMAT_R12X4G12X4B12X4A12X4_UNORM_4PACK16\n\t| typeof VK_FORMAT_G12X4B12X4G12X4R12X4_422_UNORM_4PACK16\n\t| typeof VK_FORMAT_B12X4G12X4R12X4G12X4_422_UNORM_4PACK16\n\t| typeof VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG\n\t| typeof VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG\n\t| typeof VK_FORMAT_PVRTC2_2BPP_UNORM_BLOCK_IMG\n\t| typeof VK_FORMAT_PVRTC2_4BPP_UNORM_BLOCK_IMG\n\t| typeof VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG\n\t| typeof VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG\n\t| typeof VK_FORMAT_PVRTC2_2BPP_SRGB_BLOCK_IMG\n\t| typeof VK_FORMAT_PVRTC2_4BPP_SRGB_BLOCK_IMG\n\t| typeof VK_FORMAT_ASTC_4x4_SFLOAT_BLOCK_EXT\n\t| typeof VK_FORMAT_ASTC_5x4_SFLOAT_BLOCK_EXT\n\t| typeof VK_FORMAT_ASTC_5x5_SFLOAT_BLOCK_EXT\n\t| typeof VK_FORMAT_ASTC_6x5_SFLOAT_BLOCK_EXT\n\t| typeof VK_FORMAT_ASTC_6x6_SFLOAT_BLOCK_EXT\n\t| typeof VK_FORMAT_ASTC_8x5_SFLOAT_BLOCK_EXT\n\t| typeof VK_FORMAT_ASTC_8x6_SFLOAT_BLOCK_EXT\n\t| typeof VK_FORMAT_ASTC_8x8_SFLOAT_BLOCK_EXT\n\t| typeof VK_FORMAT_ASTC_10x5_SFLOAT_BLOCK_EXT\n\t| typeof VK_FORMAT_ASTC_10x6_SFLOAT_BLOCK_EXT\n\t| typeof VK_FORMAT_ASTC_10x8_SFLOAT_BLOCK_EXT\n\t| typeof VK_FORMAT_ASTC_10x10_SFLOAT_BLOCK_EXT\n\t| typeof VK_FORMAT_ASTC_12x10_SFLOAT_BLOCK_EXT\n\t| typeof VK_FORMAT_ASTC_12x12_SFLOAT_BLOCK_EXT\n\t| typeof VK_FORMAT_A4R4G4B4_UNORM_PACK16_EXT\n\t| typeof VK_FORMAT_A4B4G4R4_UNORM_PACK16_EXT;\n", "import {\n\tKHR_DF_FLAG_ALPHA_STRAIGHT,\n\tKHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT,\n\tKHR_DF_MODEL_UNSPECIFIED,\n\tKHR_DF_PRIMARIES_BT709,\n\tKHR_DF_TRANSFER_SRGB,\n\tKHR_DF_VENDORID_KHRONOS,\n\tKHR_DF_VERSION,\n\tKHR_SUPERCOMPRESSION_NONE,\n\tVK_FORMAT_UNDEFINED,\n} from './constants.js';\nimport type { KTX2Container } from './container.js';\n\n/**\n * Creates a 'default' {@link KTX2Container} object, initialized with common\n * configuration wfor BT709 primaries and sRGB transfer, without pixel data.\n * There's nothing particularly special about the 'default' container; creating\n * the KTX2Container object explicitly is also fine.\n */\nexport function createDefaultContainer(): KTX2Container {\n\treturn {\n\t\tvkFormat: VK_FORMAT_UNDEFINED,\n\t\ttypeSize: 1,\n\t\tpixelWidth: 0,\n\t\tpixelHeight: 0,\n\t\tpixelDepth: 0,\n\t\tlayerCount: 0,\n\t\tfaceCount: 1,\n\t\tlevelCount: 0,\n\t\tsupercompressionScheme: KHR_SUPERCOMPRESSION_NONE,\n\t\tlevels: [],\n\t\tdataFormatDescriptor: [\n\t\t\t{\n\t\t\t\tvendorId: KHR_DF_VENDORID_KHRONOS,\n\t\t\t\tdescriptorType: KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT,\n\t\t\t\tversionNumber: KHR_DF_VERSION,\n\t\t\t\tcolorModel: KHR_DF_MODEL_UNSPECIFIED,\n\t\t\t\tcolorPrimaries: KHR_DF_PRIMARIES_BT709,\n\t\t\t\ttransferFunction: KHR_DF_TRANSFER_SRGB,\n\t\t\t\tflags: KHR_DF_FLAG_ALPHA_STRAIGHT,\n\t\t\t\ttexelBlockDimension: [0, 0, 0, 0],\n\t\t\t\tbytesPlane: [0, 0, 0, 0, 0, 0, 0, 0],\n\t\t\t\tsamples: [],\n\t\t\t},\n\t\t],\n\t\tkeyValue: {},\n\t\tglobalData: null,\n\t};\n}\n", "export class BufferReader {\n\tprivate _dataView: DataView;\n\tprivate _littleEndian: boolean;\n\tpublic _offset: number;\n\n\tconstructor(data: Uint8Array, byteOffset: number, byteLength: number, littleEndian: boolean) {\n\t\tthis._dataView = new DataView(data.buffer, data.byteOffset + byteOffset, byteLength);\n\t\tthis._littleEndian = littleEndian;\n\t\tthis._offset = 0;\n\t}\n\n\t_nextUint8(): number {\n\t\tconst value = this._dataView.getUint8(this._offset);\n\t\tthis._offset += 1;\n\t\treturn value;\n\t}\n\n\t_nextUint16(): number {\n\t\tconst value = this._dataView.getUint16(this._offset, this._littleEndian);\n\t\tthis._offset += 2;\n\t\treturn value;\n\t}\n\n\t_nextUint32(): number {\n\t\tconst value = this._dataView.getUint32(this._offset, this._littleEndian);\n\t\tthis._offset += 4;\n\t\treturn value;\n\t}\n\n\t_nextUint64(): number {\n\t\tconst left = this._dataView.getUint32(this._offset, this._littleEndian);\n\t\tconst right = this._dataView.getUint32(this._offset + 4, this._littleEndian);\n\t\t// TODO(cleanup): Just test this...\n\t\t// const value = this._littleEndian ? left + (2 ** 32 * right) : (2 ** 32 * left) + right;\n\t\tconst value = left + 2 ** 32 * right;\n\t\tthis._offset += 8;\n\t\treturn value;\n\t}\n\n\t_nextInt32(): number {\n\t\tconst value = this._dataView.getInt32(this._offset, this._littleEndian);\n\t\tthis._offset += 4;\n\t\treturn value;\n\t}\n\n\t_nextUint8Array(len: number): Uint8Array {\n\t\tconst value = new Uint8Array(this._dataView.buffer, this._dataView.byteOffset + this._offset, len);\n\t\tthis._offset += len;\n\t\treturn value;\n\t}\n\n\t_skip(bytes: number): this {\n\t\tthis._offset += bytes;\n\t\treturn this;\n\t}\n\n\t_scan(maxByteLength: number, term = 0x00): Uint8Array {\n\t\tconst byteOffset = this._offset;\n\t\tlet byteLength = 0;\n\t\twhile (this._dataView.getUint8(this._offset) !== term && byteLength < maxByteLength) {\n\t\t\tbyteLength++;\n\t\t\tthis._offset++;\n\t\t}\n\n\t\tif (byteLength < maxByteLength) this._offset++;\n\n\t\treturn new Uint8Array(this._dataView.buffer, this._dataView.byteOffset + byteOffset, byteLength);\n\t}\n}\n", "///////////////////////////////////////////////////\n// Common.\n///////////////////////////////////////////////////\n\n// Injected at compile time, from $npm_package_version.\ndeclare const PACKAGE_VERSION: string;\n\nexport const KTX_WRITER: string = `KTX-Parse v${PACKAGE_VERSION}`;\n\nexport const NUL: Uint8Array = new Uint8Array([0x00]);\n\nexport type vec3 = [number, number, number];\nexport type vec2 = [number, number, number];\n\n///////////////////////////////////////////////////\n// KTX2 Header.\n///////////////////////////////////////////////////\n\nexport const KTX2_ID: number[] = [\n\t// '´', 'K', 'T', 'X', '2', '0', 'ª', '\\r', '\\n', '\\x1A', '\\n'\n\t0xab, 0x4b, 0x54, 0x58, 0x20, 0x32, 0x30, 0xbb, 0x0d, 0x0a, 0x1a, 0x0a,\n];\n\nexport const HEADER_BYTE_LENGTH = 68; // 13 * 4 + 2 * 8\n", "import type { vec3 } from './constants-internal.js';\nimport {\n\ttype VKFormat,\n\tVK_FORMAT_ASTC_4x4_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_4x4_UNORM_BLOCK,\n\tVK_FORMAT_ASTC_5x4_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_5x4_UNORM_BLOCK,\n\tVK_FORMAT_ASTC_5x5_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_5x5_UNORM_BLOCK,\n\tVK_FORMAT_ASTC_6x5_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_6x5_UNORM_BLOCK,\n\tVK_FORMAT_ASTC_6x6_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_6x6_UNORM_BLOCK,\n\tVK_FORMAT_ASTC_8x5_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_8x5_UNORM_BLOCK,\n\tVK_FORMAT_ASTC_8x6_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_8x6_UNORM_BLOCK,\n\tVK_FORMAT_ASTC_8x8_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_8x8_UNORM_BLOCK,\n\tVK_FORMAT_ASTC_10x5_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_10x5_UNORM_BLOCK,\n\tVK_FORMAT_ASTC_10x6_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_10x6_UNORM_BLOCK,\n\tVK_FORMAT_ASTC_10x8_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_10x8_UNORM_BLOCK,\n\tVK_FORMAT_ASTC_10x10_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_10x10_UNORM_BLOCK,\n\tVK_FORMAT_ASTC_12x10_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_12x10_UNORM_BLOCK,\n\tVK_FORMAT_ASTC_12x12_SRGB_BLOCK,\n\tVK_FORMAT_ASTC_12x12_UNORM_BLOCK,\n\tVK_FORMAT_BC1_RGB_UNORM_BLOCK,\n\tVK_FORMAT_BC7_SRGB_BLOCK,\n\tVK_FORMAT_EAC_R11G11_SNORM_BLOCK,\n\tVK_FORMAT_ETC2_R8G8B8_UNORM_BLOCK,\n\tVK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG,\n\tVK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG,\n\tVK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG,\n\tVK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG,\n\tVK_FORMAT_PVRTC2_2BPP_SRGB_BLOCK_IMG,\n\tVK_FORMAT_PVRTC2_2BPP_UNORM_BLOCK_IMG,\n\tVK_FORMAT_PVRTC2_4BPP_SRGB_BLOCK_IMG,\n\tVK_FORMAT_PVRTC2_4BPP_UNORM_BLOCK_IMG,\n\tVK_FORMAT_UNDEFINED,\n} from './constants.js';\nimport type { KTX2Container } from './container.js';\n\n/** Encodes text to an ArrayBuffer. */\nexport function encodeText(text: string): Uint8Array {\n\treturn new TextEncoder().encode(text);\n}\n\n/** Decodes an ArrayBuffer to text. */\nexport function decodeText(buffer: Uint8Array): string {\n\treturn new TextDecoder().decode(buffer);\n}\n\n/** Concatenates N ArrayBuffers. */\nexport function concat(buffers: (ArrayBuffer | Uint8Array)[]): Uint8Array {\n\tlet totalByteLength = 0;\n\tfor (const buffer of buffers) {\n\t\ttotalByteLength += buffer.byteLength;\n\t}\n\n\tconst result = new Uint8Array(totalByteLength);\n\tlet byteOffset = 0;\n\n\tfor (const buffer of buffers) {\n\t\tresult.set(new Uint8Array(buffer), byteOffset);\n\t\tbyteOffset += buffer.byteLength;\n\t}\n\n\treturn result;\n}\n\n/** Returns the least common multiple (LCM) for two positive integers. */\nexport function leastCommonMultiple(a: number, b: number): number {\n\tconst max = Math.max(a, b);\n\tconst min = Math.min(a, b);\n\tlet lcm = max;\n\n\twhile (lcm % min !== 0) {\n\t\tlcm += max;\n\t}\n\n\treturn lcm;\n}\n\n/**\n * Returns amount of padding, in bytes, required to pad a value V to N-byte\n * boundaries. Both V and N must be positive integers.\n */\nexport function getPadding(v: number, n = 4): number {\n\treturn Math.ceil(v / n) * n - v;\n}\n\n/** Returns byte length per texel block. */\nexport function getBlockByteLength(container: KTX2Container): number {\n\treturn container.levels[0].levelData.byteLength / getBlockCount(container, 0);\n}\n\n/**\n * Returns total number of blocks for given level. For VK_FORMAT_UNDEFINED, DFD is required.\n *\n * References:\n * - https://github.khronos.org/KTX-Specification/ktxspec.v2.html#levelImages\n */\nexport function getBlockCount(container: KTX2Container, levelIndex: number): number {\n\tlet blockCount = 1;\n\n\tconst pixelDimensions = [container.pixelWidth, container.pixelHeight, container.pixelDepth];\n\tconst blockDimensions = getBlockDimensions(container);\n\n\tfor (let i = 0; i < 3; i++) {\n\t\tif (pixelDimensions[i] > 0) {\n\t\t\tconst dimBlockCount = Math.ceil(Math.floor(pixelDimensions[i] * 2 ** -levelIndex) / blockDimensions[i]);\n\t\t\tblockCount *= Math.max(1, dimBlockCount);\n\t\t}\n\t}\n\n\tif (container.layerCount > 0) {\n\t\tblockCount *= container.layerCount;\n\t}\n\n\tif (container.faceCount > 0) {\n\t\tblockCount *= container.faceCount;\n\t}\n\n\treturn blockCount;\n}\n\n/**\n * Given a KTX2 container, returns block dimensions as [width, height, depth]. Requires valid DFD.\n */\nexport function getBlockDimensions(container: KTX2Container): vec3 {\n\tconst [x, y, z] = container.dataFormatDescriptor[0].texelBlockDimension;\n\treturn [x + 1, y + 1, z + 1];\n}\n\n/**\n * Given `vkFormat`, returns block dimensions as [width, height, depth]. Does not support\n * VK_FORMAT_UNDEFINED.\n *\n * References:\n * - https://github.khronos.org/KTX-Specification/ktxspec.v2.html#_mippadding\n * - https://registry.khronos.org/vulkan/specs/1.2-extensions/html/vkspec.html#formats-compatibility\n */\nexport function getBlockDimensionsByVKFormat(vkFormat: VKFormat): vec3 {\n\tif (vkFormat === VK_FORMAT_UNDEFINED) {\n\t\tthrow new Error('Unknown block dimensions for VK_FORMAT_UNDEFINED.');\n\t}\n\tif (vkFormat >= VK_FORMAT_BC1_RGB_UNORM_BLOCK && vkFormat <= VK_FORMAT_BC7_SRGB_BLOCK) {\n\t\treturn [4, 4, 1];\n\t}\n\tif (vkFormat >= VK_FORMAT_ETC2_R8G8B8_UNORM_BLOCK && vkFormat <= VK_FORMAT_EAC_R11G11_SNORM_BLOCK) {\n\t\treturn [4, 4, 1];\n\t}\n\tif (vkFormat === VK_FORMAT_ASTC_4x4_UNORM_BLOCK || vkFormat === VK_FORMAT_ASTC_4x4_SRGB_BLOCK) {\n\t\treturn [4, 4, 1];\n\t}\n\tif (vkFormat === VK_FORMAT_ASTC_5x4_UNORM_BLOCK || vkFormat === VK_FORMAT_ASTC_5x4_SRGB_BLOCK) {\n\t\treturn [5, 4, 1];\n\t}\n\tif (vkFormat === VK_FORMAT_ASTC_5x5_UNORM_BLOCK || vkFormat === VK_FORMAT_ASTC_5x5_SRGB_BLOCK) {\n\t\treturn [5, 5, 1];\n\t}\n\tif (vkFormat === VK_FORMAT_ASTC_6x5_UNORM_BLOCK || vkFormat === VK_FORMAT_ASTC_6x5_SRGB_BLOCK) {\n\t\treturn [6, 5, 1];\n\t}\n\tif (vkFormat === VK_FORMAT_ASTC_6x6_UNORM_BLOCK || vkFormat === VK_FORMAT_ASTC_6x6_SRGB_BLOCK) {\n\t\treturn [6, 6, 1];\n\t}\n\tif (vkFormat === VK_FORMAT_ASTC_8x5_UNORM_BLOCK || vkFormat === VK_FORMAT_ASTC_8x5_SRGB_BLOCK) {\n\t\treturn [8, 5, 1];\n\t}\n\tif (vkFormat === VK_FORMAT_ASTC_8x6_UNORM_BLOCK || vkFormat === VK_FORMAT_ASTC_8x6_SRGB_BLOCK) {\n\t\treturn [8, 6, 1];\n\t}\n\tif (vkFormat === VK_FORMAT_ASTC_8x8_UNORM_BLOCK || vkFormat === VK_FORMAT_ASTC_8x8_SRGB_BLOCK) {\n\t\treturn [8, 8, 1];\n\t}\n\tif (vkFormat === VK_FORMAT_ASTC_10x5_UNORM_BLOCK || vkFormat === VK_FORMAT_ASTC_10x5_SRGB_BLOCK) {\n\t\treturn [10, 5, 1];\n\t}\n\tif (vkFormat === VK_FORMAT_ASTC_10x6_UNORM_BLOCK || vkFormat === VK_FORMAT_ASTC_10x6_SRGB_BLOCK) {\n\t\treturn [10, 6, 1];\n\t}\n\tif (vkFormat === VK_FORMAT_ASTC_10x8_UNORM_BLOCK || vkFormat === VK_FORMAT_ASTC_10x8_SRGB_BLOCK) {\n\t\treturn [10, 8, 1];\n\t}\n\tif (vkFormat === VK_FORMAT_ASTC_10x10_UNORM_BLOCK || vkFormat === VK_FORMAT_ASTC_10x10_SRGB_BLOCK) {\n\t\treturn [10, 10, 1];\n\t}\n\tif (vkFormat === VK_FORMAT_ASTC_12x10_UNORM_BLOCK || vkFormat === VK_FORMAT_ASTC_12x10_SRGB_BLOCK) {\n\t\treturn [12, 10, 1];\n\t}\n\tif (vkFormat === VK_FORMAT_ASTC_12x12_UNORM_BLOCK || vkFormat === VK_FORMAT_ASTC_12x12_SRGB_BLOCK) {\n\t\treturn [12, 12, 1];\n\t}\n\tif (\n\t\tvkFormat === VK_FORMAT_PVRTC1_2BPP_UNORM_BLOCK_IMG ||\n\t\tvkFormat === VK_FORMAT_PVRTC1_2BPP_SRGB_BLOCK_IMG ||\n\t\tvkFormat === VK_FORMAT_PVRTC2_2BPP_UNORM_BLOCK_IMG ||\n\t\tvkFormat === VK_FORMAT_PVRTC2_2BPP_SRGB_BLOCK_IMG\n\t) {\n\t\treturn [8, 4, 1];\n\t}\n\tif (\n\t\tvkFormat === VK_FORMAT_PVRTC1_4BPP_UNORM_BLOCK_IMG ||\n\t\tvkFormat === VK_FORMAT_PVRTC1_4BPP_SRGB_BLOCK_IMG ||\n\t\tvkFormat === VK_FORMAT_PVRTC2_4BPP_UNORM_BLOCK_IMG ||\n\t\tvkFormat === VK_FORMAT_PVRTC2_4BPP_SRGB_BLOCK_IMG\n\t) {\n\t\treturn [4, 4, 1];\n\t}\n\treturn [1, 1, 1];\n}\n", "import { BufferReader } from './buffer-reader.js';\nimport { KTX2_ID } from './constants-internal.js';\nimport { KHR_DF_SAMPLE_DATATYPE_SIGNED, type Supercompression, type VKFormat } from './constants.js';\nimport type { KTX2BasicFormatSample, KTX2Container, KTX2DataFormatDescriptorBasicFormat } from './container.js';\nimport { createDefaultContainer } from './create-default-container.js';\nimport { decodeText } from './util.js';\n\n/**\n * Parses a KTX 2.0 file, returning an unpacked {@link KTX2Container} instance with all associated\n * data. The container's mip levels and other binary data are pointers into the original file, not\n * copies, so the original file should not be overwritten after reading.\n *\n * @param data Bytes of KTX 2.0 file, as Uint8Array or Buffer.\n */\nexport function read(data: Uint8Array): KTX2Container {\n\t///////////////////////////////////////////////////\n\t// KTX 2.0 Identifier.\n\t///////////////////////////////////////////////////\n\n\tconst id = new Uint8Array(data.buffer, data.byteOffset, KTX2_ID.length);\n\tif (\n\t\tid[0] !== KTX2_ID[0] || // '´'\n\t\tid[1] !== KTX2_ID[1] || // 'K'\n\t\tid[2] !== KTX2_ID[2] || // 'T'\n\t\tid[3] !== KTX2_ID[3] || // 'X'\n\t\tid[4] !== KTX2_ID[4] || // ' '\n\t\tid[5] !== KTX2_ID[5] || // '2'\n\t\tid[6] !== KTX2_ID[6] || // '0'\n\t\tid[7] !== KTX2_ID[7] || // 'ª'\n\t\tid[8] !== KTX2_ID[8] || // '\\r'\n\t\tid[9] !== KTX2_ID[9] || // '\\n'\n\t\tid[10] !== KTX2_ID[10] || // '\\x1A'\n\t\tid[11] !== KTX2_ID[11] // '\\n'\n\t) {\n\t\tthrow new Error('Missing KTX 2.0 identifier.');\n\t}\n\n\tconst container = createDefaultContainer();\n\n\t///////////////////////////////////////////////////\n\t// Header.\n\t///////////////////////////////////////////////////\n\n\tconst headerByteLength = 17 * Uint32Array.BYTES_PER_ELEMENT;\n\tconst headerReader = new BufferReader(data, KTX2_ID.length, headerByteLength, true);\n\n\tcontainer.vkFormat = headerReader._nextUint32() as VKFormat;\n\tcontainer.typeSize = headerReader._nextUint32();\n\tcontainer.pixelWidth = headerReader._nextUint32();\n\tcontainer.pixelHeight = headerReader._nextUint32();\n\tcontainer.pixelDepth = headerReader._nextUint32();\n\tcontainer.layerCount = headerReader._nextUint32();\n\tcontainer.faceCount = headerReader._nextUint32();\n\tcontainer.levelCount = headerReader._nextUint32();\n\n\tcontainer.supercompressionScheme = headerReader._nextUint32() as Supercompression;\n\n\tconst dfdByteOffset = headerReader._nextUint32();\n\tconst dfdByteLength = headerReader._nextUint32();\n\tconst kvdByteOffset = headerReader._nextUint32();\n\tconst kvdByteLength = headerReader._nextUint32();\n\tconst sgdByteOffset = headerReader._nextUint64();\n\tconst sgdByteLength = headerReader._nextUint64();\n\n\t///////////////////////////////////////////////////\n\t// Level Index.\n\t///////////////////////////////////////////////////\n\n\tconst levelByteLength = Math.max(container.levelCount, 1) * 3 * 8;\n\tconst levelReader = new BufferReader(data, KTX2_ID.length + headerByteLength, levelByteLength, true);\n\n\tfor (let i = 0, il = Math.max(container.levelCount, 1); i < il; i++) {\n\t\tcontainer.levels.push({\n\t\t\tlevelData: new Uint8Array(data.buffer, data.byteOffset + levelReader._nextUint64(), levelReader._nextUint64()),\n\t\t\tuncompressedByteLength: levelReader._nextUint64(),\n\t\t});\n\t}\n\n\t///////////////////////////////////////////////////\n\t// Data Format Descriptor (DFD).\n\t///////////////////////////////////////////////////\n\n\tconst dfdReader = new BufferReader(data, dfdByteOffset, dfdByteLength, true);\n\n\tdfdReader._skip(4); // totalSize\n\tconst vendorId = dfdReader._nextUint16();\n\tconst descriptorType = dfdReader._nextUint16();\n\tconst versionNumber = dfdReader._nextUint16();\n\tconst descriptorBlockSize = dfdReader._nextUint16();\n\tconst colorModel = dfdReader._nextUint8();\n\tconst colorPrimaries = dfdReader._nextUint8();\n\tconst transferFunction = dfdReader._nextUint8();\n\tconst flags = dfdReader._nextUint8();\n\n\tconst texelBlockDimension = [\n\t\tdfdReader._nextUint8(),\n\t\tdfdReader._nextUint8(),\n\t\tdfdReader._nextUint8(),\n\t\tdfdReader._nextUint8(),\n\t] as KTX2DataFormatDescriptorBasicFormat['texelBlockDimension'];\n\n\tconst bytesPlane = [\n\t\tdfdReader._nextUint8(),\n\t\tdfdReader._nextUint8(),\n\t\tdfdReader._nextUint8(),\n\t\tdfdReader._nextUint8(),\n\t\tdfdReader._nextUint8(),\n\t\tdfdReader._nextUint8(),\n\t\tdfdReader._nextUint8(),\n\t\tdfdReader._nextUint8(),\n\t] as KTX2DataFormatDescriptorBasicFormat['bytesPlane'];\n\n\tconst samples = [] as KTX2BasicFormatSample[];\n\n\tconst dfd: KTX2DataFormatDescriptorBasicFormat = {\n\t\tvendorId,\n\t\tdescriptorType,\n\t\tversionNumber,\n\t\tcolorModel,\n\t\tcolorPrimaries,\n\t\ttransferFunction,\n\t\tflags,\n\t\ttexelBlockDimension,\n\t\tbytesPlane,\n\t\tsamples,\n\t};\n\n\tconst sampleStart = 6;\n\tconst sampleWords = 4;\n\tconst numSamples = (descriptorBlockSize / 4 - sampleStart) / sampleWords;\n\n\tfor (let i = 0; i < numSamples; i++) {\n\t\tconst sample = {\n\t\t\tbitOffset: dfdReader._nextUint16(),\n\t\t\tbitLength: dfdReader._nextUint8(),\n\t\t\tchannelType: dfdReader._nextUint8(),\n\t\t\tsamplePosition: [dfdReader._nextUint8(), dfdReader._nextUint8(), dfdReader._nextUint8(), dfdReader._nextUint8()],\n\t\t\tsampleLower: Number.NEGATIVE_INFINITY,\n\t\t\tsampleUpper: Number.POSITIVE_INFINITY,\n\t\t};\n\n\t\tif (sample.channelType & KHR_DF_SAMPLE_DATATYPE_SIGNED) {\n\t\t\tsample.sampleLower = dfdReader._nextInt32();\n\t\t\tsample.sampleUpper = dfdReader._nextInt32();\n\t\t} else {\n\t\t\tsample.sampleLower = dfdReader._nextUint32();\n\t\t\tsample.sampleUpper = dfdReader._nextUint32();\n\t\t}\n\n\t\tdfd.samples[i] = sample;\n\t}\n\n\tcontainer.dataFormatDescriptor.length = 0;\n\tcontainer.dataFormatDescriptor.push(dfd);\n\n\t///////////////////////////////////////////////////\n\t// Key/Value Data (KVD).\n\t///////////////////////////////////////////////////\n\n\tconst kvdReader = new BufferReader(data, kvdByteOffset, kvdByteLength, true);\n\n\twhile (kvdReader._offset < kvdByteLength) {\n\t\tconst keyValueByteLength = kvdReader._nextUint32();\n\t\tconst keyData = kvdReader._scan(keyValueByteLength);\n\t\tconst key = decodeText(keyData);\n\n\t\tcontainer.keyValue[key] = kvdReader._nextUint8Array(keyValueByteLength - keyData.byteLength - 1);\n\n\t\tif (key.match(/^ktx/i)) {\n\t\t\tconst text = decodeText(container.keyValue[key] as Uint8Array);\n\t\t\tcontainer.keyValue[key] = text.substring(0, text.lastIndexOf('\\x00'));\n\t\t}\n\n\t\tconst kvPadding = keyValueByteLength % 4 ? 4 - (keyValueByteLength % 4) : 0; // align(4)\n\t\t// 4-byte alignment.\n\t\tkvdReader._skip(kvPadding);\n\t}\n\n\t///////////////////////////////////////////////////\n\t// Supercompression Global Data (SGD).\n\t///////////////////////////////////////////////////\n\n\tif (sgdByteLength <= 0) return container;\n\n\tconst sgdReader = new BufferReader(data, sgdByteOffset, sgdByteLength, true);\n\n\tconst endpointCount = sgdReader._nextUint16();\n\tconst selectorCount = sgdReader._nextUint16();\n\tconst endpointsByteLength = sgdReader._nextUint32();\n\tconst selectorsByteLength = sgdReader._nextUint32();\n\tconst tablesByteLength = sgdReader._nextUint32();\n\tconst extendedByteLength = sgdReader._nextUint32();\n\n\tconst imageDescs = [];\n\tfor (let i = 0, il = Math.max(container.levelCount, 1); i < il; i++) {\n\t\timageDescs.push({\n\t\t\timageFlags: sgdReader._nextUint32(),\n\t\t\trgbSliceByteOffset: sgdReader._nextUint32(),\n\t\t\trgbSliceByteLength: sgdReader._nextUint32(),\n\t\t\talphaSliceByteOffset: sgdReader._nextUint32(),\n\t\t\talphaSliceByteLength: sgdReader._nextUint32(),\n\t\t});\n\t}\n\n\tconst endpointsByteOffset = sgdByteOffset + sgdReader._offset;\n\tconst selectorsByteOffset = endpointsByteOffset + endpointsByteLength;\n\tconst tablesByteOffset = selectorsByteOffset + selectorsByteLength;\n\tconst extendedByteOffset = tablesByteOffset + tablesByteLength;\n\n\tconst endpointsData = new Uint8Array(data.buffer, data.byteOffset + endpointsByteOffset, endpointsByteLength);\n\tconst selectorsData = new Uint8Array(data.buffer, data.byteOffset + selectorsByteOffset, selectorsByteLength);\n\tconst tablesData = new Uint8Array(data.buffer, data.byteOffset + tablesByteOffset, tablesByteLength);\n\tconst extendedData = new Uint8Array(data.buffer, data.byteOffset + extendedByteOffset, extendedByteLength);\n\n\tcontainer.globalData = {\n\t\tendpointCount,\n\t\tselectorCount,\n\t\timageDescs,\n\t\tendpointsData,\n\t\tselectorsData,\n\t\ttablesData,\n\t\textendedData,\n\t};\n\n\treturn container;\n}\n", "import { HEADER_BYTE_LENGTH, KTX2_ID, KTX_WRITER, NUL } from './constants-internal.js';\nimport {\n\tKHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT,\n\tKHR_DF_SAMPLE_DATATYPE_SIGNED,\n\tKHR_SUPERCOMPRESSION_NONE,\n} from './constants.js';\nimport type { KTX2Container } from './container.js';\nimport { concat, encodeText, getBlockByteLength, getPadding, leastCommonMultiple } from './util.js';\n\ninterface WriteOptions {\n\tkeepWriter?: boolean;\n}\nconst DEFAULT_OPTIONS: WriteOptions = { keepWriter: false };\n\n/**\n * Serializes a {@link KTX2Container} instance to a KTX 2.0 file. Mip levels and other binary data\n * are copied into the resulting Uint8Array, so the original container can safely be edited or\n * destroyed after it is serialized.\n *\n * Options:\n * - keepWriter: If true, 'KTXWriter' key/value field is written as provided by the container.\n * \t\tOtherwise, a string for the current ktx-parse version is generated. Default: false.\n *\n * @param container\n * @param options\n */\nexport function write(container: KTX2Container, options: WriteOptions = {}): Uint8Array {\n\t// biome-ignore lint/style/noParameterAssign: Merging defaults only.\n\toptions = { ...DEFAULT_OPTIONS, ...options };\n\n\t///////////////////////////////////////////////////\n\t// Supercompression Global Data (SGD).\n\t///////////////////////////////////////////////////\n\n\tlet sgdBuffer = new ArrayBuffer(0);\n\tif (container.globalData) {\n\t\tconst sgdHeaderBuffer = new ArrayBuffer(20 + container.globalData.imageDescs.length * 5 * 4);\n\t\tconst sgdHeaderView = new DataView(sgdHeaderBuffer);\n\t\tsgdHeaderView.setUint16(0, container.globalData.endpointCount, true);\n\t\tsgdHeaderView.setUint16(2, container.globalData.selectorCount, true);\n\t\tsgdHeaderView.setUint32(4, container.globalData.endpointsData.byteLength, true);\n\t\tsgdHeaderView.setUint32(8, container.globalData.selectorsData.byteLength, true);\n\t\tsgdHeaderView.setUint32(12, container.globalData.tablesData.byteLength, true);\n\t\tsgdHeaderView.setUint32(16, container.globalData.extendedData.byteLength, true);\n\n\t\tfor (let i = 0; i < container.globalData.imageDescs.length; i++) {\n\t\t\tconst imageDesc = container.globalData.imageDescs[i];\n\t\t\tsgdHeaderView.setUint32(20 + i * 5 * 4 + 0, imageDesc.imageFlags, true);\n\t\t\tsgdHeaderView.setUint32(20 + i * 5 * 4 + 4, imageDesc.rgbSliceByteOffset, true);\n\t\t\tsgdHeaderView.setUint32(20 + i * 5 * 4 + 8, imageDesc.rgbSliceByteLength, true);\n\t\t\tsgdHeaderView.setUint32(20 + i * 5 * 4 + 12, imageDesc.alphaSliceByteOffset, true);\n\t\t\tsgdHeaderView.setUint32(20 + i * 5 * 4 + 16, imageDesc.alphaSliceByteLength, true);\n\t\t}\n\n\t\tsgdBuffer = concat([\n\t\t\tsgdHeaderBuffer,\n\t\t\tcontainer.globalData.endpointsData,\n\t\t\tcontainer.globalData.selectorsData,\n\t\t\tcontainer.globalData.tablesData,\n\t\t\tcontainer.globalData.extendedData,\n\t\t]);\n\t}\n\n\t///////////////////////////////////////////////////\n\t// Key/Value Data (KVD).\n\t///////////////////////////////////////////////////\n\n\tconst keyValueData: Uint8Array[] = [];\n\tconst keyValueList = Object.entries({\n\t\t...container.keyValue,\n\t\t...(!options.keepWriter && { KTXwriter: KTX_WRITER }),\n\t});\n\n\tkeyValueList.sort((a, b) => (a[0] > b[0] ? 1 : -1));\n\n\tfor (const [key, value] of keyValueList) {\n\t\tconst keyData = encodeText(key);\n\t\tconst valueData = typeof value === 'string' ? concat([encodeText(value), NUL]) : value;\n\t\tconst kvByteLength = keyData.byteLength + 1 + valueData.byteLength;\n\t\tconst kvPadding = getPadding(kvByteLength, 4); // align(4)\n\t\tkeyValueData.push(\n\t\t\tconcat([\n\t\t\t\tnew Uint32Array([kvByteLength]),\n\t\t\t\tkeyData,\n\t\t\t\tNUL,\n\t\t\t\tvalueData,\n\t\t\t\tnew Uint8Array(kvPadding).fill(0x00), // align(4)\n\t\t\t]),\n\t\t);\n\t}\n\n\tconst kvdBuffer = concat(keyValueData);\n\n\t///////////////////////////////////////////////////\n\t// Data Format Descriptor (DFD).\n\t///////////////////////////////////////////////////\n\n\tif (\n\t\tcontainer.dataFormatDescriptor.length !== 1 ||\n\t\tcontainer.dataFormatDescriptor[0].descriptorType !== KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT\n\t) {\n\t\tthrow new Error('Only BASICFORMAT Data Format Descriptor output supported.');\n\t}\n\n\tconst dfd = container.dataFormatDescriptor[0];\n\n\tconst dfdBuffer = new ArrayBuffer(28 + dfd.samples.length * 16);\n\tconst dfdView = new DataView(dfdBuffer);\n\tconst descriptorBlockSize = 24 + dfd.samples.length * 16;\n\n\tdfdView.setUint32(0, dfdBuffer.byteLength, true);\n\tdfdView.setUint16(4, dfd.vendorId, true);\n\tdfdView.setUint16(6, dfd.descriptorType, true);\n\tdfdView.setUint16(8, dfd.versionNumber, true);\n\tdfdView.setUint16(10, descriptorBlockSize, true);\n\n\tdfdView.setUint8(12, dfd.colorModel);\n\tdfdView.setUint8(13, dfd.colorPrimaries);\n\tdfdView.setUint8(14, dfd.transferFunction);\n\tdfdView.setUint8(15, dfd.flags);\n\n\tif (!Array.isArray(dfd.texelBlockDimension)) {\n\t\tthrow new Error('texelBlockDimension is now an array. For dimensionality `d`, set `d - 1`.');\n\t}\n\n\tdfdView.setUint8(16, dfd.texelBlockDimension[0]);\n\tdfdView.setUint8(17, dfd.texelBlockDimension[1]);\n\tdfdView.setUint8(18, dfd.texelBlockDimension[2]);\n\tdfdView.setUint8(19, dfd.texelBlockDimension[3]);\n\n\tfor (let i = 0; i < 8; i++) dfdView.setUint8(20 + i, dfd.bytesPlane[i]);\n\n\tfor (let i = 0; i < dfd.samples.length; i++) {\n\t\tconst sample = dfd.samples[i];\n\t\tconst sampleByteOffset = 28 + i * 16;\n\n\t\tdfdView.setUint16(sampleByteOffset + 0, sample.bitOffset, true);\n\t\tdfdView.setUint8(sampleByteOffset + 2, sample.bitLength);\n\t\tdfdView.setUint8(sampleByteOffset + 3, sample.channelType);\n\n\t\tdfdView.setUint8(sampleByteOffset + 4, sample.samplePosition[0]);\n\t\tdfdView.setUint8(sampleByteOffset + 5, sample.samplePosition[1]);\n\t\tdfdView.setUint8(sampleByteOffset + 6, sample.samplePosition[2]);\n\t\tdfdView.setUint8(sampleByteOffset + 7, sample.samplePosition[3]);\n\n\t\tif (sample.channelType & KHR_DF_SAMPLE_DATATYPE_SIGNED) {\n\t\t\tdfdView.setInt32(sampleByteOffset + 8, sample.sampleLower, true);\n\t\t\tdfdView.setInt32(sampleByteOffset + 12, sample.sampleUpper, true);\n\t\t} else {\n\t\t\tdfdView.setUint32(sampleByteOffset + 8, sample.sampleLower, true);\n\t\t\tdfdView.setUint32(sampleByteOffset + 12, sample.sampleUpper, true);\n\t\t}\n\t}\n\n\t///////////////////////////////////////////////////\n\t// Data alignment.\n\t///////////////////////////////////////////////////\n\n\tconst dfdByteOffset = KTX2_ID.length + HEADER_BYTE_LENGTH + container.levels.length * 3 * 8;\n\tconst kvdByteOffset = dfdByteOffset + dfdBuffer.byteLength;\n\tlet sgdByteOffset = sgdBuffer.byteLength > 0 ? kvdByteOffset + kvdBuffer.byteLength : 0;\n\tif (sgdByteOffset % 8) sgdByteOffset += 8 - (sgdByteOffset % 8); // align(8)\n\n\t///////////////////////////////////////////////////\n\t// Level Index.\n\t///////////////////////////////////////////////////\n\n\tconst levelData: Uint8Array[] = [];\n\tconst levelIndex = new DataView(new ArrayBuffer(container.levels.length * 3 * 8));\n\tconst levelDataByteOffsets = new Uint32Array(container.levels.length);\n\n\tlet levelAlign = 0;\n\tif (container.supercompressionScheme === KHR_SUPERCOMPRESSION_NONE) {\n\t\tlevelAlign = leastCommonMultiple(getBlockByteLength(container), 4);\n\t}\n\n\t// Level data is ordered small → large.\n\tlet levelDataByteOffset = (sgdByteOffset || kvdByteOffset + kvdBuffer.byteLength) + sgdBuffer.byteLength;\n\tfor (let i = container.levels.length - 1; i >= 0; i--) {\n\t\t// Level padding.\n\t\tif (levelDataByteOffset % levelAlign) {\n\t\t\tconst paddingBytes = getPadding(levelDataByteOffset, levelAlign);\n\t\t\tlevelData.push(new Uint8Array(paddingBytes));\n\t\t\tlevelDataByteOffset += paddingBytes;\n\t\t}\n\n\t\t// Level data.\n\t\tconst level = container.levels[i];\n\t\tlevelData.push(level.levelData);\n\t\tlevelDataByteOffsets[i] = levelDataByteOffset;\n\t\tlevelDataByteOffset += level.levelData.byteLength;\n\t}\n\n\t// Level index is ordered large → small.\n\tfor (let i = 0; i < container.levels.length; i++) {\n\t\tconst level = container.levels[i];\n\t\tlevelIndex.setBigUint64(i * 24 + 0, BigInt(levelDataByteOffsets[i]), true);\n\t\tlevelIndex.setBigUint64(i * 24 + 8, BigInt(level.levelData.byteLength), true);\n\t\tlevelIndex.setBigUint64(i * 24 + 16, BigInt(level.uncompressedByteLength), true);\n\t}\n\n\t///////////////////////////////////////////////////\n\t// Header.\n\t///////////////////////////////////////////////////\n\n\tconst headerBuffer = new ArrayBuffer(HEADER_BYTE_LENGTH);\n\tconst headerView = new DataView(headerBuffer);\n\theaderView.setUint32(0, container.vkFormat, true);\n\theaderView.setUint32(4, container.typeSize, true);\n\theaderView.setUint32(8, container.pixelWidth, true);\n\theaderView.setUint32(12, container.pixelHeight, true);\n\theaderView.setUint32(16, container.pixelDepth, true);\n\theaderView.setUint32(20, container.layerCount, true);\n\theaderView.setUint32(24, container.faceCount, true);\n\theaderView.setUint32(28, container.levelCount, true);\n\theaderView.setUint32(32, container.supercompressionScheme, true);\n\n\theaderView.setUint32(36, dfdByteOffset, true);\n\theaderView.setUint32(40, dfdBuffer.byteLength, true);\n\theaderView.setUint32(44, kvdByteOffset, true);\n\theaderView.setUint32(48, kvdBuffer.byteLength, true);\n\theaderView.setBigUint64(52, BigInt(sgdBuffer.byteLength > 0 ? sgdByteOffset : 0), true);\n\theaderView.setBigUint64(60, BigInt(sgdBuffer.byteLength), true);\n\n\t///////////////////////////////////////////////////\n\t// Compose.\n\t///////////////////////////////////////////////////\n\n\treturn new Uint8Array(\n\t\tconcat([\n\t\t\tnew Uint8Array(KTX2_ID).buffer,\n\t\t\theaderBuffer,\n\t\t\tlevelIndex.buffer,\n\t\t\tdfdBuffer,\n\t\t\tkvdBuffer,\n\t\t\tsgdByteOffset > 0\n\t\t\t\t? new ArrayBuffer(sgdByteOffset - (kvdByteOffset + kvdBuffer.byteLength)) // align(8)\n\t\t\t\t: new ArrayBuffer(0),\n\t\t\tsgdBuffer,\n\t\t\t...levelData,\n\t\t]),\n\t);\n}\n", "export const EXT_MESH_GPU_INSTANCING = 'EXT_mesh_gpu_instancing';\nexport const EXT_MESHOPT_COMPRESSION = 'EXT_meshopt_compression';\nexport const EXT_TEXTURE_WEBP = 'EXT_texture_webp';\nexport const EXT_TEXTURE_AVIF = 'EXT_texture_avif';\nexport const KHR_DRACO_MESH_COMPRESSION = 'KHR_draco_mesh_compression';\nexport const KHR_LIGHTS_PUNCTUAL = 'KHR_lights_punctual';\nexport const KHR_MATERIALS_ANISOTROPY = 'KHR_materials_anisotropy';\nexport const KHR_MATERIALS_CLEARCOAT = 'KHR_materials_clearcoat';\nexport const KHR_MATERIALS_DIFFUSE_TRANSMISSION = 'KHR_materials_diffuse_transmission';\nexport const KHR_MATERIALS_DISPERSION = 'KHR_materials_dispersion';\nexport const KHR_MATERIALS_EMISSIVE_STRENGTH = 'KHR_materials_emissive_strength';\nexport const KHR_MATERIALS_IOR = 'KHR_materials_ior';\nexport const KHR_MATERIALS_IRIDESCENCE = 'KHR_materials_iridescence';\nexport const KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS = 'KHR_materials_pbrSpecularGlossiness';\nexport const KHR_MATERIALS_SHEEN = 'KHR_materials_sheen';\nexport const KHR_MATERIALS_SPECULAR = 'KHR_materials_specular';\nexport const KHR_MATERIALS_TRANSMISSION = 'KHR_materials_transmission';\nexport const KHR_MATERIALS_UNLIT = 'KHR_materials_unlit';\nexport const KHR_MATERIALS_VOLUME = 'KHR_materials_volume';\nexport const KHR_MATERIALS_VARIANTS = 'KHR_materials_variants';\nexport const KHR_MESH_QUANTIZATION = 'KHR_mesh_quantization';\nexport const KHR_TEXTURE_BASISU = 'KHR_texture_basisu';\nexport const KHR_TEXTURE_TRANSFORM = 'KHR_texture_transform';\nexport const KHR_XMP_JSON_LD = 'KHR_xmp_json_ld';\n", "import {\n\ttype Accessor,\n\tExtensionProperty,\n\ttype IProperty,\n\ttype Nullable,\n\tPropertyType,\n\tRefMap,\n} from '@gltf-transform/core';\nimport { EXT_MESH_GPU_INSTANCING } from '../constants.js';\n\ninterface IInstancedMesh extends IProperty {\n\tattributes: RefMap<Accessor>;\n}\n\n// See BufferViewUsage in `writer-context.ts`.\nexport const INSTANCE_ATTRIBUTE = 'INSTANCE_ATTRIBUTE';\n\n/**\n * Defines GPU instances of a {@link Mesh} under one {@link Node}. See {@link EXTMeshGPUInstancing}.\n */\nexport class InstancedMesh extends ExtensionProperty<IInstancedMesh> {\n\tpublic static EXTENSION_NAME: typeof EXT_MESH_GPU_INSTANCING = EXT_MESH_GPU_INSTANCING;\n\tpublic declare extensionName: typeof EXT_MESH_GPU_INSTANCING;\n\tpublic declare propertyType: 'InstancedMesh';\n\tpublic declare parentTypes: [PropertyType.NODE];\n\n\tprotected init(): void {\n\t\tthis.extensionName = EXT_MESH_GPU_INSTANCING;\n\t\tthis.propertyType = 'InstancedMesh';\n\t\tthis.parentTypes = [PropertyType.NODE];\n\t}\n\n\tprotected getDefaults(): Nullable<IInstancedMesh> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, { attributes: new RefMap<Accessor>() });\n\t}\n\n\t/** Returns an instance attribute as an {@link Accessor}. */\n\tpublic getAttribute(semantic: string): Accessor | null {\n\t\treturn this.getRefMap('attributes', semantic);\n\t}\n\n\t/**\n\t * Sets an instance attribute to an {@link Accessor}. All attributes must have the same\n\t * instance count.\n\t */\n\tpublic setAttribute(semantic: string, accessor: Accessor | null): this {\n\t\treturn this.setRefMap('attributes', semantic, accessor, { usage: INSTANCE_ATTRIBUTE });\n\t}\n\n\t/**\n\t * Lists all instance attributes {@link Accessor}s associated with the InstancedMesh. Order\n\t * will be consistent with the order returned by {@link .listSemantics}().\n\t */\n\tpublic listAttributes(): Accessor[] {\n\t\treturn this.listRefMapValues('attributes');\n\t}\n\n\t/**\n\t * Lists all instance attribute semantics associated with the primitive. Order will be\n\t * consistent with the order returned by {@link .listAttributes}().\n\t */\n\tpublic listSemantics(): string[] {\n\t\treturn this.listRefMapKeys('attributes');\n\t}\n}\n", "import { Extension, PropertyType, type ReaderContext, type WriterContext } from '@gltf-transform/core';\nimport { EXT_MESH_GPU_INSTANCING } from '../constants.js';\nimport { INSTANCE_ATTRIBUTE, InstancedMesh } from './instanced-mesh.js';\n\ninterface InstancedMeshDef {\n\tattributes: {\n\t\t[name: string]: number;\n\t};\n}\n\n/**\n * [`EXT_mesh_gpu_instancing`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing/)\n * prepares mesh data for efficient GPU instancing.\n *\n * GPU instancing allows engines to render many copies of a single mesh at once using a small number\n * of draw calls. Instancing is particularly useful for things like trees, grass, road signs, etc.\n * Keep in mind that predefined batches, as used in this extension, may prevent frustum culling\n * within a batch. Dividing batches into collocated cells may be preferable to using a single large\n * batch.\n *\n * > _**NOTICE:** While this extension stores mesh data optimized for GPU instancing, it\n * > is important to note that (1) GPU instancing and other optimizations are possible — and\n * > encouraged — even without this extension, and (2) other common meanings of the term\n * > \"instancing\" exist, distinct from this extension. See\n * > [Appendix: Motivation and Purpose](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing#appendix-motivation-and-purpose)\n * > of the `EXT_mesh_gpu_instancing` specification._\n *\n * Properties:\n * - {@link InstancedMesh}\n *\n * ### Example\n *\n * The `EXTMeshGPUInstancing` class provides a single {@link ExtensionProperty} type, `InstancedMesh`,\n * which may be attached to any {@link Node} instance. For example:\n *\n * ```typescript\n * import { EXTMeshGPUInstancing } from '@gltf-transform/extensions';\n *\n * // Create standard mesh, node, and scene hierarchy.\n * // ...\n *\n * // Assign positions for each instance.\n * const batchPositions = doc.createAccessor('instance_positions')\n * \t.setArray(new Float32Array([\n * \t\t0, 0, 0,\n * \t\t1, 0, 0,\n * \t\t2, 0, 0,\n * \t]))\n * \t.setType(Accessor.Type.VEC3)\n * \t.setBuffer(buffer);\n *\n * // Assign IDs for each instance.\n * const batchIDs = doc.createAccessor('instance_ids')\n * \t.setArray(new Uint8Array([0, 1, 2]))\n * \t.setType(Accessor.Type.SCALAR)\n * \t.setBuffer(buffer);\n *\n * // Create an Extension attached to the Document.\n * const batchExtension = document.createExtension(EXTMeshGPUInstancing)\n * \t.setRequired(true);\n * const batch = batchExtension.createInstancedMesh()\n * \t.setAttribute('TRANSLATION', batchPositions)\n * \t.setAttribute('_ID', batchIDs);\n *\n * node\n * \t.setMesh(mesh)\n * \t.setExtension('EXT_mesh_gpu_instancing', batch);\n * ```\n *\n * Standard instance attributes are `TRANSLATION`, `ROTATION`, and `SCALE`, and support the accessor\n * types allowed by the extension specification. Custom instance attributes are allowed, and should\n * be prefixed with an underscore (`_*`).\n */\nexport class EXTMeshGPUInstancing extends Extension {\n\tpublic readonly extensionName: typeof EXT_MESH_GPU_INSTANCING = EXT_MESH_GPU_INSTANCING;\n\t/** @hidden */\n\tpublic readonly provideTypes: PropertyType[] = [PropertyType.NODE];\n\t/** @hidden */\n\tpublic readonly prewriteTypes: PropertyType[] = [PropertyType.ACCESSOR];\n\tpublic static readonly EXTENSION_NAME: typeof EXT_MESH_GPU_INSTANCING = EXT_MESH_GPU_INSTANCING;\n\n\t/** Creates a new InstancedMesh property for use on a {@link Node}. */\n\tpublic createInstancedMesh(): InstancedMesh {\n\t\treturn new InstancedMesh(this.document.getGraph());\n\t}\n\n\t/** @hidden */\n\tpublic read(context: ReaderContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tconst nodeDefs = jsonDoc.json.nodes || [];\n\t\tnodeDefs.forEach((nodeDef, nodeIndex) => {\n\t\t\tif (!nodeDef.extensions || !nodeDef.extensions[EXT_MESH_GPU_INSTANCING]) return;\n\n\t\t\tconst instancedMeshDef = nodeDef.extensions[EXT_MESH_GPU_INSTANCING] as InstancedMeshDef;\n\t\t\tconst instancedMesh = this.createInstancedMesh();\n\n\t\t\tfor (const semantic in instancedMeshDef.attributes) {\n\t\t\t\tinstancedMesh.setAttribute(semantic, context.accessors[instancedMeshDef.attributes[semantic]]);\n\t\t\t}\n\n\t\t\tcontext.nodes[nodeIndex].setExtension(EXT_MESH_GPU_INSTANCING, instancedMesh);\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic prewrite(context: WriterContext): this {\n\t\t// Set usage for instance attribute accessors, so they are stored in separate buffer\n\t\t// views grouped by parent reference.\n\t\tcontext.accessorUsageGroupedByParent.add(INSTANCE_ATTRIBUTE);\n\t\tfor (const prop of this.properties) {\n\t\t\tfor (const attribute of (prop as InstancedMesh).listAttributes()) {\n\t\t\t\tcontext.addAccessorToUsageGroup(attribute, INSTANCE_ATTRIBUTE);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listNodes()\n\t\t\t.forEach((node) => {\n\t\t\t\tconst instancedMesh = node.getExtension<InstancedMesh>(EXT_MESH_GPU_INSTANCING);\n\t\t\t\tif (instancedMesh) {\n\t\t\t\t\tconst nodeIndex = context.nodeIndexMap.get(node)!;\n\t\t\t\t\tconst nodeDef = jsonDoc.json.nodes![nodeIndex];\n\n\t\t\t\t\tconst instancedMeshDef = { attributes: {} } as InstancedMeshDef;\n\n\t\t\t\t\tinstancedMesh.listSemantics().forEach((semantic) => {\n\t\t\t\t\t\tconst attribute = instancedMesh.getAttribute(semantic)!;\n\t\t\t\t\t\tinstancedMeshDef.attributes[semantic] = context.accessorIndexMap.get(attribute)!;\n\t\t\t\t\t});\n\n\t\t\t\t\tnodeDef.extensions = nodeDef.extensions || {};\n\t\t\t\t\tnodeDef.extensions[EXT_MESH_GPU_INSTANCING] = instancedMeshDef;\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n", "import type { GLTF, TypedArray } from '@gltf-transform/core';\n\nexport enum EncoderMethod {\n\tQUANTIZE = 'quantize',\n\tFILTER = 'filter',\n}\n\nexport interface MeshoptBufferExtension {\n\tfallback?: boolean;\n}\n\nexport enum MeshoptMode {\n\tATTRIBUTES = 'ATTRIBUTES',\n\tTRIANGLES = 'TRIANGLES',\n\tINDICES = 'INDICES',\n}\n\nexport enum MeshoptFilter {\n\t/** No filter — quantize only. */\n\tNONE = 'NONE',\n\t/** Four 8- or 16-bit normalized values. */\n\tOCTAHEDRAL = 'OCTAHEDRAL',\n\t/** Four 16-bit normalized values. */\n\tQUATERNION = 'QUATERNION',\n\t/** K single-precision floating point values. */\n\tEXPONENTIAL = 'EXPONENTIAL',\n}\n\nexport interface MeshoptBufferViewExtension {\n\tbuffer: number;\n\tbyteOffset: number;\n\tbyteLength: number;\n\tbyteStride: number;\n\tcount: number;\n\tmode: MeshoptMode;\n\tfilter?: MeshoptFilter;\n}\n\n/**\n * When using filters, the accessor definition written to the file will not necessarily have the\n * same properties as the input accessor. For example, octahedral encoding requires int8 or int16\n * output, so float32 input must be ignored.\n */\nexport interface PreparedAccessor {\n\tarray: TypedArray;\n\tbyteStride: number;\n\tnormalized: boolean;\n\tcomponentType: GLTF.AccessorComponentType;\n\tmin?: number[];\n\tmax?: number[];\n}\n", "import type { GLTF } from '@gltf-transform/core';\nimport { EXT_MESHOPT_COMPRESSION } from '../constants.js';\nimport type { MeshoptBufferExtension } from './constants.js';\n\n/**\n * Returns true for a fallback buffer, else false.\n *\n *   - All references to the fallback buffer must come from bufferViews that\n *     have a EXT_meshopt_compression extension specified.\n *   - No references to the fallback buffer may come from\n *     EXT_meshopt_compression extension JSON.\n */\nexport function isFallbackBuffer(bufferDef: GLTF.IBuffer): boolean {\n\tif (!bufferDef.extensions || !bufferDef.extensions[EXT_MESHOPT_COMPRESSION]) return false;\n\tconst fallbackDef = bufferDef.extensions[EXT_MESHOPT_COMPRESSION] as MeshoptBufferExtension;\n\treturn !!fallbackDef.fallback;\n}\n", "import {\n\tAccessor,\n\tAnimationChannel,\n\tAnimationSampler,\n\tBufferUtils,\n\ttype Document,\n\ttype GLTF,\n\tMathUtils,\n\tPrimitive,\n\tPropertyType,\n\tRoot,\n\ttype TypedArray,\n\ttype TypedArrayConstructor,\n\tWriterContext,\n} from '@gltf-transform/core';\nimport type { MeshoptEncoder } from 'meshoptimizer';\nimport { MeshoptFilter, MeshoptMode, type PreparedAccessor } from './constants.js';\n\nconst { BYTE, SHORT, FLOAT } = Accessor.ComponentType;\nconst { encodeNormalizedInt, decodeNormalizedInt } = MathUtils;\n\n/** Pre-processes array with required filters or padding. */\nexport function prepareAccessor(\n\taccessor: Accessor,\n\tencoder: typeof MeshoptEncoder,\n\tmode: MeshoptMode,\n\tfilterOptions: { filter: MeshoptFilter; bits?: number },\n): PreparedAccessor {\n\tconst { filter, bits } = filterOptions as { filter: MeshoptFilter; bits: number };\n\tconst result: PreparedAccessor = {\n\t\tarray: accessor.getArray()!,\n\t\tbyteStride: accessor.getElementSize() * accessor.getComponentSize(),\n\t\tcomponentType: accessor.getComponentType(),\n\t\tnormalized: accessor.getNormalized(),\n\t};\n\n\tif (mode !== MeshoptMode.ATTRIBUTES) return result;\n\n\tif (filter !== MeshoptFilter.NONE) {\n\t\tlet array = accessor.getNormalized() ? decodeNormalizedIntArray(accessor) : new Float32Array(result.array);\n\n\t\tswitch (filter) {\n\t\t\tcase MeshoptFilter.EXPONENTIAL: // → K single-precision floating point values.\n\t\t\t\tresult.byteStride = accessor.getElementSize() * 4;\n\t\t\t\tresult.componentType = FLOAT;\n\t\t\t\tresult.normalized = false;\n\t\t\t\tresult.array = encoder.encodeFilterExp(array, accessor.getCount(), result.byteStride, bits);\n\t\t\t\tbreak;\n\n\t\t\tcase MeshoptFilter.OCTAHEDRAL: // → four 8- or 16-bit normalized values.\n\t\t\t\tresult.byteStride = bits > 8 ? 8 : 4;\n\t\t\t\tresult.componentType = bits > 8 ? SHORT : BYTE;\n\t\t\t\tresult.normalized = true;\n\t\t\t\tarray = accessor.getElementSize() === 3 ? padNormals(array) : array;\n\t\t\t\tresult.array = encoder.encodeFilterOct(array, accessor.getCount(), result.byteStride, bits);\n\t\t\t\tbreak;\n\n\t\t\tcase MeshoptFilter.QUATERNION: // → four 16-bit normalized values.\n\t\t\t\tresult.byteStride = 8;\n\t\t\t\tresult.componentType = SHORT;\n\t\t\t\tresult.normalized = true;\n\t\t\t\tresult.array = encoder.encodeFilterQuat(array, accessor.getCount(), result.byteStride, bits);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Invalid filter.');\n\t\t}\n\n\t\tresult.min = accessor.getMin([]);\n\t\tresult.max = accessor.getMax([]);\n\t\tif (accessor.getNormalized()) {\n\t\t\tresult.min = result.min.map((v) => decodeNormalizedInt(v, accessor.getComponentType()));\n\t\t\tresult.max = result.max.map((v) => decodeNormalizedInt(v, accessor.getComponentType()));\n\t\t}\n\t\tif (result.normalized) {\n\t\t\tresult.min = result.min.map((v) => encodeNormalizedInt(v, result.componentType));\n\t\t\tresult.max = result.max.map((v) => encodeNormalizedInt(v, result.componentType));\n\t\t}\n\t} else if (result.byteStride % 4) {\n\t\tresult.array = padArrayElements(result.array, accessor.getElementSize());\n\t\tresult.byteStride = result.array.byteLength / accessor.getCount();\n\t}\n\n\treturn result;\n}\n\nfunction decodeNormalizedIntArray(attribute: Accessor): Float32Array {\n\tconst componentType = attribute.getComponentType();\n\tconst srcArray = attribute.getArray()!;\n\tconst dstArray = new Float32Array(srcArray.length);\n\tfor (let i = 0; i < srcArray.length; i++) {\n\t\tdstArray[i] = decodeNormalizedInt(srcArray[i], componentType);\n\t}\n\treturn dstArray;\n}\n\n/** Pads array to 4 byte alignment, required for Meshopt ATTRIBUTE buffer views. */\nexport function padArrayElements<T extends TypedArray>(srcArray: T, elementSize: number): T {\n\tconst byteStride = BufferUtils.padNumber(srcArray.BYTES_PER_ELEMENT * elementSize);\n\tconst elementStride = byteStride / srcArray.BYTES_PER_ELEMENT;\n\tconst elementCount = srcArray.length / elementSize;\n\n\tconst dstArray = new (srcArray.constructor as TypedArrayConstructor)(elementCount * elementStride) as T;\n\n\tfor (let i = 0; i * elementSize < srcArray.length; i++) {\n\t\tfor (let j = 0; j < elementSize; j++) {\n\t\t\tdstArray[i * elementStride + j] = srcArray[i * elementSize + j];\n\t\t}\n\t}\n\n\treturn dstArray;\n}\n\n/** Pad normals with a .w component for octahedral encoding. */\nfunction padNormals(srcArray: Float32Array): Float32Array {\n\tconst dstArray = new Float32Array((srcArray.length * 4) / 3);\n\tfor (let i = 0, il = srcArray.length / 3; i < il; i++) {\n\t\tdstArray[i * 4] = srcArray[i * 3];\n\t\tdstArray[i * 4 + 1] = srcArray[i * 3 + 1];\n\t\tdstArray[i * 4 + 2] = srcArray[i * 3 + 2];\n\t}\n\treturn dstArray;\n}\n\nexport function getMeshoptMode(accessor: Accessor, usage: string): MeshoptMode {\n\tif (usage === WriterContext.BufferViewUsage.ELEMENT_ARRAY_BUFFER) {\n\t\tconst isTriangles = accessor.listParents().some((parent) => {\n\t\t\treturn parent instanceof Primitive && parent.getMode() === Primitive.Mode.TRIANGLES;\n\t\t});\n\t\treturn isTriangles ? MeshoptMode.TRIANGLES : MeshoptMode.INDICES;\n\t}\n\n\treturn MeshoptMode.ATTRIBUTES;\n}\n\nexport function getMeshoptFilter(accessor: Accessor, doc: Document): { filter: MeshoptFilter; bits?: number } {\n\tconst refs = doc\n\t\t.getGraph()\n\t\t.listParentEdges(accessor)\n\t\t.filter((edge) => !(edge.getParent() instanceof Root));\n\n\tfor (const ref of refs) {\n\t\tconst refName = ref.getName();\n\t\tconst refKey = (ref.getAttributes().key || '') as string;\n\t\tconst isDelta = ref.getParent().propertyType === PropertyType.PRIMITIVE_TARGET;\n\n\t\t// Indices.\n\t\tif (refName === 'indices') return { filter: MeshoptFilter.NONE };\n\n\t\t// Attributes.\n\t\t//\n\t\t// NOTES:\n\t\t// - Vertex attributes should be filtered IFF they are _not_ quantized in\n\t\t//   'packages/cli/src/transforms/meshopt.ts'.\n\t\t// - POSITION and TEXCOORD_0 could use exponential filtering, but this produces broken\n\t\t//   output in some cases (e.g. Matilda.glb), for unknown reasons. gltfpack uses manual\n\t\t//   quantization for these attributes.\n\t\t// - NORMAL and TANGENT attributes use Octahedral filters, but deltas in morphs do not.\n\t\t// - When specifying bit depth for vertex attributes, check the defaults in `quantize.ts`\n\t\t//\t and overrides in `meshopt.ts`. Don't store deltas at higher precision than base.\n\t\tif (refName === 'attributes') {\n\t\t\tif (refKey === 'POSITION') return { filter: MeshoptFilter.NONE };\n\t\t\tif (refKey === 'TEXCOORD_0') return { filter: MeshoptFilter.NONE };\n\t\t\tif (refKey.startsWith('JOINTS_')) return { filter: MeshoptFilter.NONE };\n\t\t\tif (refKey.startsWith('WEIGHTS_')) return { filter: MeshoptFilter.NONE };\n\t\t\tif (refKey === 'NORMAL' || refKey === 'TANGENT') {\n\t\t\t\treturn isDelta ? { filter: MeshoptFilter.NONE } : { filter: MeshoptFilter.OCTAHEDRAL, bits: 8 };\n\t\t\t}\n\t\t}\n\n\t\t// Animation.\n\t\tif (refName === 'output') {\n\t\t\tconst targetPath = getTargetPath(accessor);\n\t\t\tif (targetPath === 'rotation') return { filter: MeshoptFilter.QUATERNION, bits: 16 };\n\t\t\tif (targetPath === 'translation') return { filter: MeshoptFilter.EXPONENTIAL, bits: 12 };\n\t\t\tif (targetPath === 'scale') return { filter: MeshoptFilter.EXPONENTIAL, bits: 12 };\n\t\t\treturn { filter: MeshoptFilter.NONE };\n\t\t}\n\n\t\t// See: https://github.com/donmccurdy/glTF-Transform/issues/489\n\t\tif (refName === 'input') return { filter: MeshoptFilter.NONE };\n\n\t\tif (refName === 'inverseBindMatrices') return { filter: MeshoptFilter.NONE };\n\t}\n\n\treturn { filter: MeshoptFilter.NONE };\n}\n\nexport function getTargetPath(accessor: Accessor): GLTF.AnimationChannelTargetPath | null {\n\tfor (const sampler of accessor.listParents()) {\n\t\tif (!(sampler instanceof AnimationSampler)) continue;\n\t\tfor (const channel of sampler.listParents()) {\n\t\t\tif (!(channel instanceof AnimationChannel)) continue;\n\t\t\treturn channel.getTargetPath();\n\t\t}\n\t}\n\treturn null;\n}\n", "import {\n\tAccessor,\n\ttype Buffer,\n\tBufferUtils,\n\tExtension,\n\tGLB_BUFFER,\n\ttype GLTF,\n\ttype Property,\n\tPropertyType,\n\ttype ReaderContext,\n\tWriterContext,\n} from '@gltf-transform/core';\nimport type { MeshoptDecoder, MeshoptEncoder } from 'meshoptimizer';\nimport { EXT_MESHOPT_COMPRESSION } from '../constants.js';\nimport { EncoderMethod, type MeshoptBufferViewExtension, MeshoptFilter } from './constants.js';\nimport { isFallbackBuffer } from './decoder.js';\nimport { getMeshoptFilter, getMeshoptMode, getTargetPath, prepareAccessor } from './encoder.js';\n\ninterface EncoderOptions {\n\tmethod?: EncoderMethod;\n}\n\nconst DEFAULT_ENCODER_OPTIONS: Required<EncoderOptions> = {\n\tmethod: EncoderMethod.QUANTIZE,\n};\n\ntype MeshoptBufferView = { extensions: { [EXT_MESHOPT_COMPRESSION]: MeshoptBufferViewExtension } };\ntype EncodedBufferView = GLTF.IBufferView & MeshoptBufferView;\n\n/**\n * [`EXT_meshopt_compression`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Vendor/EXT_meshopt_compression/)\n * provides compression and fast decoding for geometry, morph targets, and animations.\n *\n * Meshopt compression (based on the [meshoptimizer](https://github.com/zeux/meshoptimizer)\n * library) offers a lightweight decoder with very fast runtime decompression, and is\n * appropriate for models of any size. Meshopt can reduce the transmission sizes of geometry,\n * morph targets, animation, and other numeric data stored in buffer views. When textures are\n * large, other complementary compression methods should be used as well.\n *\n * For the full benefits of meshopt compression, **apply gzip, brotli, or another lossless\n * compression method** to the resulting .glb, .gltf, or .bin files. Meshopt specifically\n * pre-optimizes assets for this purpose — without this secondary compression, the size\n * reduction is considerably less.\n *\n * Be aware that decompression happens before uploading to the GPU. While Meshopt decoding is\n * considerably faster than Draco decoding, neither compression method will improve runtime\n * performance directly. To improve framerate, you'll need to simplify the geometry by reducing\n * vertex count or draw calls — not just compress it. Finally, be aware that Meshopt compression is\n * lossy: repeatedly compressing and decompressing a model in a pipeline will lose precision, so\n * compression should generally be the last stage of an art workflow, and uncompressed original\n * files should be kept.\n *\n * The meshoptimizer library ([github](https://github.com/zeux/meshoptimizer/tree/master/js),\n * [npm](https://www.npmjs.com/package/meshoptimizer)) is a required dependency for reading or\n * writing files, and must be provided by the application. Compression may alternatively be applied\n * with the [gltfpack](https://github.com/zeux/meshoptimizer/tree/master/gltf) tool.\n *\n * ### Example — Read\n *\n * To read glTF files using Meshopt compression, ensure that the extension\n * and a decoder are registered. Geometry and other data are decompressed\n * while reading the file.\n *\n * ```typescript\n * import { NodeIO } from '@gltf-transform/core';\n * import { EXTMeshoptCompression } from '@gltf-transform/extensions';\n * import { MeshoptDecoder } from 'meshoptimizer';\n *\n * await MeshoptDecoder.ready;\n *\n * const io = new NodeIO()\n * \t.registerExtensions([EXTMeshoptCompression])\n * \t.registerDependencies({ 'meshopt.decoder': MeshoptDecoder });\n *\n * // Read and decode.\n * const document = await io.read('compressed.glb');\n * ```\n *\n * ### Example — Write\n *\n * The simplest way to apply Meshopt compression is with the {@link meshopt}\n * transform. The extension and an encoder must be registered.\n *\n * ```typescript\n * import { NodeIO } from '@gltf-transform/core';\n * import { EXTMeshoptCompression } from '@gltf-transform/extensions';\n * import { meshopt } from '@gltf-transform/functions';\n * import { MeshoptEncoder } from 'meshoptimizer';\n *\n * await MeshoptEncoder.ready;\n *\n * const io = new NodeIO()\n * \t.registerExtensions([EXTMeshoptCompression])\n * \t.registerDependencies({ 'meshopt.encoder': MeshoptEncoder });\n *\n * await document.transform(\n *   meshopt({encoder: MeshoptEncoder, level: 'medium'})\n * );\n *\n * await io.write('compressed-medium.glb', document);\n * ```\n *\n * ### Example — Advanced\n *\n * Internally, the {@link meshopt} transform reorders and quantizes vertex data\n * to preparate for compression. If you prefer different pre-processing, the\n * EXTMeshoptCompression extension can be added to the document manually:\n *\n * ```typescript\n * import { reorder, quantize } from '@gltf-transform/functions';\n * import { EXTMeshoptCompression } from '@gltf-transform/extensions';\n * import { MeshoptEncoder } from 'meshoptimizer';\n *\n * await document.transform(\n * \treorder({encoder: MeshoptEncoder}),\n * \tquantize()\n * );\n *\n * document.createExtension(EXTMeshoptCompression)\n * \t.setRequired(true)\n * \t.setEncoderOptions({ method: EXTMeshoptCompression.EncoderMethod.QUANTIZE });\n * ```\n *\n * In either case, compression is deferred until generating output with an I/O\n * class.\n */\nexport class EXTMeshoptCompression extends Extension {\n\tpublic readonly extensionName: typeof EXT_MESHOPT_COMPRESSION = EXT_MESHOPT_COMPRESSION;\n\t/** @hidden */\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.BUFFER, PropertyType.PRIMITIVE];\n\t/** @hidden */\n\tpublic readonly prewriteTypes: PropertyType[] = [PropertyType.BUFFER, PropertyType.ACCESSOR];\n\t/** @hidden */\n\tpublic readonly readDependencies: string[] = ['meshopt.decoder'];\n\t/** @hidden */\n\tpublic readonly writeDependencies: string[] = ['meshopt.encoder'];\n\n\tpublic static readonly EXTENSION_NAME: typeof EXT_MESHOPT_COMPRESSION = EXT_MESHOPT_COMPRESSION;\n\tpublic static readonly EncoderMethod: typeof EncoderMethod = EncoderMethod;\n\n\tprivate _decoder: typeof MeshoptDecoder | null = null;\n\tprivate _decoderFallbackBufferMap = new Map<Buffer, Buffer>();\n\tprivate _encoder: typeof MeshoptEncoder | null = null;\n\tprivate _encoderOptions: Required<EncoderOptions> = DEFAULT_ENCODER_OPTIONS;\n\tprivate _encoderFallbackBuffer: Buffer | null = null;\n\tprivate _encoderBufferViews: { [key: string]: EncodedBufferView } = {};\n\tprivate _encoderBufferViewData: { [key: string]: Uint8Array[] } = {};\n\tprivate _encoderBufferViewAccessors: { [key: string]: GLTF.IAccessor[] } = {};\n\n\t/** @hidden */\n\tpublic install(key: string, dependency: unknown): this {\n\t\tif (key === 'meshopt.decoder') {\n\t\t\tthis._decoder = dependency as typeof MeshoptDecoder;\n\t\t}\n\t\tif (key === 'meshopt.encoder') {\n\t\t\tthis._encoder = dependency as typeof MeshoptEncoder;\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Configures Meshopt options for quality/compression tuning. The two methods rely on different\n\t * pre-processing before compression, and should be compared on the basis of (a) quality/loss\n\t * and (b) final asset size after _also_ applying a lossless compression such as gzip or brotli.\n\t *\n\t * - QUANTIZE: Default. Pre-process with {@link quantize quantize()} (lossy to specified\n\t * \tprecision) before applying lossless Meshopt compression. Offers a considerable compression\n\t * \tratio with or without further supercompression. Equivalent to `gltfpack -c`.\n\t * - FILTER: Pre-process with lossy filters to improve compression, before applying lossless\n\t *\tMeshopt compression. While output may initially be larger than with the QUANTIZE method,\n\t *\tthis method will benefit more from supercompression (e.g. gzip or brotli). Equivalent to\n\t * \t`gltfpack -cc`.\n\t *\n\t * Output with the FILTER method will generally be smaller after supercompression (e.g. gzip or\n\t * brotli) is applied, but may be larger than QUANTIZE output without it. Decoding is very fast\n\t * with both methods.\n\t *\n\t * Example:\n\t *\n\t * ```ts\n\t * import { EXTMeshoptCompression } from '@gltf-transform/extensions';\n\t *\n\t * doc.createExtension(EXTMeshoptCompression)\n\t * \t.setRequired(true)\n\t * \t.setEncoderOptions({\n\t * \t\tmethod: EXTMeshoptCompression.EncoderMethod.QUANTIZE\n\t * \t});\n\t * ```\n\t */\n\tpublic setEncoderOptions(options: EncoderOptions): this {\n\t\tthis._encoderOptions = { ...DEFAULT_ENCODER_OPTIONS, ...options };\n\t\treturn this;\n\t}\n\n\t/**********************************************************************************************\n\t * Decoding.\n\t */\n\n\t/** @internal Checks preconditions, decodes buffer views, and creates decoded primitives. */\n\tpublic preread(context: ReaderContext, propertyType: PropertyType): this {\n\t\tif (!this._decoder) {\n\t\t\tif (!this.isRequired()) return this;\n\t\t\tthrow new Error(`[${EXT_MESHOPT_COMPRESSION}] Please install extension dependency, \"meshopt.decoder\".`);\n\t\t}\n\t\tif (!this._decoder.supported) {\n\t\t\tif (!this.isRequired()) return this;\n\t\t\tthrow new Error(`[${EXT_MESHOPT_COMPRESSION}]: Missing WASM support.`);\n\t\t}\n\n\t\tif (propertyType === PropertyType.BUFFER) {\n\t\t\tthis._prereadBuffers(context);\n\t\t} else if (propertyType === PropertyType.PRIMITIVE) {\n\t\t\tthis._prereadPrimitives(context);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/** @internal Decode buffer views. */\n\tprivate _prereadBuffers(context: ReaderContext): void {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tconst viewDefs = jsonDoc.json.bufferViews || [];\n\t\tviewDefs.forEach((viewDef, index) => {\n\t\t\tif (!viewDef.extensions || !viewDef.extensions[EXT_MESHOPT_COMPRESSION]) return;\n\n\t\t\tconst meshoptDef = viewDef.extensions[EXT_MESHOPT_COMPRESSION] as MeshoptBufferViewExtension;\n\t\t\tconst byteOffset = meshoptDef.byteOffset || 0;\n\t\t\tconst byteLength = meshoptDef.byteLength || 0;\n\t\t\tconst count = meshoptDef.count;\n\t\t\tconst stride = meshoptDef.byteStride;\n\t\t\tconst result = new Uint8Array(count * stride);\n\n\t\t\tconst bufferDef = jsonDoc.json.buffers![meshoptDef.buffer];\n\t\t\t// TODO(cleanup): Should be encapsulated in writer-context.ts.\n\t\t\tconst resource = bufferDef.uri ? jsonDoc.resources[bufferDef.uri] : jsonDoc.resources[GLB_BUFFER];\n\t\t\tconst source = BufferUtils.toView(resource, byteOffset, byteLength);\n\n\t\t\tthis._decoder!.decodeGltfBuffer(result, count, stride, source, meshoptDef.mode, meshoptDef.filter);\n\n\t\t\tcontext.bufferViews[index] = result;\n\t\t});\n\t}\n\n\t/**\n\t * Mark fallback buffers and replacements.\n\t *\n\t * Note: Alignment with primitives is arbitrary; this just needs to happen\n\t * after Buffers have been parsed.\n\t * @internal\n\t */\n\tprivate _prereadPrimitives(context: ReaderContext): void {\n\t\tconst jsonDoc = context.jsonDoc;\n\t\tconst viewDefs = jsonDoc.json.bufferViews || [];\n\n\t\t//\n\t\tviewDefs.forEach((viewDef) => {\n\t\t\tif (!viewDef.extensions || !viewDef.extensions[EXT_MESHOPT_COMPRESSION]) return;\n\n\t\t\tconst meshoptDef = viewDef.extensions[EXT_MESHOPT_COMPRESSION] as MeshoptBufferViewExtension;\n\n\t\t\tconst buffer = context.buffers[meshoptDef.buffer];\n\t\t\tconst fallbackBuffer = context.buffers[viewDef.buffer];\n\t\t\tconst fallbackBufferDef = jsonDoc.json.buffers![viewDef.buffer];\n\t\t\tif (isFallbackBuffer(fallbackBufferDef)) {\n\t\t\t\tthis._decoderFallbackBufferMap.set(fallbackBuffer, buffer);\n\t\t\t}\n\t\t});\n\t}\n\n\t/** @hidden Removes Fallback buffers, if extension is required. */\n\tpublic read(_context: ReaderContext): this {\n\t\tif (!this.isRequired()) return this;\n\n\t\t// Replace fallback buffers.\n\t\tfor (const [fallbackBuffer, buffer] of this._decoderFallbackBufferMap) {\n\t\t\tfor (const parent of fallbackBuffer.listParents()) {\n\t\t\t\tif (parent instanceof Accessor) {\n\t\t\t\t\tparent.swap(fallbackBuffer, buffer);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfallbackBuffer.dispose();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**********************************************************************************************\n\t * Encoding.\n\t */\n\n\t/** @internal Claims accessors that can be compressed and writes compressed buffer views. */\n\tpublic prewrite(context: WriterContext, propertyType: PropertyType): this {\n\t\tif (propertyType === PropertyType.ACCESSOR) {\n\t\t\tthis._prewriteAccessors(context);\n\t\t} else if (propertyType === PropertyType.BUFFER) {\n\t\t\tthis._prewriteBuffers(context);\n\t\t}\n\t\treturn this;\n\t}\n\n\t/** @internal Claims accessors that can be compressed. */\n\tprivate _prewriteAccessors(context: WriterContext): void {\n\t\tconst json = context.jsonDoc.json;\n\t\tconst encoder = this._encoder!;\n\t\tconst options = this._encoderOptions;\n\t\tconst graph = this.document.getGraph();\n\n\t\tconst fallbackBuffer = this.document.createBuffer(); // Disposed on write.\n\t\tconst fallbackBufferIndex = this.document.getRoot().listBuffers().indexOf(fallbackBuffer);\n\n\t\tlet nextID = 1;\n\t\tconst parentToID = new Map<Property, number>();\n\t\tconst getParentID = (property: Property): number => {\n\t\t\tfor (const parent of graph.listParents(property)) {\n\t\t\t\tif (parent.propertyType === PropertyType.ROOT) continue;\n\t\t\t\tlet id = parentToID.get(property);\n\t\t\t\tif (id === undefined) parentToID.set(property, (id = nextID++));\n\t\t\t\treturn id;\n\t\t\t}\n\t\t\treturn -1;\n\t\t};\n\n\t\tthis._encoderFallbackBuffer = fallbackBuffer;\n\t\tthis._encoderBufferViews = {};\n\t\tthis._encoderBufferViewData = {};\n\t\tthis._encoderBufferViewAccessors = {};\n\n\t\tfor (const accessor of this.document.getRoot().listAccessors()) {\n\t\t\t// See: https://github.com/donmccurdy/glTF-Transform/pull/323#issuecomment-898791251\n\t\t\t// Example: https://skfb.ly/6qAD8\n\t\t\tif (getTargetPath(accessor) === 'weights') continue;\n\n\t\t\t// See: https://github.com/donmccurdy/glTF-Transform/issues/289\n\t\t\tif (accessor.getSparse()) continue;\n\n\t\t\tconst usage = context.getAccessorUsage(accessor);\n\t\t\tconst parentID = context.accessorUsageGroupedByParent.has(usage) ? getParentID(accessor) : null;\n\t\t\tconst mode = getMeshoptMode(accessor, usage);\n\t\t\tconst filter =\n\t\t\t\toptions.method === EncoderMethod.FILTER\n\t\t\t\t\t? getMeshoptFilter(accessor, this.document)\n\t\t\t\t\t: { filter: MeshoptFilter.NONE };\n\t\t\tconst preparedAccessor = prepareAccessor(accessor, encoder, mode, filter);\n\t\t\tconst { array, byteStride } = preparedAccessor;\n\n\t\t\tconst buffer = accessor.getBuffer();\n\t\t\tif (!buffer) throw new Error(`${EXT_MESHOPT_COMPRESSION}: Missing buffer for accessor.`);\n\t\t\tconst bufferIndex = this.document.getRoot().listBuffers().indexOf(buffer);\n\n\t\t\t// Buffer view grouping key.\n\t\t\tconst key = [usage, parentID, mode, filter.filter, byteStride, bufferIndex].join(':');\n\n\t\t\tlet bufferView = this._encoderBufferViews[key];\n\t\t\tlet bufferViewData = this._encoderBufferViewData[key];\n\t\t\tlet bufferViewAccessors = this._encoderBufferViewAccessors[key];\n\n\t\t\t// Write new buffer view, if needed.\n\t\t\tif (!bufferView || !bufferViewData) {\n\t\t\t\tbufferViewAccessors = this._encoderBufferViewAccessors[key] = [];\n\t\t\t\tbufferViewData = this._encoderBufferViewData[key] = [];\n\t\t\t\tbufferView = this._encoderBufferViews[key] = {\n\t\t\t\t\tbuffer: fallbackBufferIndex,\n\t\t\t\t\ttarget: WriterContext.USAGE_TO_TARGET[usage],\n\t\t\t\t\tbyteOffset: 0,\n\t\t\t\t\tbyteLength: 0,\n\t\t\t\t\tbyteStride: usage === WriterContext.BufferViewUsage.ARRAY_BUFFER ? byteStride : undefined,\n\t\t\t\t\textensions: {\n\t\t\t\t\t\t[EXT_MESHOPT_COMPRESSION]: {\n\t\t\t\t\t\t\tbuffer: bufferIndex,\n\t\t\t\t\t\t\tbyteOffset: 0,\n\t\t\t\t\t\t\tbyteLength: 0,\n\t\t\t\t\t\t\tmode: mode,\n\t\t\t\t\t\t\tfilter: filter.filter !== MeshoptFilter.NONE ? filter.filter : undefined,\n\t\t\t\t\t\t\tbyteStride: byteStride,\n\t\t\t\t\t\t\tcount: 0,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Write accessor.\n\t\t\tconst accessorDef = context.createAccessorDef(accessor);\n\t\t\taccessorDef.componentType = preparedAccessor.componentType;\n\t\t\taccessorDef.normalized = preparedAccessor.normalized;\n\t\t\taccessorDef.byteOffset = bufferView.byteLength;\n\t\t\tif (accessorDef.min && preparedAccessor.min) accessorDef.min = preparedAccessor.min;\n\t\t\tif (accessorDef.max && preparedAccessor.max) accessorDef.max = preparedAccessor.max;\n\t\t\tcontext.accessorIndexMap.set(accessor, json.accessors!.length);\n\t\t\tjson.accessors!.push(accessorDef);\n\t\t\tbufferViewAccessors.push(accessorDef);\n\n\t\t\t// Update buffer view.\n\t\t\tbufferViewData.push(new Uint8Array(array.buffer, array.byteOffset, array.byteLength));\n\t\t\tbufferView.byteLength += array.byteLength;\n\t\t\tbufferView.extensions.EXT_meshopt_compression.count += accessor.getCount();\n\t\t}\n\t}\n\n\t/** @internal Writes compressed buffer views. */\n\tprivate _prewriteBuffers(context: WriterContext): void {\n\t\tconst encoder = this._encoder!;\n\n\t\tfor (const key in this._encoderBufferViews) {\n\t\t\tconst bufferView = this._encoderBufferViews[key];\n\t\t\tconst bufferViewData = this._encoderBufferViewData[key];\n\t\t\tconst buffer = this.document.getRoot().listBuffers()[bufferView.extensions[EXT_MESHOPT_COMPRESSION].buffer];\n\t\t\tconst otherBufferViews = context.otherBufferViews.get(buffer) || [];\n\n\t\t\tconst { count, byteStride, mode } = bufferView.extensions[EXT_MESHOPT_COMPRESSION];\n\t\t\tconst srcArray = BufferUtils.concat(bufferViewData);\n\t\t\tconst dstArray = encoder.encodeGltfBuffer(srcArray, count, byteStride, mode);\n\t\t\tconst compressedData = BufferUtils.pad(dstArray);\n\n\t\t\tbufferView.extensions[EXT_MESHOPT_COMPRESSION].byteLength = dstArray.byteLength;\n\n\t\t\tbufferViewData.length = 0;\n\t\t\tbufferViewData.push(compressedData);\n\t\t\totherBufferViews.push(compressedData);\n\t\t\tcontext.otherBufferViews.set(buffer, otherBufferViews);\n\t\t}\n\t}\n\n\t/** @hidden Puts encoded data into glTF output. */\n\tpublic write(context: WriterContext): this {\n\t\tlet fallbackBufferByteOffset = 0;\n\n\t\t// Write final encoded buffer view properties.\n\t\tfor (const key in this._encoderBufferViews) {\n\t\t\tconst bufferView = this._encoderBufferViews[key];\n\t\t\tconst bufferViewData = this._encoderBufferViewData[key][0];\n\t\t\tconst bufferViewIndex = context.otherBufferViewsIndexMap.get(bufferViewData)!;\n\n\t\t\tconst bufferViewAccessors = this._encoderBufferViewAccessors[key];\n\t\t\tfor (const accessorDef of bufferViewAccessors) {\n\t\t\t\taccessorDef.bufferView = bufferViewIndex;\n\t\t\t}\n\n\t\t\tconst finalBufferViewDef = context.jsonDoc.json.bufferViews![bufferViewIndex];\n\t\t\tconst compressedByteOffset = finalBufferViewDef.byteOffset || 0;\n\n\t\t\tObject.assign(finalBufferViewDef, bufferView);\n\t\t\tfinalBufferViewDef.byteOffset = fallbackBufferByteOffset;\n\t\t\tconst bufferViewExtensionDef = finalBufferViewDef.extensions![\n\t\t\t\tEXT_MESHOPT_COMPRESSION\n\t\t\t] as MeshoptBufferViewExtension;\n\t\t\tbufferViewExtensionDef.byteOffset = compressedByteOffset;\n\n\t\t\tfallbackBufferByteOffset += BufferUtils.padNumber(bufferView.byteLength);\n\t\t}\n\n\t\t// Write final fallback buffer.\n\t\tconst fallbackBuffer = this._encoderFallbackBuffer!;\n\t\tconst fallbackBufferIndex = context.bufferIndexMap.get(fallbackBuffer)!;\n\t\tconst fallbackBufferDef = context.jsonDoc.json.buffers![fallbackBufferIndex];\n\t\tfallbackBufferDef.byteLength = fallbackBufferByteOffset;\n\t\tfallbackBufferDef.extensions = { [EXT_MESHOPT_COMPRESSION]: { fallback: true } };\n\t\tfallbackBuffer.dispose();\n\n\t\treturn this;\n\t}\n}\n", "import {\n\tBufferUtils,\n\tExtension,\n\tImageUtils,\n\ttype ImageUtilsFormat,\n\tPropertyType,\n\ttype ReaderContext,\n\ttype vec2,\n\ttype WriterContext,\n} from '@gltf-transform/core';\nimport { EXT_TEXTURE_AVIF } from '../constants.js';\n\nclass AVIFImageUtils implements ImageUtilsFormat {\n\tmatch(array: Uint8Array): boolean {\n\t\treturn array.length >= 12 && BufferUtils.decodeText(array.slice(4, 12)) === 'ftypavif';\n\t}\n\t/**\n\t * Probes size of AVIF or HEIC image. Assumes a single static image, without\n\t * orientation or other metadata that would affect dimensions.\n\t */\n\tgetSize(array: Uint8Array): vec2 | null {\n\t\tif (!this.match(array)) return null;\n\n\t\t// References:\n\t\t// - https://stackoverflow.com/questions/66222773/how-to-get-image-dimensions-from-an-avif-file\n\t\t// - https://github.com/nodeca/probe-image-size/blob/master/lib/parse_sync/avif.js\n\n\t\tconst view = new DataView(array.buffer, array.byteOffset, array.byteLength);\n\n\t\tlet box = unbox(view, 0);\n\t\tif (!box) return null;\n\n\t\tlet offset = box.end;\n\t\twhile ((box = unbox(view, offset))) {\n\t\t\tif (box.type === 'meta') {\n\t\t\t\toffset = box.start + 4; // version + flags\n\t\t\t} else if (box.type === 'iprp' || box.type === 'ipco') {\n\t\t\t\toffset = box.start;\n\t\t\t} else if (box.type === 'ispe') {\n\t\t\t\treturn [view.getUint32(box.start + 4), view.getUint32(box.start + 8)];\n\t\t\t} else if (box.type === 'mdat') {\n\t\t\t\tbreak; // mdat should be last, unlikely to find metadata past here.\n\t\t\t} else {\n\t\t\t\toffset = box.end;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\tgetChannels(_buffer: Uint8Array): number {\n\t\treturn 4;\n\t}\n}\n\n/**\n * [`EXT_texture_avif`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_avif/)\n * enables AVIF images for any material texture.\n *\n * AVIF offers greatly reduced transmission size, but\n * [requires browser support](https://caniuse.com/avif). Like PNG and JPEG, an AVIF image is\n * *fully decompressed* when uploaded to the GPU, which increases upload time and GPU memory cost.\n * For seamless uploads and minimal GPU memory cost, it is necessary to use a GPU texture format\n * like Basis Universal, with the `KHR_texture_basisu` extension.\n *\n * Defining no {@link ExtensionProperty} types, this {@link Extension} is simply attached to the\n * {@link Document}, and affects the entire Document by allowing use of the `image/avif` MIME type\n * and passing AVIF image data to the {@link Texture.setImage} method. Without the Extension, the\n * same MIME types and image data would yield an invalid glTF document, under the stricter core glTF\n * specification.\n *\n * Properties:\n * - N/A\n *\n * ### Example\n *\n * ```typescript\n * import { TextureAVIF } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const avifExtension = document.createExtension(TextureAVIF)\n * \t.setRequired(true);\n * document.createTexture('MyAVIFTexture')\n * \t.setMimeType('image/avif')\n * \t.setImage(fs.readFileSync('my-texture.avif'));\n * ```\n *\n * AVIF conversion is not done automatically when adding the extension as shown above — you must\n * convert the image data first, then pass the `.avif` payload to {@link Texture.setImage}.\n *\n * When the `EXT_texture_avif` extension is added to a file by glTF-Transform, the extension should\n * always be required. This tool does not support writing assets that \"fall back\" to optional PNG or\n * JPEG image data.\n */\nexport class EXTTextureAVIF extends Extension {\n\tpublic readonly extensionName: typeof EXT_TEXTURE_AVIF = EXT_TEXTURE_AVIF;\n\t/** @hidden */\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.TEXTURE];\n\tpublic static readonly EXTENSION_NAME: typeof EXT_TEXTURE_AVIF = EXT_TEXTURE_AVIF;\n\n\t/** @hidden */\n\tpublic static register(): void {\n\t\tImageUtils.registerFormat('image/avif', new AVIFImageUtils());\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tconst textureDefs = context.jsonDoc.json.textures || [];\n\t\ttextureDefs.forEach((textureDef) => {\n\t\t\tif (textureDef.extensions && textureDef.extensions[EXT_TEXTURE_AVIF]) {\n\t\t\t\ttextureDef.source = (textureDef.extensions[EXT_TEXTURE_AVIF] as { source: number }).source;\n\t\t\t}\n\t\t});\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listTextures()\n\t\t\t.forEach((texture) => {\n\t\t\t\tif (texture.getMimeType() === 'image/avif') {\n\t\t\t\t\tconst imageIndex = context.imageIndexMap.get(texture);\n\t\t\t\t\tconst textureDefs = jsonDoc.json.textures || [];\n\t\t\t\t\ttextureDefs.forEach((textureDef) => {\n\t\t\t\t\t\tif (textureDef.source === imageIndex) {\n\t\t\t\t\t\t\ttextureDef.extensions = textureDef.extensions || {};\n\t\t\t\t\t\t\ttextureDef.extensions[EXT_TEXTURE_AVIF] = { source: textureDef.source };\n\t\t\t\t\t\t\tdelete textureDef.source;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n\ninterface IBox {\n\ttype: string;\n\tstart: number;\n\tend: number;\n}\n\nfunction unbox(data: DataView, offset: number): IBox | null {\n\tif (data.byteLength < 4 + offset) return null;\n\n\t// size includes first 4 bytes (length)\n\tconst size = data.getUint32(offset);\n\tif (data.byteLength < size + offset || size < 8) return null;\n\n\treturn {\n\t\ttype: BufferUtils.decodeText(new Uint8Array(data.buffer, data.byteOffset + offset + 4, 4)),\n\t\tstart: offset + 8,\n\t\tend: offset + size,\n\t};\n}\n", "import {\n\tBufferUtils,\n\tExtension,\n\tImageUtils,\n\ttype ImageUtilsFormat,\n\tPropertyType,\n\ttype ReaderContext,\n\ttype vec2,\n\ttype WriterContext,\n} from '@gltf-transform/core';\nimport { EXT_TEXTURE_WEBP } from '../constants.js';\n\nclass WEBPImageUtils implements ImageUtilsFormat {\n\tmatch(array: Uint8Array): boolean {\n\t\treturn array.length >= 12 && array[8] === 87 && array[9] === 69 && array[10] === 66 && array[11] === 80;\n\t}\n\tgetSize(array: Uint8Array): vec2 | null {\n\t\t// Reference: http://tools.ietf.org/html/rfc6386\n\t\tconst RIFF = BufferUtils.decodeText(array.slice(0, 4));\n\t\tconst WEBP = BufferUtils.decodeText(array.slice(8, 12));\n\t\tif (RIFF !== 'RIFF' || WEBP !== 'WEBP') return null;\n\n\t\tconst view = new DataView(array.buffer, array.byteOffset);\n\n\t\t// Reference: https://wiki.tcl-lang.org/page/Reading+WEBP+image+dimensions\n\t\tlet offset = 12;\n\t\twhile (offset < view.byteLength) {\n\t\t\tconst chunkId = BufferUtils.decodeText(\n\t\t\t\tnew Uint8Array([\n\t\t\t\t\tview.getUint8(offset),\n\t\t\t\t\tview.getUint8(offset + 1),\n\t\t\t\t\tview.getUint8(offset + 2),\n\t\t\t\t\tview.getUint8(offset + 3),\n\t\t\t\t]),\n\t\t\t);\n\t\t\tconst chunkByteLength = view.getUint32(offset + 4, true);\n\t\t\tif (chunkId === 'VP8 ') {\n\t\t\t\tconst width = view.getInt16(offset + 14, true) & 0x3fff;\n\t\t\t\tconst height = view.getInt16(offset + 16, true) & 0x3fff;\n\t\t\t\treturn [width, height];\n\t\t\t} else if (chunkId === 'VP8L') {\n\t\t\t\tconst b0 = view.getUint8(offset + 9);\n\t\t\t\tconst b1 = view.getUint8(offset + 10);\n\t\t\t\tconst b2 = view.getUint8(offset + 11);\n\t\t\t\tconst b3 = view.getUint8(offset + 12);\n\t\t\t\tconst width = 1 + (((b1 & 0x3f) << 8) | b0);\n\t\t\t\tconst height = 1 + (((b3 & 0xf) << 10) | (b2 << 2) | ((b1 & 0xc0) >> 6));\n\t\t\t\treturn [width, height];\n\t\t\t}\n\t\t\toffset += 8 + chunkByteLength + (chunkByteLength % 2);\n\t\t}\n\n\t\treturn null;\n\t}\n\tgetChannels(_buffer: Uint8Array): number {\n\t\treturn 4;\n\t}\n}\n\n/**\n * [`EXT_texture_webp`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp/)\n * enables WebP images for any material texture.\n *\n * WebP offers greatly reduced transmission size, but\n * [requires browser support](https://caniuse.com/webp). Like PNG and JPEG, a WebP image is\n * *fully decompressed* when uploaded to the GPU, which increases upload time and GPU memory cost.\n * For seamless uploads and minimal GPU memory cost, it is necessary to use a GPU texture format\n * like Basis Universal, with the `KHR_texture_basisu` extension.\n *\n * Defining no {@link ExtensionProperty} types, this {@link Extension} is simply attached to the\n * {@link Document}, and affects the entire Document by allowing use of the `image/webp` MIME type\n * and passing WebP image data to the {@link Texture.setImage} method. Without the Extension, the\n * same MIME types and image data would yield an invalid glTF document, under the stricter core glTF\n * specification.\n *\n * Properties:\n * - N/A\n *\n * ### Example\n *\n * ```typescript\n * import { EXTTextureWebP } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const webpExtension = document.createExtension(EXTTextureWebP)\n * \t.setRequired(true);\n * document.createTexture('MyWebPTexture')\n * \t.setMimeType('image/webp')\n * \t.setImage(fs.readFileSync('my-texture.webp'));\n * ```\n *\n * WebP conversion is not done automatically when adding the extension as shown above — you must\n * convert the image data first, then pass the `.webp` payload to {@link Texture.setImage}.\n *\n * When the `EXT_texture_webp` extension is added to a file by glTF-Transform, the extension should\n * always be required. This tool does not support writing assets that \"fall back\" to optional PNG or\n * JPEG image data.\n */\nexport class EXTTextureWebP extends Extension {\n\tpublic readonly extensionName: typeof EXT_TEXTURE_WEBP = EXT_TEXTURE_WEBP;\n\t/** @hidden */\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.TEXTURE];\n\tpublic static readonly EXTENSION_NAME: typeof EXT_TEXTURE_WEBP = EXT_TEXTURE_WEBP;\n\n\t/** @hidden */\n\tpublic static register(): void {\n\t\tImageUtils.registerFormat('image/webp', new WEBPImageUtils());\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tconst textureDefs = context.jsonDoc.json.textures || [];\n\t\ttextureDefs.forEach((textureDef) => {\n\t\t\tif (textureDef.extensions && textureDef.extensions[EXT_TEXTURE_WEBP]) {\n\t\t\t\ttextureDef.source = (textureDef.extensions[EXT_TEXTURE_WEBP] as { source: number }).source;\n\t\t\t}\n\t\t});\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listTextures()\n\t\t\t.forEach((texture) => {\n\t\t\t\tif (texture.getMimeType() === 'image/webp') {\n\t\t\t\t\tconst imageIndex = context.imageIndexMap.get(texture);\n\t\t\t\t\tconst textureDefs = jsonDoc.json.textures || [];\n\t\t\t\t\ttextureDefs.forEach((textureDef) => {\n\t\t\t\t\t\tif (textureDef.source === imageIndex) {\n\t\t\t\t\t\t\ttextureDef.extensions = textureDef.extensions || {};\n\t\t\t\t\t\t\ttextureDef.extensions[EXT_TEXTURE_WEBP] = { source: textureDef.source };\n\t\t\t\t\t\t\tdelete textureDef.source;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n", "import { Accessor, type GLTF, type TypedArray, type TypedArrayConstructor } from '@gltf-transform/core';\nimport type { Attribute, DataType, Decoder, DecoderModule, Mesh } from 'draco3dgltf';\nimport { KHR_DRACO_MESH_COMPRESSION } from '../constants.js';\n\nexport let decoderModule: DecoderModule;\n\n// Initialized when decoder module loads.\nlet COMPONENT_ARRAY: { [key: number]: TypedArrayConstructor };\nlet DATA_TYPE: { [key: number]: DataType };\n\nexport function decodeGeometry(decoder: Decoder, data: Uint8Array): Mesh {\n\tconst buffer = new decoderModule.DecoderBuffer();\n\ttry {\n\t\tbuffer.Init(data as unknown as Int8Array, data.length);\n\n\t\tconst geometryType = decoder.GetEncodedGeometryType(buffer);\n\t\tif (geometryType !== decoderModule.TRIANGULAR_MESH) {\n\t\t\tthrow new Error(`[${KHR_DRACO_MESH_COMPRESSION}] Unknown geometry type.`);\n\t\t}\n\n\t\tconst dracoMesh = new decoderModule.Mesh();\n\t\tconst status = decoder.DecodeBufferToMesh(buffer, dracoMesh);\n\n\t\tif (!status.ok() || dracoMesh.ptr === 0) {\n\t\t\tthrow new Error(`[${KHR_DRACO_MESH_COMPRESSION}] Decoding failure.`);\n\t\t}\n\n\t\treturn dracoMesh;\n\t} finally {\n\t\tdecoderModule.destroy(buffer);\n\t}\n}\n\nexport function decodeIndex(decoder: Decoder, mesh: Mesh): Uint16Array | Uint32Array {\n\tconst numFaces = mesh.num_faces();\n\tconst numIndices = numFaces * 3;\n\n\tlet ptr: number;\n\tlet indices: Uint16Array | Uint32Array;\n\n\tif (mesh.num_points() <= 65534) {\n\t\tconst byteLength = numIndices * Uint16Array.BYTES_PER_ELEMENT;\n\t\tptr = decoderModule._malloc(byteLength);\n\t\tdecoder.GetTrianglesUInt16Array(mesh, byteLength, ptr);\n\t\tindices = new Uint16Array(decoderModule.HEAPU16.buffer, ptr, numIndices).slice();\n\t} else {\n\t\tconst byteLength = numIndices * Uint32Array.BYTES_PER_ELEMENT;\n\t\tptr = decoderModule._malloc(byteLength);\n\t\tdecoder.GetTrianglesUInt32Array(mesh, byteLength, ptr);\n\t\tindices = new Uint32Array(decoderModule.HEAPU32.buffer, ptr, numIndices).slice();\n\t}\n\n\tdecoderModule._free(ptr);\n\n\treturn indices;\n}\n\nexport function decodeAttribute(\n\tdecoder: Decoder,\n\tmesh: Mesh,\n\tattribute: Attribute,\n\taccessorDef: GLTF.IAccessor,\n): TypedArray {\n\tconst dataType = DATA_TYPE[accessorDef.componentType];\n\tconst ArrayCtor = COMPONENT_ARRAY[accessorDef.componentType];\n\tconst numComponents = attribute.num_components();\n\tconst numPoints = mesh.num_points();\n\tconst numValues = numPoints * numComponents;\n\tconst byteLength: number = numValues * ArrayCtor.BYTES_PER_ELEMENT;\n\n\tconst ptr = decoderModule._malloc(byteLength);\n\tdecoder.GetAttributeDataArrayForAllPoints(mesh, attribute, dataType, byteLength, ptr);\n\tconst array: TypedArray = new ArrayCtor(decoderModule.HEAPF32.buffer, ptr, numValues).slice();\n\tdecoderModule._free(ptr);\n\n\treturn array;\n}\n\nexport function initDecoderModule(_decoderModule: DecoderModule): void {\n\tdecoderModule = _decoderModule;\n\n\tCOMPONENT_ARRAY = {\n\t\t[Accessor.ComponentType.FLOAT]: Float32Array,\n\t\t[Accessor.ComponentType.UNSIGNED_INT]: Uint32Array,\n\t\t[Accessor.ComponentType.UNSIGNED_SHORT]: Uint16Array,\n\t\t[Accessor.ComponentType.UNSIGNED_BYTE]: Uint8Array,\n\t\t[Accessor.ComponentType.SHORT]: Int16Array,\n\t\t[Accessor.ComponentType.BYTE]: Int8Array,\n\t};\n\n\tDATA_TYPE = {\n\t\t[Accessor.ComponentType.FLOAT]: decoderModule.DT_FLOAT32,\n\t\t[Accessor.ComponentType.UNSIGNED_INT]: decoderModule.DT_UINT32,\n\t\t[Accessor.ComponentType.UNSIGNED_SHORT]: decoderModule.DT_UINT16,\n\t\t[Accessor.ComponentType.UNSIGNED_BYTE]: decoderModule.DT_UINT8,\n\t\t[Accessor.ComponentType.SHORT]: decoderModule.DT_INT16,\n\t\t[Accessor.ComponentType.BYTE]: decoderModule.DT_INT8,\n\t};\n}\n", "import { Accessor, type bbox, type GLTF, type Primitive, type TypedArray } from '@gltf-transform/core';\nimport type { EncoderModule, Mesh, MeshBuilder } from 'draco3dgltf';\n\nexport let encoderModule: EncoderModule;\n\nexport enum EncoderMethod {\n\tEDGEBREAKER = 1,\n\tSEQUENTIAL = 0,\n}\n\nenum AttributeEnum {\n\tPOSITION = 'POSITION',\n\tNORMAL = 'NORMAL',\n\tCOLOR = 'COLOR',\n\tTEX_COORD = 'TEX_COORD',\n\tGENERIC = 'GENERIC',\n}\n\nconst DEFAULT_QUANTIZATION_BITS = {\n\t[AttributeEnum.POSITION]: 14,\n\t[AttributeEnum.NORMAL]: 10,\n\t[AttributeEnum.COLOR]: 8,\n\t[AttributeEnum.TEX_COORD]: 12,\n\t[AttributeEnum.GENERIC]: 12,\n};\n\nexport interface EncodedPrimitive {\n\tnumVertices: number;\n\tnumIndices: number;\n\tdata: Uint8Array;\n\tattributeIDs: { [key: string]: number };\n}\n\nexport interface EncoderOptions {\n\tdecodeSpeed?: number;\n\tencodeSpeed?: number;\n\tmethod?: EncoderMethod;\n\tquantizationBits?: { [key: string]: number };\n\tquantizationVolume?: 'mesh' | 'scene' | bbox;\n}\n\nconst DEFAULT_ENCODER_OPTIONS: EncoderOptions = {\n\tdecodeSpeed: 5,\n\tencodeSpeed: 5,\n\tmethod: EncoderMethod.EDGEBREAKER,\n\tquantizationBits: DEFAULT_QUANTIZATION_BITS,\n\tquantizationVolume: 'mesh',\n};\n\nexport function initEncoderModule(_encoderModule: EncoderModule): void {\n\tencoderModule = _encoderModule;\n}\n\n/**\n * References:\n * - https://github.com/mrdoob/three.js/blob/dev/examples/js/exporters/DRACOExporter.js\n * - https://github.com/CesiumGS/gltf-pipeline/blob/master/lib/compressDracoMeshes.js\n */\nexport function encodeGeometry(prim: Primitive, _options: EncoderOptions = DEFAULT_ENCODER_OPTIONS): EncodedPrimitive {\n\tconst options = { ...DEFAULT_ENCODER_OPTIONS, ..._options } as Required<EncoderOptions>;\n\toptions.quantizationBits = { ...DEFAULT_QUANTIZATION_BITS, ..._options.quantizationBits };\n\n\tconst builder = new encoderModule.MeshBuilder();\n\tconst mesh = new encoderModule.Mesh();\n\n\tconst encoder = new encoderModule.ExpertEncoder(mesh);\n\n\tconst attributeIDs: { [key: string]: number } = {};\n\tconst dracoBuffer = new encoderModule.DracoInt8Array();\n\n\tconst hasMorphTargets = prim.listTargets().length > 0;\n\tlet hasSparseAttributes = false;\n\n\tfor (const semantic of prim.listSemantics()) {\n\t\tconst attribute = prim.getAttribute(semantic)!;\n\n\t\tif (attribute.getSparse()) {\n\t\t\thasSparseAttributes = true;\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst attributeEnum = getAttributeEnum(semantic);\n\t\tconst attributeID: number = addAttribute(\n\t\t\tbuilder,\n\t\t\tattribute.getComponentType(),\n\t\t\tmesh,\n\t\t\tencoderModule[attributeEnum],\n\t\t\tattribute.getCount(),\n\t\t\tattribute.getElementSize(),\n\t\t\tattribute.getArray()!,\n\t\t);\n\n\t\tif (attributeID === -1) throw new Error(`Error compressing \"${semantic}\" attribute.`);\n\n\t\tattributeIDs[semantic] = attributeID;\n\t\tif (options.quantizationVolume === 'mesh' || semantic !== 'POSITION') {\n\t\t\tencoder.SetAttributeQuantization(attributeID, options.quantizationBits[attributeEnum]);\n\t\t} else if (typeof options.quantizationVolume === 'object') {\n\t\t\tconst { quantizationVolume } = options;\n\t\t\tconst range = Math.max(\n\t\t\t\tquantizationVolume.max[0] - quantizationVolume.min[0],\n\t\t\t\tquantizationVolume.max[1] - quantizationVolume.min[1],\n\t\t\t\tquantizationVolume.max[2] - quantizationVolume.min[2],\n\t\t\t);\n\t\t\tencoder.SetAttributeExplicitQuantization(\n\t\t\t\tattributeID,\n\t\t\t\toptions.quantizationBits[attributeEnum],\n\t\t\t\tattribute.getElementSize(),\n\t\t\t\tquantizationVolume.min,\n\t\t\t\trange,\n\t\t\t);\n\t\t} else {\n\t\t\tthrow new Error('Invalid quantization volume state.');\n\t\t}\n\t}\n\n\tconst indices = prim.getIndices();\n\tif (!indices) throw new EncodingError('Primitive must have indices.');\n\n\tbuilder.AddFacesToMesh(mesh, indices.getCount() / 3, indices.getArray() as unknown as Uint32Array);\n\n\tencoder.SetSpeedOptions(options.encodeSpeed, options.decodeSpeed);\n\tencoder.SetTrackEncodedProperties(true);\n\n\t// TODO(cleanup): Use edgebreaker without deduplication if possible.\n\t// See https://github.com/google/draco/issues/929.\n\tif (options.method === EncoderMethod.SEQUENTIAL || hasMorphTargets || hasSparseAttributes) {\n\t\tencoder.SetEncodingMethod(encoderModule.MESH_SEQUENTIAL_ENCODING);\n\t} else {\n\t\tencoder.SetEncodingMethod(encoderModule.MESH_EDGEBREAKER_ENCODING);\n\t}\n\n\t// Encode, preserving vertex order for primitives with morph targets and sparse accessors.\n\tconst byteLength = encoder.EncodeToDracoBuffer(!(hasMorphTargets || hasSparseAttributes), dracoBuffer);\n\tif (byteLength <= 0) throw new EncodingError('Error applying Draco compression.');\n\n\tconst data = new Uint8Array(byteLength);\n\tfor (let i = 0; i < byteLength; ++i) {\n\t\tdata[i] = dracoBuffer.GetValue(i);\n\t}\n\n\tconst numVertices = encoder.GetNumberOfEncodedPoints();\n\tconst numIndices = encoder.GetNumberOfEncodedFaces() * 3;\n\n\tencoderModule.destroy(dracoBuffer);\n\tencoderModule.destroy(mesh);\n\tencoderModule.destroy(builder);\n\tencoderModule.destroy(encoder);\n\n\treturn { numVertices, numIndices, data, attributeIDs };\n}\n\nfunction getAttributeEnum(semantic: string): AttributeEnum {\n\tif (semantic === 'POSITION') {\n\t\treturn AttributeEnum.POSITION;\n\t} else if (semantic === 'NORMAL') {\n\t\treturn AttributeEnum.NORMAL;\n\t} else if (semantic.startsWith('COLOR_')) {\n\t\treturn AttributeEnum.COLOR;\n\t} else if (semantic.startsWith('TEXCOORD_')) {\n\t\treturn AttributeEnum.TEX_COORD;\n\t}\n\treturn AttributeEnum.GENERIC;\n}\n\nfunction addAttribute(\n\tbuilder: MeshBuilder,\n\tcomponentType: GLTF.AccessorComponentType,\n\tmesh: Mesh,\n\tattribute: number,\n\tcount: number,\n\titemSize: number,\n\tarray: TypedArray,\n): number {\n\tswitch (componentType) {\n\t\tcase Accessor.ComponentType.UNSIGNED_BYTE:\n\t\t\treturn builder.AddUInt8Attribute(mesh, attribute, count, itemSize, array);\n\t\tcase Accessor.ComponentType.BYTE:\n\t\t\treturn builder.AddInt8Attribute(mesh, attribute, count, itemSize, array);\n\t\tcase Accessor.ComponentType.UNSIGNED_SHORT:\n\t\t\treturn builder.AddUInt16Attribute(mesh, attribute, count, itemSize, array);\n\t\tcase Accessor.ComponentType.SHORT:\n\t\t\treturn builder.AddInt16Attribute(mesh, attribute, count, itemSize, array);\n\t\tcase Accessor.ComponentType.UNSIGNED_INT:\n\t\t\treturn builder.AddUInt32Attribute(mesh, attribute, count, itemSize, array);\n\t\tcase Accessor.ComponentType.FLOAT:\n\t\t\treturn builder.AddFloatAttribute(mesh, attribute, count, itemSize, array);\n\t\tdefault:\n\t\t\tthrow new Error(`Unexpected component type, \"${componentType}\".`);\n\t}\n}\n\nexport class EncodingError extends Error {}\n", "import {\n\tAccessor,\n\tBufferUtils,\n\ttype bbox,\n\ttype Document,\n\tExtension,\n\tGLB_BUFFER,\n\tgetBounds,\n\tPrimitive,\n\tPropertyType,\n\ttype ReaderContext,\n\ttype WriterContext,\n} from '@gltf-transform/core';\nimport type { Decoder, DecoderModule, EncoderModule, Mesh } from 'draco3dgltf';\nimport { KHR_DRACO_MESH_COMPRESSION } from '../constants.js';\nimport { decodeAttribute, decodeGeometry, decodeIndex, initDecoderModule } from './decoder.js';\nimport {\n\ttype EncodedPrimitive,\n\tEncoderMethod,\n\ttype EncoderOptions,\n\tEncodingError,\n\tencodeGeometry,\n\tinitEncoderModule,\n} from './encoder.js';\n\ninterface DracoPrimitiveExtension {\n\tbufferView: number;\n\tattributes: {\n\t\t[name: string]: number;\n\t};\n}\n\ninterface DracoWriterContext {\n\tprimitiveHashMap: Map<Primitive, string>;\n\tprimitiveEncodingMap: Map<string, EncodedPrimitive>;\n}\n\n/**\n * [`KHR_draco_mesh_compression`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_draco_mesh_compression/)\n * provides advanced compression for mesh geometry.\n *\n * For models where geometry is a significant factor (>1 MB), Draco can reduce filesize by ~95%\n * in many cases. When animation or textures are large, other complementary compression methods\n * should be used as well. For geometry <1MB, the size of the WASM decoder library may outweigh\n * size savings.\n *\n * Be aware that decompression happens before uploading to the GPU — this will add some latency to\n * the parsing process, and means that compressing geometry with  Draco does _not_ affect runtime\n * performance. To improve framerate, you'll need to simplify the geometry by reducing vertex count\n * or draw calls — not just compress it. Finally, be aware that Draco compression is lossy:\n * repeatedly compressing and decompressing a model in a pipeline will lose precision, so\n * compression should generally be the last stage of an art workflow, and uncompressed original\n * files should be kept.\n *\n * A decoder or encoder from the `draco3dgltf` npm module for Node.js (or\n * [elsewhere for web](https://stackoverflow.com/a/66978236/1314762)) is required for reading and writing,\n * and must be provided by the application.\n *\n * ### Encoding options\n *\n * Two compression methods are available: 'edgebreaker' and 'sequential'. The\n * edgebreaker method will give higher compression in general, but changes the\n * order of the model's vertices. To preserve index order, use sequential\n * compression. When a mesh uses morph targets, or a high decoding speed is\n * selected, sequential compression will automatically be chosen.\n *\n * Both speed options affect the encoder's choice of algorithms. For example, a\n * requirement for fast decoding may prevent the encoder from using the best\n * compression methods even if the encoding speed is set to 0. In general, the\n * faster of the two options limits the choice of features that can be used by the\n * encoder. Setting --decodeSpeed to be faster than the --encodeSpeed may allow\n * the encoder to choose the optimal method out of the available features for the\n * given --decodeSpeed.\n *\n * ### Example — Read\n *\n * To read glTF files using Draco compression, ensure that the extension\n * and a decoder are registered. Geometry is decompressed while reading.\n *\n * ```typescript\n * import { NodeIO } from '@gltf-transform/core';\n * import { KHRDracoMeshCompression } from '@gltf-transform/extensions';\n * import draco3d from 'draco3dgltf';\n *\n * const io = new NodeIO()\n * \t.registerExtensions([KHRDracoMeshCompression])\n * \t.registerDependencies({\n * \t\t'draco3d.decoder': await draco3d.createDecoderModule()\n * \t});\n *\n * // Read and decode.\n * const document = await io.read('compressed.glb');\n * ```\n *\n * ### Example — Write\n *\n * The simplest way to apply Draco compression is with the {@link draco}\n * transform. The extension and an encoder must be registered.\n *\n * ```typescript\n * import { NodeIO } from '@gltf-transform/core';\n * import { KHRDracoMeshCompression } from '@gltf-transform/extensions';\n * import { draco } from '@gltf-transform/functions';\n * import draco3d from 'draco3dgltf';\n *\n * const io = new NodeIO()\n * \t.registerExtensions([KHRDracoMeshCompression])\n * \t.registerDependencies({\n * \t\t'draco3d.encoder': await draco3d.createEncoderModule()\n * \t});\n *\n * await document.transform(\n *   draco({method: 'edgebreaker'})\n * );\n *\n * await io.write('compressed.glb', document);\n * ```\n *\n * ### Example\n *\n * Equivalently, the KHRDracoMeshCompression extension can be added manually to a document.\n *\n * ```typescript\n * import { KHRDracoMeshCompression } from '@gltf-transform/extensions';\n *\n * document.createExtension(KHRDracoMeshCompression)\n * \t.setRequired(true)\n * \t.setEncoderOptions({\n * \t\tmethod: KHRDracoMeshCompression.EncoderMethod.EDGEBREAKER,\n * \t\tencodeSpeed: 5,\n * \t\tdecodeSpeed: 5,\n * \t});\n *\n * await io.write('compressed.glb', document);\n * ```\n *\n * In either case, Compression is deferred until generating output with an\n * I/O class.\n */\nexport class KHRDracoMeshCompression extends Extension {\n\tpublic readonly extensionName: typeof KHR_DRACO_MESH_COMPRESSION = KHR_DRACO_MESH_COMPRESSION;\n\t/** @hidden */\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.PRIMITIVE];\n\t/** @hidden */\n\tpublic readonly prewriteTypes: PropertyType[] = [PropertyType.ACCESSOR];\n\t/** @hidden */\n\tpublic readonly readDependencies: string[] = ['draco3d.decoder'];\n\t/** @hidden */\n\tpublic readonly writeDependencies: string[] = ['draco3d.encoder'];\n\n\tpublic static readonly EXTENSION_NAME: typeof KHR_DRACO_MESH_COMPRESSION = KHR_DRACO_MESH_COMPRESSION;\n\n\t/**\n\t * Compression method. `EncoderMethod.EDGEBREAKER` usually provides a higher compression ratio,\n\t * while `EncoderMethod.SEQUENTIAL` better preserves original vertex order.\n\t */\n\tpublic static readonly EncoderMethod: typeof EncoderMethod = EncoderMethod;\n\n\tprivate _decoderModule: DecoderModule | null = null;\n\tprivate _encoderModule: EncoderModule | null = null;\n\tprivate _encoderOptions: EncoderOptions = {};\n\n\t/** @hidden */\n\tpublic install(key: string, dependency: unknown): this {\n\t\tif (key === 'draco3d.decoder') {\n\t\t\tthis._decoderModule = dependency as DecoderModule;\n\t\t\tinitDecoderModule(this._decoderModule);\n\t\t}\n\t\tif (key === 'draco3d.encoder') {\n\t\t\tthis._encoderModule = dependency as EncoderModule;\n\t\t\tinitEncoderModule(this._encoderModule);\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Sets Draco compression options. Compression does not take effect until the Document is\n\t * written with an I/O class.\n\t *\n\t * Defaults:\n\t * ```\n\t * decodeSpeed?: number = 5;\n\t * encodeSpeed?: number = 5;\n\t * method?: EncoderMethod = EncoderMethod.EDGEBREAKER;\n\t * quantizationBits?: {[ATTRIBUTE_NAME]: bits};\n\t * quantizationVolume?: 'mesh' | 'scene' | bbox = 'mesh';\n\t * ```\n\t */\n\tpublic setEncoderOptions(options: EncoderOptions): this {\n\t\tthis._encoderOptions = options;\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tif (!this._decoderModule) {\n\t\t\tthrow new Error(`[${KHR_DRACO_MESH_COMPRESSION}] Please install extension dependency, \"draco3d.decoder\".`);\n\t\t}\n\n\t\tconst logger = this.document.getLogger();\n\t\tconst jsonDoc = context.jsonDoc;\n\t\tconst dracoMeshes: Map<number, [Decoder, Mesh]> = new Map();\n\n\t\ttry {\n\t\t\tconst meshDefs = jsonDoc.json.meshes || [];\n\t\t\tfor (const meshDef of meshDefs) {\n\t\t\t\tfor (const primDef of meshDef.primitives) {\n\t\t\t\t\tif (!primDef.extensions || !primDef.extensions[KHR_DRACO_MESH_COMPRESSION]) continue;\n\n\t\t\t\t\tconst dracoDef = primDef.extensions[KHR_DRACO_MESH_COMPRESSION] as DracoPrimitiveExtension;\n\t\t\t\t\tlet [decoder, dracoMesh] = dracoMeshes.get(dracoDef.bufferView) || [];\n\n\t\t\t\t\tif (!dracoMesh || !decoder) {\n\t\t\t\t\t\tconst bufferViewDef = jsonDoc.json.bufferViews![dracoDef.bufferView];\n\t\t\t\t\t\tconst bufferDef = jsonDoc.json.buffers![bufferViewDef.buffer];\n\t\t\t\t\t\t// TODO(cleanup): Should be encapsulated in writer-context.ts.\n\t\t\t\t\t\tconst resource = bufferDef.uri\n\t\t\t\t\t\t\t? jsonDoc.resources[bufferDef.uri]\n\t\t\t\t\t\t\t: jsonDoc.resources[GLB_BUFFER];\n\n\t\t\t\t\t\tconst byteOffset = bufferViewDef.byteOffset || 0;\n\t\t\t\t\t\tconst byteLength = bufferViewDef.byteLength;\n\t\t\t\t\t\tconst compressedData = BufferUtils.toView(resource, byteOffset, byteLength);\n\n\t\t\t\t\t\tdecoder = new this._decoderModule.Decoder();\n\t\t\t\t\t\tdracoMesh = decodeGeometry(decoder, compressedData);\n\t\t\t\t\t\tdracoMeshes.set(dracoDef.bufferView, [decoder, dracoMesh]);\n\t\t\t\t\t\tlogger.debug(\n\t\t\t\t\t\t\t`[${KHR_DRACO_MESH_COMPRESSION}] Decompressed ${compressedData.byteLength} bytes.`,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Attributes.\n\t\t\t\t\tfor (const semantic in dracoDef.attributes) {\n\t\t\t\t\t\tconst accessorDef = context.jsonDoc.json.accessors![primDef.attributes[semantic]];\n\t\t\t\t\t\tconst dracoAttribute = decoder.GetAttributeByUniqueId(dracoMesh, dracoDef.attributes[semantic]);\n\t\t\t\t\t\tconst attributeArray = decodeAttribute(decoder, dracoMesh, dracoAttribute, accessorDef);\n\t\t\t\t\t\tcontext.accessors[primDef.attributes[semantic]].setArray(attributeArray);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Indices. Optional, see https://github.com/google/draco/issues/720.\n\t\t\t\t\tif (primDef.indices !== undefined) {\n\t\t\t\t\t\tcontext.accessors[primDef.indices].setArray(decodeIndex(decoder, dracoMesh));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} finally {\n\t\t\tfor (const [decoder, dracoMesh] of Array.from(dracoMeshes.values())) {\n\t\t\t\tthis._decoderModule.destroy(decoder);\n\t\t\t\tthis._decoderModule.destroy(dracoMesh);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic prewrite(context: WriterContext, _propertyType: PropertyType): this {\n\t\tif (!this._encoderModule) {\n\t\t\tthrow new Error(`[${KHR_DRACO_MESH_COMPRESSION}] Please install extension dependency, \"draco3d.encoder\".`);\n\t\t}\n\n\t\tconst logger = this.document.getLogger();\n\t\tlogger.debug(`[${KHR_DRACO_MESH_COMPRESSION}] Compression options: ${JSON.stringify(this._encoderOptions)}`);\n\n\t\tconst primitiveHashMap = listDracoPrimitives(this.document);\n\t\tconst primitiveEncodingMap = new Map<string, EncodedPrimitive>();\n\n\t\tlet quantizationVolume: bbox | 'mesh' = 'mesh';\n\t\tif (this._encoderOptions.quantizationVolume === 'scene') {\n\t\t\tif (this.document.getRoot().listScenes().length !== 1) {\n\t\t\t\tlogger.warn(`[${KHR_DRACO_MESH_COMPRESSION}]: quantizationVolume=scene requires exactly 1 scene.`);\n\t\t\t} else {\n\t\t\t\tquantizationVolume = getBounds(this.document.getRoot().listScenes().pop()!);\n\t\t\t}\n\t\t}\n\n\t\tfor (const prim of Array.from(primitiveHashMap.keys())) {\n\t\t\tconst primHash = primitiveHashMap.get(prim);\n\t\t\tif (!primHash) throw new Error('Unexpected primitive.');\n\n\t\t\t// Reuse an existing EncodedPrimitive, if possible.\n\t\t\tif (primitiveEncodingMap.has(primHash)) {\n\t\t\t\tprimitiveEncodingMap.set(primHash, primitiveEncodingMap.get(primHash)!);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst indices = prim.getIndices()!; // Condition for listDracoPrimitives().\n\t\t\tconst accessorDefs = context.jsonDoc.json.accessors!;\n\n\t\t\t// Create a new EncodedPrimitive.\n\t\t\tlet encodedPrim: EncodedPrimitive;\n\t\t\ttry {\n\t\t\t\tencodedPrim = encodeGeometry(prim, { ...this._encoderOptions, quantizationVolume });\n\t\t\t} catch (e) {\n\t\t\t\tif (e instanceof EncodingError) {\n\t\t\t\t\tlogger.warn(`[${KHR_DRACO_MESH_COMPRESSION}]: ${e.message} Skipping primitive compression.`);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthrow e;\n\t\t\t}\n\n\t\t\tprimitiveEncodingMap.set(primHash, encodedPrim);\n\n\t\t\t// Create indices definition, update count.\n\t\t\tconst indicesDef = context.createAccessorDef(indices);\n\t\t\tindicesDef.count = encodedPrim.numIndices;\n\t\t\tcontext.accessorIndexMap.set(indices, accessorDefs.length);\n\t\t\taccessorDefs.push(indicesDef);\n\n\t\t\t// In rare cases Draco increases vertex count, requiring a larger index component type.\n\t\t\t// https://github.com/donmccurdy/glTF-Transform/issues/1370\n\t\t\tif (encodedPrim.numVertices > 65534 && Accessor.getComponentSize(indicesDef.componentType) <= 2) {\n\t\t\t\tindicesDef.componentType = Accessor.ComponentType.UNSIGNED_INT;\n\t\t\t} else if (encodedPrim.numVertices > 254 && Accessor.getComponentSize(indicesDef.componentType) <= 1) {\n\t\t\t\tindicesDef.componentType = Accessor.ComponentType.UNSIGNED_SHORT;\n\t\t\t}\n\n\t\t\t// Create attribute definitions, update count.\n\t\t\tfor (const semantic of prim.listSemantics()) {\n\t\t\t\tconst attribute = prim.getAttribute(semantic)!;\n\t\t\t\tif (encodedPrim.attributeIDs[semantic] === undefined) continue; // sparse\n\n\t\t\t\tconst attributeDef = context.createAccessorDef(attribute);\n\t\t\t\tattributeDef.count = encodedPrim.numVertices;\n\t\t\t\tcontext.accessorIndexMap.set(attribute, accessorDefs.length);\n\t\t\t\taccessorDefs.push(attributeDef);\n\t\t\t}\n\n\t\t\t// Map compressed buffer view to a Buffer.\n\t\t\tconst buffer = prim.getAttribute('POSITION')!.getBuffer() || this.document.getRoot().listBuffers()[0];\n\t\t\tif (!context.otherBufferViews.has(buffer)) context.otherBufferViews.set(buffer, []);\n\t\t\tcontext.otherBufferViews.get(buffer)!.push(encodedPrim.data);\n\t\t}\n\n\t\tlogger.debug(`[${KHR_DRACO_MESH_COMPRESSION}] Compressed ${primitiveHashMap.size} primitives.`);\n\n\t\tcontext.extensionData[KHR_DRACO_MESH_COMPRESSION] = {\n\t\t\tprimitiveHashMap,\n\t\t\tprimitiveEncodingMap,\n\t\t} as DracoWriterContext;\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(context: WriterContext): this {\n\t\tconst dracoContext: DracoWriterContext = context.extensionData[\n\t\t\tKHR_DRACO_MESH_COMPRESSION\n\t\t] as DracoWriterContext;\n\n\t\tfor (const mesh of this.document.getRoot().listMeshes()) {\n\t\t\tconst meshDef = context.jsonDoc.json.meshes![context.meshIndexMap.get(mesh)!];\n\t\t\tfor (let i = 0; i < mesh.listPrimitives().length; i++) {\n\t\t\t\tconst prim = mesh.listPrimitives()[i];\n\t\t\t\tconst primDef = meshDef.primitives[i];\n\n\t\t\t\tconst primHash = dracoContext.primitiveHashMap.get(prim);\n\t\t\t\tif (!primHash) continue;\n\n\t\t\t\tconst encodedPrim = dracoContext.primitiveEncodingMap.get(primHash)!;\n\t\t\t\tif (!encodedPrim) continue;\n\n\t\t\t\tprimDef.extensions = primDef.extensions || {};\n\t\t\t\tprimDef.extensions[KHR_DRACO_MESH_COMPRESSION] = {\n\t\t\t\t\tbufferView: context.otherBufferViewsIndexMap.get(encodedPrim.data),\n\t\t\t\t\tattributes: encodedPrim.attributeIDs,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// Omit the extension if nothing was compressed.\n\t\tif (!dracoContext.primitiveHashMap.size) {\n\t\t\tconst json = context.jsonDoc.json;\n\t\t\tjson.extensionsUsed = (json.extensionsUsed || []).filter((name) => name !== KHR_DRACO_MESH_COMPRESSION);\n\t\t\tjson.extensionsRequired = (json.extensionsRequired || []).filter(\n\t\t\t\t(name) => name !== KHR_DRACO_MESH_COMPRESSION,\n\t\t\t);\n\t\t}\n\n\t\treturn this;\n\t}\n}\n\n/**\n * Returns a list of Primitives compatible with Draco compression. If any required preconditions\n * fail, and would break assumptions required for compression, this function will throw an error.\n */\nfunction listDracoPrimitives(doc: Document): Map<Primitive, string> {\n\tconst logger = doc.getLogger();\n\tconst included = new Set<Primitive>();\n\tconst excluded = new Set<Primitive>();\n\n\tlet nonIndexed = 0;\n\tlet nonTriangles = 0;\n\n\t// Support compressing only indexed, mode=TRIANGLES primitives.\n\tfor (const mesh of doc.getRoot().listMeshes()) {\n\t\tfor (const prim of mesh.listPrimitives()) {\n\t\t\tif (!prim.getIndices()) {\n\t\t\t\texcluded.add(prim);\n\t\t\t\tnonIndexed++;\n\t\t\t} else if (prim.getMode() !== Primitive.Mode.TRIANGLES) {\n\t\t\t\texcluded.add(prim);\n\t\t\t\tnonTriangles++;\n\t\t\t} else {\n\t\t\t\tincluded.add(prim);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (nonIndexed > 0) {\n\t\tlogger.warn(\n\t\t\t`[${KHR_DRACO_MESH_COMPRESSION}] Skipping Draco compression of ${nonIndexed} non-indexed primitives.`,\n\t\t);\n\t}\n\tif (nonTriangles > 0) {\n\t\tlogger.warn(\n\t\t\t`[${KHR_DRACO_MESH_COMPRESSION}] Skipping Draco compression of ${nonTriangles} non-TRIANGLES primitives.`,\n\t\t);\n\t}\n\n\t// Create an Accessor->index mapping.\n\tconst accessors = doc.getRoot().listAccessors();\n\tconst accessorIndices = new Map<Accessor, number>();\n\tfor (let i = 0; i < accessors.length; i++) accessorIndices.set(accessors[i], i);\n\n\t// For each compressed Primitive, create a hash key identifying its accessors. Map each\n\t// compressed Primitive and Accessor to this hash key.\n\tconst includedAccessors = new Map<Accessor, string>();\n\tconst includedHashKeys = new Set<string>();\n\tconst primToHashKey = new Map<Primitive, string>();\n\tfor (const prim of Array.from(included)) {\n\t\tlet hashKey = createHashKey(prim, accessorIndices);\n\n\t\t// If accessors of an identical primitive have already been checked, we're done.\n\t\tif (includedHashKeys.has(hashKey)) {\n\t\t\tprimToHashKey.set(prim, hashKey);\n\t\t\tcontinue;\n\t\t}\n\n\t\t// If any accessors are already in use, but the same hashKey hasn't been written, then we\n\t\t// need to create copies of these accessors for the current encoded primitive. We can't\n\t\t// reuse the same compressed accessor for two encoded primitives, because Draco might\n\t\t// change the vertex count, change the vertex order, or cause other conflicts.\n\t\tif (includedAccessors.has(prim.getIndices()!)) {\n\t\t\tconst indices = prim.getIndices()!; // Condition for 'included' list.\n\t\t\tconst dstIndices = indices.clone();\n\t\t\taccessorIndices.set(dstIndices, doc.getRoot().listAccessors().length - 1);\n\t\t\tprim.swap(indices, dstIndices); // TODO(cleanup): I/O should not modify Document.\n\t\t}\n\t\tfor (const attribute of prim.listAttributes()) {\n\t\t\tif (includedAccessors.has(attribute)) {\n\t\t\t\tconst dstAttribute = attribute.clone();\n\t\t\t\taccessorIndices.set(dstAttribute, doc.getRoot().listAccessors().length - 1);\n\t\t\t\tprim.swap(attribute, dstAttribute); // TODO(cleanup): I/O should not modify Document.\n\t\t\t}\n\t\t}\n\n\t\t// With conflicts resolved, compute the hash key again.\n\t\thashKey = createHashKey(prim, accessorIndices);\n\n\t\t// Commit the primitive and its accessors to the hash key.\n\t\tincludedHashKeys.add(hashKey);\n\t\tprimToHashKey.set(prim, hashKey);\n\t\tincludedAccessors.set(prim.getIndices()!, hashKey);\n\t\tfor (const attribute of prim.listAttributes()) {\n\t\t\tincludedAccessors.set(attribute, hashKey);\n\t\t}\n\t}\n\n\t// For each compressed Accessor, ensure that it isn't used except by a Primitive.\n\tfor (const accessor of Array.from(includedAccessors.keys())) {\n\t\tconst parentTypes = new Set(accessor.listParents().map((prop) => prop.propertyType));\n\t\tif (parentTypes.size !== 2 || !parentTypes.has(PropertyType.PRIMITIVE) || !parentTypes.has(PropertyType.ROOT)) {\n\t\t\tthrow new Error(\n\t\t\t\t`[${KHR_DRACO_MESH_COMPRESSION}] Compressed accessors must only be used as indices or vertex attributes.`,\n\t\t\t);\n\t\t}\n\t}\n\n\t// For each compressed Primitive, ensure that Accessors are mapped only to the same hash key.\n\tfor (const prim of Array.from(included)) {\n\t\tconst hashKey = primToHashKey.get(prim);\n\t\tconst indices = prim.getIndices()!; // Condition for 'included' list.\n\t\tif (\n\t\t\tincludedAccessors.get(indices) !== hashKey ||\n\t\t\tprim.listAttributes().some((attr) => includedAccessors.get(attr) !== hashKey)\n\t\t) {\n\t\t\tthrow new Error(`[${KHR_DRACO_MESH_COMPRESSION}] Draco primitives must share all, or no, accessors.`);\n\t\t}\n\t}\n\n\t// For each excluded Primitive, ensure that no Accessors are compressed.\n\tfor (const prim of Array.from(excluded)) {\n\t\tconst indices = prim.getIndices()!; // Condition for 'included' list.\n\t\tif (includedAccessors.has(indices) || prim.listAttributes().some((attr) => includedAccessors.has(attr))) {\n\t\t\tthrow new Error(\n\t\t\t\t`[${KHR_DRACO_MESH_COMPRESSION}] Accessor cannot be shared by compressed and uncompressed primitives.`,\n\t\t\t);\n\t\t}\n\t}\n\n\treturn primToHashKey;\n}\n\nfunction createHashKey(prim: Primitive, indexMap: Map<Accessor, number>): string {\n\tconst hashElements = [];\n\tconst indices = prim.getIndices()!; // Condition for 'included' list.\n\n\thashElements.push(indexMap.get(indices));\n\tfor (const attribute of prim.listAttributes()) {\n\t\thashElements.push(indexMap.get(attribute));\n\t}\n\n\treturn hashElements.sort().join('|');\n}\n", "import { ExtensionProperty, type IProperty, type Nullable, PropertyType, type vec3 } from '@gltf-transform/core';\nimport { KHR_LIGHTS_PUNCTUAL } from '../constants.js';\n\ninterface ILight extends IProperty {\n\tcolor: vec3;\n\tintensity: number;\n\ttype: PunctualLightType;\n\trange: number | null;\n\tinnerConeAngle: number;\n\touterConeAngle: number;\n}\n\ntype PunctualLightType = 'point' | 'spot' | 'directional';\n\n/**\n * Defines a light attached to a {@link Node}. See {@link KHRLightsPunctual}.\n */\nexport class Light extends ExtensionProperty<ILight> {\n\tpublic static EXTENSION_NAME: typeof KHR_LIGHTS_PUNCTUAL = KHR_LIGHTS_PUNCTUAL;\n\tpublic declare extensionName: typeof KHR_LIGHTS_PUNCTUAL;\n\tpublic declare propertyType: 'Light';\n\tpublic declare parentTypes: [PropertyType.NODE];\n\n\t/**********************************************************************************************\n\t * CONSTANTS.\n\t */\n\n\tpublic static Type: Record<string, PunctualLightType> = {\n\t\tPOINT: 'point',\n\t\tSPOT: 'spot',\n\t\tDIRECTIONAL: 'directional',\n\t};\n\n\t/**********************************************************************************************\n\t * INSTANCE.\n\t */\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_LIGHTS_PUNCTUAL;\n\t\tthis.propertyType = 'Light';\n\t\tthis.parentTypes = [PropertyType.NODE];\n\t}\n\n\tprotected getDefaults(): Nullable<ILight> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\n\t\t\tcolor: [1, 1, 1] as vec3,\n\t\t\tintensity: 1,\n\t\t\ttype: Light.Type.POINT,\n\t\t\trange: null,\n\t\t\tinnerConeAngle: 0,\n\t\t\touterConeAngle: Math.PI / 4,\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * COLOR.\n\t */\n\n\t/** Light color; Linear-sRGB components. */\n\tpublic getColor(): vec3 {\n\t\treturn this.get('color');\n\t}\n\n\t/** Light color; Linear-sRGB components. */\n\tpublic setColor(color: vec3): this {\n\t\treturn this.set('color', color);\n\t}\n\n\t/**********************************************************************************************\n\t * INTENSITY.\n\t */\n\n\t/**\n\t * Brightness of light. Units depend on the type of light: point and spot lights use luminous\n\t * intensity in candela (lm/sr) while directional lights use illuminance in lux (lm/m2).\n\t */\n\tpublic getIntensity(): number {\n\t\treturn this.get('intensity');\n\t}\n\n\t/**\n\t * Brightness of light. Units depend on the type of light: point and spot lights use luminous\n\t * intensity in candela (lm/sr) while directional lights use illuminance in lux (lm/m2).\n\t */\n\tpublic setIntensity(intensity: number): this {\n\t\treturn this.set('intensity', intensity);\n\t}\n\n\t/**********************************************************************************************\n\t * TYPE.\n\t */\n\n\t/** Type. */\n\tpublic getType(): PunctualLightType {\n\t\treturn this.get('type');\n\t}\n\n\t/** Type. */\n\tpublic setType(type: PunctualLightType): this {\n\t\treturn this.set('type', type);\n\t}\n\n\t/**********************************************************************************************\n\t * RANGE.\n\t */\n\n\t/**\n\t * Hint defining a distance cutoff at which the light's intensity may be considered to have\n\t * reached zero. Supported only for point and spot lights. Must be > 0. When undefined, range\n\t * is assumed to be infinite.\n\t */\n\tpublic getRange(): number | null {\n\t\treturn this.get('range');\n\t}\n\n\t/**\n\t * Hint defining a distance cutoff at which the light's intensity may be considered to have\n\t * reached zero. Supported only for point and spot lights. Must be > 0. When undefined, range\n\t * is assumed to be infinite.\n\t */\n\tpublic setRange(range: number | null): this {\n\t\treturn this.set('range', range);\n\t}\n\n\t/**********************************************************************************************\n\t * SPOT LIGHT PROPERTIES\n\t */\n\n\t/**\n\t * Angle, in radians, from centre of spotlight where falloff begins. Must be >= 0 and\n\t * < outerConeAngle.\n\t */\n\tpublic getInnerConeAngle(): number {\n\t\treturn this.get('innerConeAngle');\n\t}\n\n\t/**\n\t * Angle, in radians, from centre of spotlight where falloff begins. Must be >= 0 and\n\t * < outerConeAngle.\n\t */\n\tpublic setInnerConeAngle(angle: number): this {\n\t\treturn this.set('innerConeAngle', angle);\n\t}\n\n\t/**\n\t * Angle, in radians, from centre of spotlight where falloff ends. Must be > innerConeAngle and\n\t * <= PI / 2.0.\n\t */\n\tpublic getOuterConeAngle(): number {\n\t\treturn this.get('outerConeAngle');\n\t}\n\n\t/**\n\t * Angle, in radians, from centre of spotlight where falloff ends. Must be > innerConeAngle and\n\t * <= PI / 2.0.\n\t */\n\tpublic setOuterConeAngle(angle: number): this {\n\t\treturn this.set('outerConeAngle', angle);\n\t}\n}\n", "import { Extension, MathUtils, type ReaderContext, type vec3, type WriterContext } from '@gltf-transform/core';\nimport { KHR_LIGHTS_PUNCTUAL } from '../constants.js';\nimport { Light } from './light.js';\n\ninterface LightsPunctualRootDef {\n\tlights?: LightDef[];\n}\n\ninterface LightsPunctualNodeDef {\n\tlight: number;\n}\n\ninterface LightDef {\n\tname?: string;\n\tcolor?: vec3;\n\tintensity?: number;\n\trange?: number;\n\ttype: 'spot' | 'point' | 'directional';\n\tspot?: {\n\t\tinnerConeAngle?: number;\n\t\touterConeAngle?: number;\n\t};\n}\n\n/**\n * [`KHR_lights_punctual`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_lights_punctual/) defines three \"punctual\" light types: directional, point and\n * spot.\n *\n * Punctual lights are parameterized, infinitely small points that emit light in\n * well-defined directions and intensities. Lights are referenced by nodes and inherit the transform\n * of that node.\n *\n * Properties:\n * - {@link Light}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRLightsPunctual, Light, LightType } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const lightsExtension = document.createExtension(KHRLightsPunctual);\n *\n * // Create a Light property.\n * const light = lightsExtension.createLight()\n *\t.setType(LightType.POINT)\n *\t.setIntensity(2.0)\n *\t.setColor([1.0, 0.0, 0.0]);\n *\n * // Attach the property to a Material.\n * node.setExtension('KHR_lights_punctual', light);\n * ```\n */\nexport class KHRLightsPunctual extends Extension {\n\tpublic readonly extensionName: typeof KHR_LIGHTS_PUNCTUAL = KHR_LIGHTS_PUNCTUAL;\n\tpublic static readonly EXTENSION_NAME: typeof KHR_LIGHTS_PUNCTUAL = KHR_LIGHTS_PUNCTUAL;\n\n\t/** Creates a new punctual Light property for use on a {@link Node}. */\n\tpublic createLight(name = ''): Light {\n\t\treturn new Light(this.document.getGraph(), name);\n\t}\n\n\t/** @hidden */\n\tpublic read(context: ReaderContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tif (!jsonDoc.json.extensions || !jsonDoc.json.extensions[KHR_LIGHTS_PUNCTUAL]) return this;\n\n\t\tconst rootDef = jsonDoc.json.extensions[KHR_LIGHTS_PUNCTUAL] as LightsPunctualRootDef;\n\t\tconst lightDefs = rootDef.lights || ([] as LightDef[]);\n\t\tconst lights = lightDefs.map((lightDef) => {\n\t\t\tconst light = this.createLight()\n\t\t\t\t.setName(lightDef.name || '')\n\t\t\t\t.setType(lightDef.type);\n\n\t\t\tif (lightDef.color !== undefined) light.setColor(lightDef.color);\n\t\t\tif (lightDef.intensity !== undefined) light.setIntensity(lightDef.intensity);\n\t\t\tif (lightDef.range !== undefined) light.setRange(lightDef.range);\n\n\t\t\tif (lightDef.spot?.innerConeAngle !== undefined) {\n\t\t\t\tlight.setInnerConeAngle(lightDef.spot.innerConeAngle);\n\t\t\t}\n\t\t\tif (lightDef.spot?.outerConeAngle !== undefined) {\n\t\t\t\tlight.setOuterConeAngle(lightDef.spot.outerConeAngle);\n\t\t\t}\n\n\t\t\treturn light;\n\t\t});\n\n\t\tjsonDoc.json.nodes!.forEach((nodeDef, nodeIndex) => {\n\t\t\tif (!nodeDef.extensions || !nodeDef.extensions[KHR_LIGHTS_PUNCTUAL]) return;\n\t\t\tconst lightNodeDef = nodeDef.extensions[KHR_LIGHTS_PUNCTUAL] as LightsPunctualNodeDef;\n\t\t\tcontext.nodes[nodeIndex].setExtension(KHR_LIGHTS_PUNCTUAL, lights[lightNodeDef.light]);\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tif (this.properties.size === 0) return this;\n\n\t\tconst lightDefs = [];\n\t\tconst lightIndexMap = new Map<Light, number>();\n\n\t\tfor (const property of this.properties) {\n\t\t\tconst light = property as Light;\n\t\t\tconst lightDef = { type: light.getType() } as LightDef;\n\n\t\t\tif (!MathUtils.eq(light.getColor(), [1, 1, 1])) lightDef.color = light.getColor();\n\t\t\tif (light.getIntensity() !== 1) lightDef.intensity = light.getIntensity();\n\t\t\tif (light.getRange() != null) lightDef.range = light.getRange()!;\n\n\t\t\tif (light.getName()) lightDef.name = light.getName();\n\n\t\t\tif (light.getType() === Light.Type.SPOT) {\n\t\t\t\tlightDef.spot = {\n\t\t\t\t\tinnerConeAngle: light.getInnerConeAngle(),\n\t\t\t\t\touterConeAngle: light.getOuterConeAngle(),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tlightDefs.push(lightDef);\n\t\t\tlightIndexMap.set(light, lightDefs.length - 1);\n\t\t}\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listNodes()\n\t\t\t.forEach((node) => {\n\t\t\t\tconst light = node.getExtension<Light>(KHR_LIGHTS_PUNCTUAL);\n\t\t\t\tif (light) {\n\t\t\t\t\tconst nodeIndex = context.nodeIndexMap.get(node)!;\n\t\t\t\t\tconst nodeDef = jsonDoc.json.nodes![nodeIndex];\n\t\t\t\t\tnodeDef.extensions = nodeDef.extensions || {};\n\t\t\t\t\tnodeDef.extensions[KHR_LIGHTS_PUNCTUAL] = { light: lightIndexMap.get(light) };\n\t\t\t\t}\n\t\t\t});\n\n\t\tjsonDoc.json.extensions = jsonDoc.json.extensions || {};\n\t\tjsonDoc.json.extensions[KHR_LIGHTS_PUNCTUAL] = { lights: lightDefs };\n\n\t\treturn this;\n\t}\n}\n", "import {\n\tExtensionProperty,\n\ttype IProperty,\n\ttype Nullable,\n\tPropertyType,\n\ttype Texture,\n\tTextureChannel,\n\tTextureInfo,\n} from '@gltf-transform/core';\nimport { KHR_MATERIALS_ANISOTROPY } from '../constants.js';\n\ninterface IAnisotropy extends IProperty {\n\tanisotropyStrength: number;\n\tanisotropyRotation: number;\n\tanisotropyTexture: Texture;\n\tanisotropyTextureInfo: TextureInfo;\n}\n\nconst { R, G, B } = TextureChannel;\n\n/**\n * Defines anisotropy (directionally-dependent reflections) on a PBR {@link Material}. See\n * {@link KHRMaterialsAnisotropy}.\n */\nexport class Anisotropy extends ExtensionProperty<IAnisotropy> {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_ANISOTROPY = KHR_MATERIALS_ANISOTROPY;\n\tpublic declare extensionName: typeof KHR_MATERIALS_ANISOTROPY;\n\tpublic declare propertyType: 'Anisotropy';\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_ANISOTROPY;\n\t\tthis.propertyType = 'Anisotropy';\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\n\t}\n\n\tprotected getDefaults(): Nullable<IAnisotropy> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\n\t\t\tanisotropyStrength: 0.0,\n\t\t\tanisotropyRotation: 0.0,\n\t\t\tanisotropyTexture: null,\n\t\t\tanisotropyTextureInfo: new TextureInfo(this.graph, 'anisotropyTextureInfo'),\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * Anisotropy strength.\n\t */\n\n\t/** Anisotropy strength. */\n\tpublic getAnisotropyStrength(): number {\n\t\treturn this.get('anisotropyStrength');\n\t}\n\n\t/** Anisotropy strength. */\n\tpublic setAnisotropyStrength(strength: number): this {\n\t\treturn this.set('anisotropyStrength', strength);\n\t}\n\n\t/**********************************************************************************************\n\t * Anisotropy rotation.\n\t */\n\n\t/** Anisotropy rotation; linear multiplier. */\n\tpublic getAnisotropyRotation(): number {\n\t\treturn this.get('anisotropyRotation');\n\t}\n\n\t/** Anisotropy rotation; linear multiplier. */\n\tpublic setAnisotropyRotation(rotation: number): this {\n\t\treturn this.set('anisotropyRotation', rotation);\n\t}\n\n\t/**********************************************************************************************\n\t * Anisotropy texture.\n\t */\n\n\t/**\n\t * Anisotropy texture. Red and green channels represent the anisotropy\n\t * direction in [-1, 1] tangent, bitangent space, to be rotated by\n\t * anisotropyRotation. The blue channel contains strength as [0, 1] to be\n\t * multiplied by anisotropyStrength.\n\t */\n\tpublic getAnisotropyTexture(): Texture | null {\n\t\treturn this.getRef('anisotropyTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its anisotropy texture. If no\n\t * texture is attached, {@link TextureInfo} is `null`.\n\t */\n\tpublic getAnisotropyTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('anisotropyTexture') ? this.getRef('anisotropyTextureInfo') : null;\n\t}\n\n\t/** Anisotropy texture. See {@link Anisotropy.getAnisotropyTexture getAnisotropyTexture}. */\n\tpublic setAnisotropyTexture(texture: Texture | null): this {\n\t\treturn this.setRef('anisotropyTexture', texture, { channels: R | G | B });\n\t}\n}\n", "import { Extension, type GLTF, PropertyType, type ReaderContext, type WriterContext } from '@gltf-transform/core';\nimport { KHR_MATERIALS_ANISOTROPY } from '../constants.js';\nimport { Anisotropy } from './anisotropy.js';\n\ninterface AnisotropyDef {\n\tanisotropyStrength: number;\n\tanisotropyRotation: number;\n\tanisotropyTexture: GLTF.ITextureInfo;\n}\n\n/**\n * [`KHR_materials_anisotropy`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_anisotropy/)\n * defines anisotropy (directionally-dependent reflections) on a PBR material.\n *\n * ![Illustration](/media/extensions/khr-materials-anisotropy.jpg)\n *\n * > _**Figure:** Effect of each color channel in the anisotropyTexture. Left\n * > to right: the full anisotropy texture, filling the red channel with black,\n * > filling the green channel with black, filling the blue channel with black.\n * > Source: [Khronos Group & Wayfair](https://github.com/KhronosGroup/glTF-Sample-Assets/tree/main/Models/AnisotropyBarnLamp)._\n *\n * This extension defines the anisotropic property of a material as observable with brushed metals\n * for instance. An asymmetric specular lobe model is introduced to allow for such phenomena. The\n * visually distinct feature of that lobe is the elongated appearance of the specular reflection.\n * For a single punctual light source, the specular reflection will eventually degenerate into a\n * zero width line in the limit, that is where the material is fully anisotropic, as opposed to be\n * fully isotropic in which case the specular reflection is radially symmetric.\n *\n * Properties:\n * - {@link Anisotropy}\n *\n * ### Example\n *\n * The `KHRMaterialsAnisotropy` class provides a single {@link ExtensionProperty} type, `Anisotropy`,\n * which may be attached to any {@link Material} instance. For example:\n *\n * ```typescript\n * import { KHRMaterialsAnisotropy, Anisotropy } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const anisotropyExtension = document.createExtension(KHRMaterialsAnisotropy);\n *\n * // Create an Anisotropy property.\n * const anisotropy = anisotropyExtension.createAnisotropy()\n * \t.setAnisotropyStrength(1.0)\n * \t.setAnisotropyRotation(Math.PI / 4);\n *\n * // Attach the property to a Material.\n * material.setExtension('KHR_materials_anisotropy', anisotropy);\n * ```\n */\nexport class KHRMaterialsAnisotropy extends Extension {\n\tpublic static readonly EXTENSION_NAME: typeof KHR_MATERIALS_ANISOTROPY = KHR_MATERIALS_ANISOTROPY;\n\tpublic readonly extensionName: typeof KHR_MATERIALS_ANISOTROPY = KHR_MATERIALS_ANISOTROPY;\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.MESH];\n\tpublic readonly prewriteTypes: PropertyType[] = [PropertyType.MESH];\n\n\t/** Creates a new Anisotropy property for use on a {@link Material}. */\n\tpublic createAnisotropy(): Anisotropy {\n\t\treturn new Anisotropy(this.document.getGraph());\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(_context: WriterContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\t\tconst materialDefs = jsonDoc.json.materials || [];\n\t\tconst textureDefs = jsonDoc.json.textures || [];\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\n\t\t\tif (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_ANISOTROPY]) {\n\t\t\t\tconst anisotropy = this.createAnisotropy();\n\t\t\t\tcontext.materials[materialIndex].setExtension(KHR_MATERIALS_ANISOTROPY, anisotropy);\n\n\t\t\t\tconst anisotropyDef = materialDef.extensions[KHR_MATERIALS_ANISOTROPY] as AnisotropyDef;\n\n\t\t\t\t// Factors.\n\n\t\t\t\tif (anisotropyDef.anisotropyStrength !== undefined) {\n\t\t\t\t\tanisotropy.setAnisotropyStrength(anisotropyDef.anisotropyStrength);\n\t\t\t\t}\n\t\t\t\tif (anisotropyDef.anisotropyRotation !== undefined) {\n\t\t\t\t\tanisotropy.setAnisotropyRotation(anisotropyDef.anisotropyRotation);\n\t\t\t\t}\n\n\t\t\t\t// Textures.\n\n\t\t\t\tif (anisotropyDef.anisotropyTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = anisotropyDef.anisotropyTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\tanisotropy.setAnisotropyTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(anisotropy.getAnisotropyTextureInfo()!, textureInfoDef);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic prewrite(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listMaterials()\n\t\t\t.forEach((material) => {\n\t\t\t\tconst anisotropy = material.getExtension<Anisotropy>(KHR_MATERIALS_ANISOTROPY);\n\t\t\t\tif (anisotropy) {\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\n\n\t\t\t\t\t// Factors.\n\n\t\t\t\t\tconst anisotropyDef = (materialDef.extensions[KHR_MATERIALS_ANISOTROPY] = {} as AnisotropyDef);\n\n\t\t\t\t\tif (anisotropy.getAnisotropyStrength() > 0) {\n\t\t\t\t\t\tanisotropyDef.anisotropyStrength = anisotropy.getAnisotropyStrength();\n\t\t\t\t\t}\n\t\t\t\t\tif (anisotropy.getAnisotropyRotation() !== 0) {\n\t\t\t\t\t\tanisotropyDef.anisotropyRotation = anisotropy.getAnisotropyRotation();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Textures.\n\n\t\t\t\t\tif (anisotropy.getAnisotropyTexture()) {\n\t\t\t\t\t\tconst texture = anisotropy.getAnisotropyTexture()!;\n\t\t\t\t\t\tconst textureInfo = anisotropy.getAnisotropyTextureInfo()!;\n\t\t\t\t\t\tanisotropyDef.anisotropyTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n", "import {\n\tExtensionProperty,\n\ttype IProperty,\n\ttype Nullable,\n\tPropertyType,\n\ttype Texture,\n\tTextureChannel,\n\tTextureInfo,\n} from '@gltf-transform/core';\nimport { KHR_MATERIALS_CLEARCOAT } from '../constants.js';\n\ninterface IClearcoat extends IProperty {\n\tclearcoatFactor: number;\n\tclearcoatTexture: Texture;\n\tclearcoatTextureInfo: TextureInfo;\n\n\tclearcoatRoughnessFactor: number;\n\tclearcoatRoughnessTexture: Texture;\n\tclearcoatRoughnessTextureInfo: TextureInfo;\n\n\tclearcoatNormalScale: number;\n\tclearcoatNormalTexture: Texture;\n\tclearcoatNormalTextureInfo: TextureInfo;\n}\n\nconst { R, G, B } = TextureChannel;\n\n/**\n * Defines clear coat for a PBR material. See {@link KHRMaterialsClearcoat}.\n */\nexport class Clearcoat extends ExtensionProperty<IClearcoat> {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_CLEARCOAT = KHR_MATERIALS_CLEARCOAT;\n\tpublic declare extensionName: typeof KHR_MATERIALS_CLEARCOAT;\n\tpublic declare propertyType: 'Clearcoat';\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_CLEARCOAT;\n\t\tthis.propertyType = 'Clearcoat';\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\n\t}\n\n\tprotected getDefaults(): Nullable<IClearcoat> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\n\t\t\tclearcoatFactor: 0,\n\t\t\tclearcoatTexture: null,\n\t\t\tclearcoatTextureInfo: new TextureInfo(this.graph, 'clearcoatTextureInfo'),\n\n\t\t\tclearcoatRoughnessFactor: 0,\n\t\t\tclearcoatRoughnessTexture: null,\n\t\t\tclearcoatRoughnessTextureInfo: new TextureInfo(this.graph, 'clearcoatRoughnessTextureInfo'),\n\n\t\t\tclearcoatNormalScale: 1,\n\t\t\tclearcoatNormalTexture: null,\n\t\t\tclearcoatNormalTextureInfo: new TextureInfo(this.graph, 'clearcoatNormalTextureInfo'),\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * Clearcoat.\n\t */\n\n\t/** Clearcoat; linear multiplier. See {@link Clearcoat.getClearcoatTexture getClearcoatTexture}. */\n\tpublic getClearcoatFactor(): number {\n\t\treturn this.get('clearcoatFactor');\n\t}\n\n\t/** Clearcoat; linear multiplier. See {@link Clearcoat.getClearcoatTexture getClearcoatTexture}. */\n\tpublic setClearcoatFactor(factor: number): this {\n\t\treturn this.set('clearcoatFactor', factor);\n\t}\n\n\t/**\n\t * Clearcoat texture; linear multiplier. The `r` channel of this texture specifies an amount\n\t * [0-1] of coating over the surface of the material, which may have its own roughness and\n\t * normal map properties.\n\t */\n\tpublic getClearcoatTexture(): Texture | null {\n\t\treturn this.getRef('clearcoatTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its clearcoat texture. If no texture is attached,\n\t * {@link TextureInfo} is `null`.\n\t */\n\tpublic getClearcoatTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('clearcoatTexture') ? this.getRef('clearcoatTextureInfo') : null;\n\t}\n\n\t/** Sets clearcoat texture. See {@link Clearcoat.getClearcoatTexture getClearcoatTexture}. */\n\tpublic setClearcoatTexture(texture: Texture | null): this {\n\t\treturn this.setRef('clearcoatTexture', texture, { channels: R });\n\t}\n\n\t/**********************************************************************************************\n\t * Clearcoat roughness.\n\t */\n\n\t/**\n\t * Clearcoat roughness; linear multiplier.\n\t * See {@link Clearcoat.getClearcoatRoughnessTexture getClearcoatRoughnessTexture}.\n\t */\n\tpublic getClearcoatRoughnessFactor(): number {\n\t\treturn this.get('clearcoatRoughnessFactor');\n\t}\n\n\t/**\n\t * Clearcoat roughness; linear multiplier.\n\t * See {@link Clearcoat.getClearcoatRoughnessTexture getClearcoatRoughnessTexture}.\n\t */\n\tpublic setClearcoatRoughnessFactor(factor: number): this {\n\t\treturn this.set('clearcoatRoughnessFactor', factor);\n\t}\n\n\t/**\n\t * Clearcoat roughness texture; linear multiplier. The `g` channel of this texture specifies\n\t * roughness, independent of the base layer's roughness.\n\t */\n\tpublic getClearcoatRoughnessTexture(): Texture | null {\n\t\treturn this.getRef('clearcoatRoughnessTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its clearcoat roughness texture. If no texture is\n\t * attached, {@link TextureInfo} is `null`.\n\t */\n\tpublic getClearcoatRoughnessTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('clearcoatRoughnessTexture') ? this.getRef('clearcoatRoughnessTextureInfo') : null;\n\t}\n\n\t/**\n\t * Sets clearcoat roughness texture.\n\t * See {@link Clearcoat.getClearcoatRoughnessTexture getClearcoatRoughnessTexture}.\n\t */\n\tpublic setClearcoatRoughnessTexture(texture: Texture | null): this {\n\t\treturn this.setRef('clearcoatRoughnessTexture', texture, { channels: G });\n\t}\n\n\t/**********************************************************************************************\n\t * Clearcoat normals.\n\t */\n\n\t/** Clearcoat normal scale. See {@link Clearcoat.getClearcoatNormalTexture getClearcoatNormalTexture}. */\n\tpublic getClearcoatNormalScale(): number {\n\t\treturn this.get('clearcoatNormalScale');\n\t}\n\n\t/** Clearcoat normal scale. See {@link Clearcoat.getClearcoatNormalTexture getClearcoatNormalTexture}. */\n\tpublic setClearcoatNormalScale(scale: number): this {\n\t\treturn this.set('clearcoatNormalScale', scale);\n\t}\n\n\t/**\n\t * Clearcoat normal map. Independent of the material base layer normal map.\n\t */\n\tpublic getClearcoatNormalTexture(): Texture | null {\n\t\treturn this.getRef('clearcoatNormalTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its clearcoat normal texture. If no texture is\n\t * attached, {@link TextureInfo} is `null`.\n\t */\n\tpublic getClearcoatNormalTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('clearcoatNormalTexture') ? this.getRef('clearcoatNormalTextureInfo') : null;\n\t}\n\n\t/** Sets clearcoat normal texture. See {@link Clearcoat.getClearcoatNormalTexture getClearcoatNormalTexture}. */\n\tpublic setClearcoatNormalTexture(texture: Texture | null): this {\n\t\treturn this.setRef('clearcoatNormalTexture', texture, { channels: R | G | B });\n\t}\n}\n", "import { Extension, type GLTF, PropertyType, type ReaderContext, type WriterContext } from '@gltf-transform/core';\nimport { KHR_MATERIALS_CLEARCOAT } from '../constants.js';\nimport { Clearcoat } from './clearcoat.js';\n\ninterface ClearcoatDef {\n\tclearcoatFactor?: number;\n\tclearcoatRoughnessFactor?: number;\n\tclearcoatTexture?: GLTF.ITextureInfo;\n\tclearcoatRoughnessTexture?: GLTF.ITextureInfo;\n\tclearcoatNormalTexture?: GLTF.IMaterialNormalTextureInfo;\n}\n\n/**\n * [KHR_materials_clearcoat](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_clearcoat/)\n * defines a clear coating on a glTF PBR material.\n *\n * ![Illustration](/media/extensions/khr-materials-clearcoat.png)\n *\n * > _**Figure:** Comparison of a carbon-fiber material without clearcoat (left) and with clearcoat\n * > (right). Source: [Filament](https://google.github.io/filament/Materials.html)._\n *\n * A clear coat is a common technique used in Physically-Based\n * Rendering for a protective layer applied to a base material.\n * Commonly used to represent car paint, carbon fiber, or thin lacquers.\n *\n * Properties:\n * - {@link Clearcoat}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMaterialsClearcoat, Clearcoat } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const clearcoatExtension = document.createExtension(KHRMaterialsClearcoat);\n *\n * // Create Clearcoat property.\n * const clearcoat = clearcoatExtension.createClearcoat()\n *\t.setClearcoatFactor(1.0);\n *\n * // Assign to a Material.\n * material.setExtension('KHR_materials_clearcoat', clearcoat);\n * ```\n */\nexport class KHRMaterialsClearcoat extends Extension {\n\tpublic static readonly EXTENSION_NAME: typeof KHR_MATERIALS_CLEARCOAT = KHR_MATERIALS_CLEARCOAT;\n\tpublic readonly extensionName: typeof KHR_MATERIALS_CLEARCOAT = KHR_MATERIALS_CLEARCOAT;\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.MESH];\n\tpublic readonly prewriteTypes: PropertyType[] = [PropertyType.MESH];\n\n\t/** Creates a new Clearcoat property for use on a {@link Material}. */\n\tpublic createClearcoat(): Clearcoat {\n\t\treturn new Clearcoat(this.document.getGraph());\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(_context: WriterContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\t\tconst materialDefs = jsonDoc.json.materials || [];\n\t\tconst textureDefs = jsonDoc.json.textures || [];\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\n\t\t\tif (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_CLEARCOAT]) {\n\t\t\t\tconst clearcoat = this.createClearcoat();\n\t\t\t\tcontext.materials[materialIndex].setExtension(KHR_MATERIALS_CLEARCOAT, clearcoat);\n\n\t\t\t\tconst clearcoatDef = materialDef.extensions[KHR_MATERIALS_CLEARCOAT] as ClearcoatDef;\n\n\t\t\t\t// Factors.\n\n\t\t\t\tif (clearcoatDef.clearcoatFactor !== undefined) {\n\t\t\t\t\tclearcoat.setClearcoatFactor(clearcoatDef.clearcoatFactor);\n\t\t\t\t}\n\t\t\t\tif (clearcoatDef.clearcoatRoughnessFactor !== undefined) {\n\t\t\t\t\tclearcoat.setClearcoatRoughnessFactor(clearcoatDef.clearcoatRoughnessFactor);\n\t\t\t\t}\n\n\t\t\t\t// Textures.\n\n\t\t\t\tif (clearcoatDef.clearcoatTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = clearcoatDef.clearcoatTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\tclearcoat.setClearcoatTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(clearcoat.getClearcoatTextureInfo()!, textureInfoDef);\n\t\t\t\t}\n\t\t\t\tif (clearcoatDef.clearcoatRoughnessTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = clearcoatDef.clearcoatRoughnessTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\tclearcoat.setClearcoatRoughnessTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(clearcoat.getClearcoatRoughnessTextureInfo()!, textureInfoDef);\n\t\t\t\t}\n\t\t\t\tif (clearcoatDef.clearcoatNormalTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = clearcoatDef.clearcoatNormalTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\tclearcoat.setClearcoatNormalTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(clearcoat.getClearcoatNormalTextureInfo()!, textureInfoDef);\n\t\t\t\t\tif (textureInfoDef.scale !== undefined) {\n\t\t\t\t\t\tclearcoat.setClearcoatNormalScale(textureInfoDef.scale);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic prewrite(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listMaterials()\n\t\t\t.forEach((material) => {\n\t\t\t\tconst clearcoat = material.getExtension<Clearcoat>(KHR_MATERIALS_CLEARCOAT);\n\t\t\t\tif (clearcoat) {\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\n\n\t\t\t\t\t// Factors.\n\n\t\t\t\t\tconst clearcoatDef = (materialDef.extensions[KHR_MATERIALS_CLEARCOAT] = {\n\t\t\t\t\t\tclearcoatFactor: clearcoat.getClearcoatFactor(),\n\t\t\t\t\t\tclearcoatRoughnessFactor: clearcoat.getClearcoatRoughnessFactor(),\n\t\t\t\t\t} as ClearcoatDef);\n\n\t\t\t\t\t// Textures.\n\n\t\t\t\t\tif (clearcoat.getClearcoatTexture()) {\n\t\t\t\t\t\tconst texture = clearcoat.getClearcoatTexture()!;\n\t\t\t\t\t\tconst textureInfo = clearcoat.getClearcoatTextureInfo()!;\n\t\t\t\t\t\tclearcoatDef.clearcoatTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t\t\t}\n\t\t\t\t\tif (clearcoat.getClearcoatRoughnessTexture()) {\n\t\t\t\t\t\tconst texture = clearcoat.getClearcoatRoughnessTexture()!;\n\t\t\t\t\t\tconst textureInfo = clearcoat.getClearcoatRoughnessTextureInfo()!;\n\t\t\t\t\t\tclearcoatDef.clearcoatRoughnessTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t\t\t}\n\t\t\t\t\tif (clearcoat.getClearcoatNormalTexture()) {\n\t\t\t\t\t\tconst texture = clearcoat.getClearcoatNormalTexture()!;\n\t\t\t\t\t\tconst textureInfo = clearcoat.getClearcoatNormalTextureInfo()!;\n\t\t\t\t\t\tclearcoatDef.clearcoatNormalTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t\t\t\tif (clearcoat.getClearcoatNormalScale() !== 1) {\n\t\t\t\t\t\t\tclearcoatDef.clearcoatNormalTexture.scale = clearcoat.getClearcoatNormalScale();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n", "import {\n\tExtensionProperty,\n\ttype IProperty,\n\ttype Nullable,\n\tPropertyType,\n\ttype Texture,\n\tTextureChannel,\n\tTextureInfo,\n\ttype vec3,\n} from '@gltf-transform/core';\nimport { KHR_MATERIALS_DIFFUSE_TRANSMISSION } from '../constants.js';\n\ninterface IDiffuseTransmission extends IProperty {\n\tdiffuseTransmissionFactor: number;\n\tdiffuseTransmissionTexture: Texture;\n\tdiffuseTransmissionTextureInfo: TextureInfo;\n\tdiffuseTransmissionColorFactor: vec3;\n\tdiffuseTransmissionColorTexture: Texture;\n\tdiffuseTransmissionColorTextureInfo: TextureInfo;\n}\n\nconst { R, G, B, A } = TextureChannel;\n\n/**\n * Defines diffuse transmission on a PBR {@link Material}. See {@link KHRMaterialsDiffuseTransmission}.\n *\n * @experimental KHR_materials_diffuse_transmission is not yet ratified by the Khronos Group.\n */\nexport class DiffuseTransmission extends ExtensionProperty<IDiffuseTransmission> {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_DIFFUSE_TRANSMISSION = KHR_MATERIALS_DIFFUSE_TRANSMISSION;\n\tpublic declare extensionName: typeof KHR_MATERIALS_DIFFUSE_TRANSMISSION;\n\tpublic declare propertyType: 'DiffuseTransmission';\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_DIFFUSE_TRANSMISSION;\n\t\tthis.propertyType = 'DiffuseTransmission';\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\n\t}\n\n\tprotected getDefaults(): Nullable<IDiffuseTransmission> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\n\t\t\tdiffuseTransmissionFactor: 0.0,\n\t\t\tdiffuseTransmissionTexture: null,\n\t\t\tdiffuseTransmissionTextureInfo: new TextureInfo(this.graph, 'diffuseTransmissionTextureInfo'),\n\t\t\tdiffuseTransmissionColorFactor: [1.0, 1.0, 1.0] as vec3,\n\t\t\tdiffuseTransmissionColorTexture: null,\n\t\t\tdiffuseTransmissionColorTextureInfo: new TextureInfo(this.graph, 'diffuseTransmissionColorTextureInfo'),\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * Diffuse transmission.\n\t */\n\n\t/**\n\t * Percentage of reflected, non-specularly reflected light that is transmitted through the\n\t * surface via the Lambertian diffuse transmission, i.e., the strength of the diffuse\n\t * transmission effect.\n\t */\n\tpublic getDiffuseTransmissionFactor(): number {\n\t\treturn this.get('diffuseTransmissionFactor');\n\t}\n\n\t/**\n\t * Percentage of reflected, non-specularly reflected light that is transmitted through the\n\t * surface via the Lambertian diffuse transmission, i.e., the strength of the diffuse\n\t * transmission effect.\n\t */\n\tpublic setDiffuseTransmissionFactor(factor: number): this {\n\t\treturn this.set('diffuseTransmissionFactor', factor);\n\t}\n\n\t/**\n\t * Texture that defines the strength of the diffuse transmission effect, stored in the alpha (A)\n\t * channel. Will be multiplied by the diffuseTransmissionFactor.\n\t */\n\tpublic getDiffuseTransmissionTexture(): Texture | null {\n\t\treturn this.getRef('diffuseTransmissionTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its diffuse transmission texture. If no texture is attached,\n\t * {@link TextureInfo} is `null`.\n\t */\n\tpublic getDiffuseTransmissionTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('diffuseTransmissionTexture') ? this.getRef('diffuseTransmissionTextureInfo') : null;\n\t}\n\n\t/**\n\t * Texture that defines the strength of the diffuse transmission effect, stored in the alpha (A)\n\t * channel. Will be multiplied by the diffuseTransmissionFactor.\n\t */\n\tpublic setDiffuseTransmissionTexture(texture: Texture | null): this {\n\t\treturn this.setRef('diffuseTransmissionTexture', texture, { channels: A });\n\t}\n\n\t/**********************************************************************************************\n\t * Diffuse transmission color.\n\t */\n\n\t/** Color of the transmitted light; Linear-sRGB components. */\n\tpublic getDiffuseTransmissionColorFactor(): vec3 {\n\t\treturn this.get('diffuseTransmissionColorFactor');\n\t}\n\n\t/** Color of the transmitted light; Linear-sRGB components. */\n\tpublic setDiffuseTransmissionColorFactor(factor: vec3): this {\n\t\treturn this.set('diffuseTransmissionColorFactor', factor);\n\t}\n\n\t/**\n\t * Texture that defines the color of the transmitted light, stored in the RGB channels and\n\t * encoded in sRGB. This texture will be multiplied by diffuseTransmissionColorFactor.\n\t */\n\tpublic getDiffuseTransmissionColorTexture(): Texture | null {\n\t\treturn this.getRef('diffuseTransmissionColorTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its diffuse transmission color texture. If no\n\t * texture is attached, {@link TextureInfo} is `null`.\n\t */\n\tpublic getDiffuseTransmissionColorTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('diffuseTransmissionColorTexture')\n\t\t\t? this.getRef('diffuseTransmissionColorTextureInfo')\n\t\t\t: null;\n\t}\n\n\t/**\n\t * Texture that defines the color of the transmitted light, stored in the RGB channels and\n\t * encoded in sRGB. This texture will be multiplied by diffuseTransmissionColorFactor.\n\t */\n\tpublic setDiffuseTransmissionColorTexture(texture: Texture | null): this {\n\t\treturn this.setRef('diffuseTransmissionColorTexture', texture, { channels: R | G | B });\n\t}\n}\n", "import { Extension, type GLTF, type ReaderContext, type vec3, type WriterContext } from '@gltf-transform/core';\nimport { KHR_MATERIALS_DIFFUSE_TRANSMISSION } from '../constants.js';\nimport { DiffuseTransmission } from './diffuse-transmission.js';\n\ninterface DiffuseTransmissionDef {\n\tdiffuseTransmissionFactor?: number;\n\tdiffuseTransmissionTexture?: GLTF.ITextureInfo;\n\tdiffuseTransmissionColorFactor?: vec3;\n\tdiffuseTransmissionColorTexture?: GLTF.ITextureInfo;\n}\n\n/**\n * [KHR_materials_diffuse_transmission](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_diffuse_transmission/)\n * defines diffuse transmission on a glTF PBR material.\n *\n * ![Illustration](/media/extensions/khr-materials-diffuse-transmission.png)\n *\n * > _**Figure:** Sphere using `KHR_materials_diffuse_transmission` with varying roughness (0.0, 0.2, 0.4).\n * > Source: Khronos Group._\n *\n * Adds a Lambertian diffuse transmission BSDF to the metallic-roughness\n * material. Thin, dielectric objects like leaves or paper diffusely transmit\n * incoming light to the opposite side of the surface. For optically thick\n * media (volumes) with short scattering distances and therefore dense\n * scattering behavior, a diffuse transmission lobe is a phenomenological\n * plausible and cheap approximation.\n *\n * Properties:\n * - {@link DiffuseTransmission}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMaterialsDiffuseTransmission, DiffuseTransmission } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const diffuseTransmissionExtension = document.createExtension(KHRMaterialsDiffuseTransmission);\n *\n * // Create DiffuseTransmission property.\n * const diffuseTransmission = diffuseTransmission.createDiffuseTransmission()\n *\t.setDiffuseTransmissionFactor(1.0);\n *\n * // Assign to a Material.\n * material.setExtension('KHR_materials_diffuse_transmission', diffuseTransmission);\n * ```\n *\n * @experimental KHR_materials_diffuse_transmission is not yet ratified by the Khronos Group.\n */\nexport class KHRMaterialsDiffuseTransmission extends Extension {\n\tpublic readonly extensionName: typeof KHR_MATERIALS_DIFFUSE_TRANSMISSION = KHR_MATERIALS_DIFFUSE_TRANSMISSION;\n\tpublic static readonly EXTENSION_NAME: typeof KHR_MATERIALS_DIFFUSE_TRANSMISSION =\n\t\tKHR_MATERIALS_DIFFUSE_TRANSMISSION;\n\n\t/** Creates a new DiffuseTransmission property for use on a {@link Material}. */\n\tpublic createDiffuseTransmission(): DiffuseTransmission {\n\t\treturn new DiffuseTransmission(this.document.getGraph());\n\t}\n\n\t/** @hidden */\n\tpublic read(context: ReaderContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\t\tconst materialDefs = jsonDoc.json.materials || [];\n\t\tconst textureDefs = jsonDoc.json.textures || [];\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\n\t\t\tif (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_DIFFUSE_TRANSMISSION]) {\n\t\t\t\tconst transmission = this.createDiffuseTransmission();\n\t\t\t\tcontext.materials[materialIndex].setExtension(KHR_MATERIALS_DIFFUSE_TRANSMISSION, transmission);\n\n\t\t\t\tconst transmissionDef = materialDef.extensions[\n\t\t\t\t\tKHR_MATERIALS_DIFFUSE_TRANSMISSION\n\t\t\t\t] as DiffuseTransmissionDef;\n\n\t\t\t\t// Factors.\n\n\t\t\t\tif (transmissionDef.diffuseTransmissionFactor !== undefined) {\n\t\t\t\t\ttransmission.setDiffuseTransmissionFactor(transmissionDef.diffuseTransmissionFactor);\n\t\t\t\t}\n\n\t\t\t\tif (transmissionDef.diffuseTransmissionColorFactor !== undefined) {\n\t\t\t\t\ttransmission.setDiffuseTransmissionColorFactor(transmissionDef.diffuseTransmissionColorFactor);\n\t\t\t\t}\n\n\t\t\t\t// Textures.\n\n\t\t\t\tif (transmissionDef.diffuseTransmissionTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = transmissionDef.diffuseTransmissionTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\ttransmission.setDiffuseTransmissionTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(transmission.getDiffuseTransmissionTextureInfo()!, textureInfoDef);\n\t\t\t\t}\n\n\t\t\t\tif (transmissionDef.diffuseTransmissionColorTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = transmissionDef.diffuseTransmissionColorTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\ttransmission.setDiffuseTransmissionColorTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(transmission.getDiffuseTransmissionColorTextureInfo()!, textureInfoDef);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tfor (const material of this.document.getRoot().listMaterials()) {\n\t\t\tconst transmission = material.getExtension<DiffuseTransmission>(KHR_MATERIALS_DIFFUSE_TRANSMISSION);\n\t\t\tif (!transmission) continue;\n\n\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\n\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\n\t\t\tmaterialDef.extensions = materialDef.extensions || {};\n\n\t\t\t// Factors.\n\n\t\t\tconst transmissionDef = (materialDef.extensions[KHR_MATERIALS_DIFFUSE_TRANSMISSION] = {\n\t\t\t\tdiffuseTransmissionFactor: transmission.getDiffuseTransmissionFactor(),\n\t\t\t\tdiffuseTransmissionColorFactor: transmission.getDiffuseTransmissionColorFactor(),\n\t\t\t} as DiffuseTransmissionDef);\n\n\t\t\t// Textures.\n\n\t\t\tif (transmission.getDiffuseTransmissionTexture()) {\n\t\t\t\tconst texture = transmission.getDiffuseTransmissionTexture()!;\n\t\t\t\tconst textureInfo = transmission.getDiffuseTransmissionTextureInfo()!;\n\t\t\t\ttransmissionDef.diffuseTransmissionTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t}\n\n\t\t\tif (transmission.getDiffuseTransmissionColorTexture()) {\n\t\t\t\tconst texture = transmission.getDiffuseTransmissionColorTexture()!;\n\t\t\t\tconst textureInfo = transmission.getDiffuseTransmissionColorTextureInfo()!;\n\t\t\t\ttransmissionDef.diffuseTransmissionColorTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n}\n", "import { ExtensionProperty, type IProperty, type Nullable, PropertyType } from '@gltf-transform/core';\nimport { KHR_MATERIALS_DISPERSION } from '../constants.js';\n\ninterface IDispersion extends IProperty {\n\tdispersion: number;\n}\n\n/**\n * Defines dispersion for a PBR {@link Material}. See {@link KHRMaterialsDispersion}.\n */\nexport class Dispersion extends ExtensionProperty<IDispersion> {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_DISPERSION = KHR_MATERIALS_DISPERSION;\n\tpublic declare extensionName: typeof KHR_MATERIALS_DISPERSION;\n\tpublic declare propertyType: 'Dispersion';\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_DISPERSION;\n\t\tthis.propertyType = 'Dispersion';\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\n\t}\n\n\tprotected getDefaults(): Nullable<IDispersion> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, { dispersion: 0 });\n\t}\n\n\t/**********************************************************************************************\n\t * Dispersion.\n\t */\n\n\t/** Dispersion. */\n\tpublic getDispersion(): number {\n\t\treturn this.get('dispersion');\n\t}\n\n\t/** Dispersion. */\n\tpublic setDispersion(dispersion: number): this {\n\t\treturn this.set('dispersion', dispersion);\n\t}\n}\n", "import { Extension, PropertyType, type ReaderContext, type WriterContext } from '@gltf-transform/core';\nimport { KHR_MATERIALS_DISPERSION } from '../constants.js';\nimport { Dispersion } from './dispersion.js';\n\ninterface DispersionDef {\n\tdispersion?: number;\n}\n\n/**\n * [KHR_materials_dispersion](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_dispersion/)\n * defines dispersion on a glTF PBR material.\n *\n * ![illustration](/media/extensions/khr-materials-dispersion.jpg)\n *\n * > _**Figure:** Prisms demonstrating volumetric refraction and dispersion, for varying\n * > values of dispersion and IOR. Source: Khronos Group, rendered in Adobe Stager._\n *\n * Dispersion enables configuring the strength of the angular separation of colors (chromatic\n * aberration) transmitting through a relatively clear volume.  It is an enhancement to the\n * default `KHR_materials_volume` transmission model which assumes no dispersion.\n *\n * Properties:\n * - {@link Dispersion}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMaterialsDispersion, Dispersion } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const dispersionExtension = document.createExtension(KHRMaterialsDispersion);\n *\n * // Create Dispersion property.\n * const dispersion = dispersionExtension.createDispersion().setDispersion(1.0);\n *\n * // Assign to a Material.\n * material.setExtension('KHR_materials_dispersion', dispersion);\n * ```\n */\nexport class KHRMaterialsDispersion extends Extension {\n\tpublic static readonly EXTENSION_NAME: typeof KHR_MATERIALS_DISPERSION = KHR_MATERIALS_DISPERSION;\n\tpublic readonly extensionName: typeof KHR_MATERIALS_DISPERSION = KHR_MATERIALS_DISPERSION;\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.MESH];\n\tpublic readonly prewriteTypes: PropertyType[] = [PropertyType.MESH];\n\n\t/** Creates a new Dispersion property for use on a {@link Material}. */\n\tpublic createDispersion(): Dispersion {\n\t\treturn new Dispersion(this.document.getGraph());\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(_context: WriterContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\t\tconst materialDefs = jsonDoc.json.materials || [];\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\n\t\t\tif (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_DISPERSION]) {\n\t\t\t\tconst dispersion = this.createDispersion();\n\t\t\t\tcontext.materials[materialIndex].setExtension(KHR_MATERIALS_DISPERSION, dispersion);\n\n\t\t\t\tconst dispersionDef = materialDef.extensions[KHR_MATERIALS_DISPERSION] as DispersionDef;\n\n\t\t\t\t// Factors.\n\n\t\t\t\tif (dispersionDef.dispersion !== undefined) {\n\t\t\t\t\tdispersion.setDispersion(dispersionDef.dispersion);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic prewrite(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listMaterials()\n\t\t\t.forEach((material) => {\n\t\t\t\tconst dispersion = material.getExtension<Dispersion>(KHR_MATERIALS_DISPERSION);\n\t\t\t\tif (dispersion) {\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\n\n\t\t\t\t\t// Factors.\n\n\t\t\t\t\tmaterialDef.extensions[KHR_MATERIALS_DISPERSION] = {\n\t\t\t\t\t\tdispersion: dispersion.getDispersion(),\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n", "import { ExtensionProperty, type IProperty, type Nullable, PropertyType } from '@gltf-transform/core';\nimport { KHR_MATERIALS_EMISSIVE_STRENGTH } from '../constants.js';\n\ninterface IEmissiveStrength extends IProperty {\n\temissiveStrength: number;\n}\n\n/**\n * Defines emissive strength for a PBR {@link Material}, allowing high-dynamic-range\n * (HDR) emissive materials. See {@link KHRMaterialsEmissiveStrength}.\n */\nexport class EmissiveStrength extends ExtensionProperty<IEmissiveStrength> {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_EMISSIVE_STRENGTH = KHR_MATERIALS_EMISSIVE_STRENGTH;\n\tpublic declare extensionName: typeof KHR_MATERIALS_EMISSIVE_STRENGTH;\n\tpublic declare propertyType: 'EmissiveStrength';\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_EMISSIVE_STRENGTH;\n\t\tthis.propertyType = 'EmissiveStrength';\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\n\t}\n\n\tprotected getDefaults(): Nullable<IEmissiveStrength> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, { emissiveStrength: 1.0 });\n\t}\n\n\t/**********************************************************************************************\n\t * EmissiveStrength.\n\t */\n\n\t/** EmissiveStrength. */\n\tpublic getEmissiveStrength(): number {\n\t\treturn this.get('emissiveStrength');\n\t}\n\n\t/** EmissiveStrength. */\n\tpublic setEmissiveStrength(strength: number): this {\n\t\treturn this.set('emissiveStrength', strength);\n\t}\n}\n", "import { Extension, PropertyType, type ReaderContext, type WriterContext } from '@gltf-transform/core';\nimport { KHR_MATERIALS_EMISSIVE_STRENGTH } from '../constants.js';\nimport { EmissiveStrength } from './emissive-strength.js';\n\ninterface EmissiveStrengthDef {\n\temissiveStrength?: number;\n}\n\n/**\n * [KHR_materials_emissive_strength](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_emissive_strength/)\n * defines emissive strength and enables high-dynamic-range (HDR) emissive materials.\n *\n * ![Illustration](/media/extensions/khr-materials-emissive-strength.jpg)\n *\n * > _**Figure:** Cubes with emissive color #59BCF3 and emissive strength\n * > increasing from 1 to 256 nits, left to right. Rendered in [three.js](https://threejs.org/),\n * > with independent point lighting and a bloom effect.\n * > Source: [Don McCurdy](https://www.donmccurdy.com/2024/04/27/emission-and-bloom/)._\n *\n * The core glTF 2.0 material model includes {@link Material.setEmissiveFactor `emissiveFactor`}\n * and {@link Material.setEmissiveTexture `emissiveTexture`} to control the color and intensity\n * of the light being emitted by the material, clamped to the range [0.0, 1.0]. However, in\n * PBR environments with HDR reflections and lighting, stronger emission effects may be desirable.\n *\n * In this extension, a new {@link EmissiveStrength.setEmissiveStrength `emissiveStrength`} scalar\n * factor is supplied, which governs the upper limit of emissive strength per material and may be\n * given arbitrarily high values.\n *\n * For implementations where a physical light unit is needed, the units for the multiplicative\n * product of the emissive texture and factor are candela per square meter (cd / m2), sometimes\n * called _nits_. Many realtime rendering engines simplify this calculation by assuming that an\n * emissive factor of 1.0 results in a fully exposed pixel.\n *\n * Properties:\n * - {@link EmissiveStrength}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMaterialsEmissiveStrength, EmissiveStrength } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const emissiveStrengthExtension = document.createExtension(KHRMaterialsEmissiveStrength);\n *\n * // Create EmissiveStrength property.\n * const emissiveStrength = emissiveStrengthExtension\n * \t.createEmissiveStrength().setEmissiveStrength(5.0);\n *\n * // Assign to a Material.\n * material.setExtension('KHR_materials_emissive_strength', emissiveStrength);\n * ```\n */\nexport class KHRMaterialsEmissiveStrength extends Extension {\n\tpublic static readonly EXTENSION_NAME: typeof KHR_MATERIALS_EMISSIVE_STRENGTH = KHR_MATERIALS_EMISSIVE_STRENGTH;\n\tpublic readonly extensionName: typeof KHR_MATERIALS_EMISSIVE_STRENGTH = KHR_MATERIALS_EMISSIVE_STRENGTH;\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.MESH];\n\tpublic readonly prewriteTypes: PropertyType[] = [PropertyType.MESH];\n\n\t/** Creates a new EmissiveStrength property for use on a {@link Material}. */\n\tpublic createEmissiveStrength(): EmissiveStrength {\n\t\treturn new EmissiveStrength(this.document.getGraph());\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(_context: WriterContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\t\tconst materialDefs = jsonDoc.json.materials || [];\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\n\t\t\tif (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_EMISSIVE_STRENGTH]) {\n\t\t\t\tconst emissiveStrength = this.createEmissiveStrength();\n\t\t\t\tcontext.materials[materialIndex].setExtension(KHR_MATERIALS_EMISSIVE_STRENGTH, emissiveStrength);\n\n\t\t\t\tconst emissiveStrengthDef = materialDef.extensions[\n\t\t\t\t\tKHR_MATERIALS_EMISSIVE_STRENGTH\n\t\t\t\t] as EmissiveStrengthDef;\n\n\t\t\t\t// Factors.\n\n\t\t\t\tif (emissiveStrengthDef.emissiveStrength !== undefined) {\n\t\t\t\t\temissiveStrength.setEmissiveStrength(emissiveStrengthDef.emissiveStrength);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic prewrite(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listMaterials()\n\t\t\t.forEach((material) => {\n\t\t\t\tconst emissiveStrength = material.getExtension<EmissiveStrength>(KHR_MATERIALS_EMISSIVE_STRENGTH);\n\t\t\t\tif (emissiveStrength) {\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\n\n\t\t\t\t\t// Factors.\n\n\t\t\t\t\tmaterialDef.extensions[KHR_MATERIALS_EMISSIVE_STRENGTH] = {\n\t\t\t\t\t\temissiveStrength: emissiveStrength.getEmissiveStrength(),\n\t\t\t\t\t} as EmissiveStrengthDef;\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n", "import { ExtensionProperty, type IProperty, type Nullable, PropertyType } from '@gltf-transform/core';\nimport { KHR_MATERIALS_IOR } from '../constants.js';\n\ninterface IIOR extends IProperty {\n\tior: number;\n}\n\n/**\n * Defines index of refraction for a PBR {@link Material}. See {@link KHRMaterialsIOR}.\n */\nexport class IOR extends ExtensionProperty<IIOR> {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_IOR = KHR_MATERIALS_IOR;\n\tpublic declare extensionName: typeof KHR_MATERIALS_IOR;\n\tpublic declare propertyType: 'IOR';\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_IOR;\n\t\tthis.propertyType = 'IOR';\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\n\t}\n\n\tprotected getDefaults(): Nullable<IIOR> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, { ior: 1.5 });\n\t}\n\n\t/**********************************************************************************************\n\t * IOR.\n\t */\n\n\t/** IOR. */\n\tpublic getIOR(): number {\n\t\treturn this.get('ior');\n\t}\n\n\t/** IOR. */\n\tpublic setIOR(ior: number): this {\n\t\treturn this.set('ior', ior);\n\t}\n}\n", "import { Extension, PropertyType, type ReaderContext, type WriterContext } from '@gltf-transform/core';\nimport { KHR_MATERIALS_IOR } from '../constants.js';\nimport { IOR } from './ior.js';\n\ninterface IORDef {\n\tior?: number;\n}\n\n/**\n * [KHR_materials_ior](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_ior/)\n * defines index of refraction on a glTF PBR material.\n *\n * The dielectric BRDF of the metallic-roughness material in glTF uses a fixed value of 1.5 for the\n * index of refraction. This is a good fit for many plastics and glass, but not for other materials\n * like water or asphalt, sapphire or diamond. `KHR_materials_ior` allows users to set the index of\n * refraction to a certain value.\n *\n * Properties:\n * - {@link IOR}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMaterialsIOR, IOR } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const iorExtension = document.createExtension(KHRMaterialsIOR);\n *\n * // Create IOR property.\n * const ior = iorExtension.createIOR().setIOR(1.0);\n *\n * // Assign to a Material.\n * material.setExtension('KHR_materials_ior', ior);\n * ```\n */\nexport class KHRMaterialsIOR extends Extension {\n\tpublic static readonly EXTENSION_NAME: typeof KHR_MATERIALS_IOR = KHR_MATERIALS_IOR;\n\tpublic readonly extensionName: typeof KHR_MATERIALS_IOR = KHR_MATERIALS_IOR;\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.MESH];\n\tpublic readonly prewriteTypes: PropertyType[] = [PropertyType.MESH];\n\n\t/** Creates a new IOR property for use on a {@link Material}. */\n\tpublic createIOR(): IOR {\n\t\treturn new IOR(this.document.getGraph());\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(_context: WriterContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\t\tconst materialDefs = jsonDoc.json.materials || [];\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\n\t\t\tif (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_IOR]) {\n\t\t\t\tconst ior = this.createIOR();\n\t\t\t\tcontext.materials[materialIndex].setExtension(KHR_MATERIALS_IOR, ior);\n\n\t\t\t\tconst iorDef = materialDef.extensions[KHR_MATERIALS_IOR] as IORDef;\n\n\t\t\t\t// Factors.\n\n\t\t\t\tif (iorDef.ior !== undefined) {\n\t\t\t\t\tior.setIOR(iorDef.ior);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic prewrite(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listMaterials()\n\t\t\t.forEach((material) => {\n\t\t\t\tconst ior = material.getExtension<IOR>(KHR_MATERIALS_IOR);\n\t\t\t\tif (ior) {\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\n\n\t\t\t\t\t// Factors.\n\n\t\t\t\t\tmaterialDef.extensions[KHR_MATERIALS_IOR] = {\n\t\t\t\t\t\tior: ior.getIOR(),\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n", "import {\n\tExtensionProperty,\n\ttype IProperty,\n\ttype Nullable,\n\tPropertyType,\n\ttype Texture,\n\tTextureChannel,\n\tTextureInfo,\n} from '@gltf-transform/core';\nimport { KHR_MATERIALS_IRIDESCENCE } from '../constants.js';\n\ninterface IIridescence extends IProperty {\n\tiridescenceFactor: number;\n\tiridescenceTexture: Texture;\n\tiridescenceTextureInfo: TextureInfo;\n\tiridescenceIOR: number;\n\tiridescenceThicknessMinimum: number;\n\tiridescenceThicknessMaximum: number;\n\tiridescenceThicknessTexture: Texture;\n\tiridescenceThicknessTextureInfo: TextureInfo;\n}\n\nconst { R, G } = TextureChannel;\n\n/**\n * Defines iridescence (thin film interference) on a PBR {@link Material}. See {@link KHRMaterialsIridescence}.\n */\nexport class Iridescence extends ExtensionProperty<IIridescence> {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_IRIDESCENCE = KHR_MATERIALS_IRIDESCENCE;\n\tpublic declare extensionName: typeof KHR_MATERIALS_IRIDESCENCE;\n\tpublic declare propertyType: 'Iridescence';\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_IRIDESCENCE;\n\t\tthis.propertyType = 'Iridescence';\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\n\t}\n\n\tprotected getDefaults(): Nullable<IIridescence> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\n\t\t\tiridescenceFactor: 0.0,\n\t\t\tiridescenceTexture: null,\n\t\t\tiridescenceTextureInfo: new TextureInfo(this.graph, 'iridescenceTextureInfo'),\n\t\t\tiridescenceIOR: 1.3,\n\t\t\tiridescenceThicknessMinimum: 100,\n\t\t\tiridescenceThicknessMaximum: 400,\n\t\t\tiridescenceThicknessTexture: null,\n\t\t\tiridescenceThicknessTextureInfo: new TextureInfo(this.graph, 'iridescenceThicknessTextureInfo'),\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * Iridescence.\n\t */\n\n\t/** Iridescence; linear multiplier. See {@link Iridescence.getIridescenceTexture getIridescenceTexture}. */\n\tpublic getIridescenceFactor(): number {\n\t\treturn this.get('iridescenceFactor');\n\t}\n\n\t/** Iridescence; linear multiplier. See {@link Iridescence.getIridescenceTexture getIridescenceTexture}. */\n\tpublic setIridescenceFactor(factor: number): this {\n\t\treturn this.set('iridescenceFactor', factor);\n\t}\n\n\t/**\n\t * Iridescence intensity.\n\t *\n\t * Only the red (R) channel is used for iridescence intensity, but this texture may optionally\n\t * be packed with additional data in the other channels.\n\t */\n\tpublic getIridescenceTexture(): Texture | null {\n\t\treturn this.getRef('iridescenceTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its iridescence texture. If no texture is attached,\n\t * {@link TextureInfo} is `null`.\n\t */\n\tpublic getIridescenceTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('iridescenceTexture') ? this.getRef('iridescenceTextureInfo') : null;\n\t}\n\n\t/** Iridescence intensity. See {@link Iridescence.getIridescenceTexture getIridescenceTexture}. */\n\tpublic setIridescenceTexture(texture: Texture | null): this {\n\t\treturn this.setRef('iridescenceTexture', texture, { channels: R });\n\t}\n\n\t/**********************************************************************************************\n\t * Iridescence IOR.\n\t */\n\n\t/** Index of refraction of the dielectric thin-film layer. */\n\tpublic getIridescenceIOR(): number {\n\t\treturn this.get('iridescenceIOR');\n\t}\n\n\t/** Index of refraction of the dielectric thin-film layer. */\n\tpublic setIridescenceIOR(ior: number): this {\n\t\treturn this.set('iridescenceIOR', ior);\n\t}\n\n\t/**********************************************************************************************\n\t * Iridescence thickness.\n\t */\n\n\t/** Minimum thickness of the thin-film layer, in nanometers (nm). */\n\tpublic getIridescenceThicknessMinimum(): number {\n\t\treturn this.get('iridescenceThicknessMinimum');\n\t}\n\n\t/** Minimum thickness of the thin-film layer, in nanometers (nm). */\n\tpublic setIridescenceThicknessMinimum(thickness: number): this {\n\t\treturn this.set('iridescenceThicknessMinimum', thickness);\n\t}\n\n\t/** Maximum thickness of the thin-film layer, in nanometers (nm). */\n\tpublic getIridescenceThicknessMaximum(): number {\n\t\treturn this.get('iridescenceThicknessMaximum');\n\t}\n\n\t/** Maximum thickness of the thin-film layer, in nanometers (nm). */\n\tpublic setIridescenceThicknessMaximum(thickness: number): this {\n\t\treturn this.set('iridescenceThicknessMaximum', thickness);\n\t}\n\n\t/**\n\t * The green channel of this texture defines the thickness of the\n\t * thin-film layer by blending between the minimum and maximum thickness.\n\t */\n\tpublic getIridescenceThicknessTexture(): Texture | null {\n\t\treturn this.getRef('iridescenceThicknessTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its iridescence thickness texture.\n\t * If no texture is attached, {@link TextureInfo} is `null`.\n\t */\n\tpublic getIridescenceThicknessTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('iridescenceThicknessTexture') ? this.getRef('iridescenceThicknessTextureInfo') : null;\n\t}\n\n\t/**\n\t * Sets iridescence thickness texture.\n\t * See {@link Iridescence.getIridescenceThicknessTexture getIridescenceThicknessTexture}.\n\t */\n\tpublic setIridescenceThicknessTexture(texture: Texture | null): this {\n\t\treturn this.setRef('iridescenceThicknessTexture', texture, { channels: G });\n\t}\n}\n", "import { Extension, type GLTF, PropertyType, type ReaderContext, type WriterContext } from '@gltf-transform/core';\nimport { KHR_MATERIALS_IRIDESCENCE } from '../constants.js';\nimport { Iridescence } from './iridescence.js';\n\ninterface IridescenceDef {\n\tiridescenceFactor: number;\n\tiridescenceTexture: GLTF.ITextureInfo;\n\tiridescenceIor: number;\n\tiridescenceThicknessMinimum: number;\n\tiridescenceThicknessMaximum: number;\n\tiridescenceThicknessTexture: GLTF.ITextureInfo;\n}\n\n/**\n * [`KHR_materials_iridescence`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_iridescence/)\n * defines iridescence (thin film interference) on a PBR material.\n *\n * ![Illustration](/media/extensions/khr-materials-iridescence.png)\n *\n * > _**Figure:** Varying levels of iridescence IOR values.\n * > Source: [Khronos Group](https://github.com/KhronosGroup/gltf/tree/main/extensions/2.0/Khronos/KHR_materials_iridescence)._\n *\n * Iridescence describes an effect where hue varies depending on the viewing\n * angle and illumination angle: A thin-film of a semi-transparent layer\n * results in inter-reflections and due to thin-film interference, certain\n * wavelengths get absorbed or amplified. Iridescence can be seen on soap\n * bubbles, oil films, or on the wings of many insects. With this extension,\n * thickness and index of refraction (IOR) of the thin-film can be specified,\n * enabling iridescent materials.\n *\n * Properties:\n * - {@link Iridescence}\n *\n * ### Example\n *\n * The `KHRMaterialsIridescence` class provides a single {@link ExtensionProperty} type, `Iridescence`,\n * which may be attached to any {@link Material} instance. For example:\n *\n * ```typescript\n * import { KHRMaterialsIridescence, Iridescence } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const iridescenceExtension = document.createExtension(KHRMaterialsIridescence);\n *\n * // Create an Iridescence property.\n * const iridescence = iridescenceExtension.createIridescence()\n * \t.setIridescenceFactor(1.0)\n * \t.setIridescenceIOR(1.8);\n *\n * // Attach the property to a Material.\n * material.setExtension('KHR_materials_iridescence', iridescence);\n * ```\n */\nexport class KHRMaterialsIridescence extends Extension {\n\tpublic static readonly EXTENSION_NAME: typeof KHR_MATERIALS_IRIDESCENCE = KHR_MATERIALS_IRIDESCENCE;\n\tpublic readonly extensionName: typeof KHR_MATERIALS_IRIDESCENCE = KHR_MATERIALS_IRIDESCENCE;\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.MESH];\n\tpublic readonly prewriteTypes: PropertyType[] = [PropertyType.MESH];\n\n\t/** Creates a new Iridescence property for use on a {@link Material}. */\n\tpublic createIridescence(): Iridescence {\n\t\treturn new Iridescence(this.document.getGraph());\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(_context: WriterContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\t\tconst materialDefs = jsonDoc.json.materials || [];\n\t\tconst textureDefs = jsonDoc.json.textures || [];\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\n\t\t\tif (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_IRIDESCENCE]) {\n\t\t\t\tconst iridescence = this.createIridescence();\n\t\t\t\tcontext.materials[materialIndex].setExtension(KHR_MATERIALS_IRIDESCENCE, iridescence);\n\n\t\t\t\tconst iridescenceDef = materialDef.extensions[KHR_MATERIALS_IRIDESCENCE] as IridescenceDef;\n\n\t\t\t\t// Factors.\n\n\t\t\t\tif (iridescenceDef.iridescenceFactor !== undefined) {\n\t\t\t\t\tiridescence.setIridescenceFactor(iridescenceDef.iridescenceFactor);\n\t\t\t\t}\n\t\t\t\tif (iridescenceDef.iridescenceIor !== undefined) {\n\t\t\t\t\tiridescence.setIridescenceIOR(iridescenceDef.iridescenceIor);\n\t\t\t\t}\n\t\t\t\tif (iridescenceDef.iridescenceThicknessMinimum !== undefined) {\n\t\t\t\t\tiridescence.setIridescenceThicknessMinimum(iridescenceDef.iridescenceThicknessMinimum);\n\t\t\t\t}\n\t\t\t\tif (iridescenceDef.iridescenceThicknessMaximum !== undefined) {\n\t\t\t\t\tiridescence.setIridescenceThicknessMaximum(iridescenceDef.iridescenceThicknessMaximum);\n\t\t\t\t}\n\n\t\t\t\t// Textures.\n\n\t\t\t\tif (iridescenceDef.iridescenceTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = iridescenceDef.iridescenceTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\tiridescence.setIridescenceTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(iridescence.getIridescenceTextureInfo()!, textureInfoDef);\n\t\t\t\t}\n\t\t\t\tif (iridescenceDef.iridescenceThicknessTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = iridescenceDef.iridescenceThicknessTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\tiridescence.setIridescenceThicknessTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(iridescence.getIridescenceThicknessTextureInfo()!, textureInfoDef);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic prewrite(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listMaterials()\n\t\t\t.forEach((material) => {\n\t\t\t\tconst iridescence = material.getExtension<Iridescence>(KHR_MATERIALS_IRIDESCENCE);\n\t\t\t\tif (iridescence) {\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\n\n\t\t\t\t\t// Factors.\n\n\t\t\t\t\tconst iridescenceDef = (materialDef.extensions[KHR_MATERIALS_IRIDESCENCE] = {} as IridescenceDef);\n\n\t\t\t\t\tif (iridescence.getIridescenceFactor() > 0) {\n\t\t\t\t\t\tiridescenceDef.iridescenceFactor = iridescence.getIridescenceFactor();\n\t\t\t\t\t}\n\t\t\t\t\tif (iridescence.getIridescenceIOR() !== 1.3) {\n\t\t\t\t\t\tiridescenceDef.iridescenceIor = iridescence.getIridescenceIOR();\n\t\t\t\t\t}\n\t\t\t\t\tif (iridescence.getIridescenceThicknessMinimum() !== 100) {\n\t\t\t\t\t\tiridescenceDef.iridescenceThicknessMinimum = iridescence.getIridescenceThicknessMinimum();\n\t\t\t\t\t}\n\t\t\t\t\tif (iridescence.getIridescenceThicknessMaximum() !== 400) {\n\t\t\t\t\t\tiridescenceDef.iridescenceThicknessMaximum = iridescence.getIridescenceThicknessMaximum();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Textures.\n\n\t\t\t\t\tif (iridescence.getIridescenceTexture()) {\n\t\t\t\t\t\tconst texture = iridescence.getIridescenceTexture()!;\n\t\t\t\t\t\tconst textureInfo = iridescence.getIridescenceTextureInfo()!;\n\t\t\t\t\t\tiridescenceDef.iridescenceTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t\t\t}\n\t\t\t\t\tif (iridescence.getIridescenceThicknessTexture()) {\n\t\t\t\t\t\tconst texture = iridescence.getIridescenceThicknessTexture()!;\n\t\t\t\t\t\tconst textureInfo = iridescence.getIridescenceThicknessTextureInfo()!;\n\t\t\t\t\t\tiridescenceDef.iridescenceThicknessTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n", "import {\n\tExtensionProperty,\n\ttype IProperty,\n\ttype Nullable,\n\tPropertyType,\n\ttype Texture,\n\tTextureChannel,\n\tTextureInfo,\n\ttype vec3,\n\ttype vec4,\n} from '@gltf-transform/core';\nimport { KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS } from '../constants.js';\n\ninterface IPBRSpecularGlossiness extends IProperty {\n\tdiffuseFactor: vec4;\n\tdiffuseTexture: Texture;\n\tdiffuseTextureInfo: TextureInfo;\n\tspecularFactor: vec3;\n\tglossinessFactor: number;\n\tspecularGlossinessTexture: Texture;\n\tspecularGlossinessTextureInfo: TextureInfo;\n}\n\nconst { R, G, B, A } = TextureChannel;\n\n/**\n * Converts a {@link Material} to a spec/gloss workflow. See {@link KHRMaterialsPBRSpecularGlossiness}.\n */\nexport class PBRSpecularGlossiness extends ExtensionProperty<IPBRSpecularGlossiness> {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS = KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\n\tpublic declare extensionName: typeof KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\n\tpublic declare propertyType: 'PBRSpecularGlossiness';\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\n\t\tthis.propertyType = 'PBRSpecularGlossiness';\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\n\t}\n\n\tprotected getDefaults(): Nullable<IPBRSpecularGlossiness> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\n\t\t\tdiffuseFactor: [1.0, 1.0, 1.0, 1.0] as vec4,\n\t\t\tdiffuseTexture: null,\n\t\t\tdiffuseTextureInfo: new TextureInfo(this.graph, 'diffuseTextureInfo'),\n\t\t\tspecularFactor: [1.0, 1.0, 1.0] as vec3,\n\t\t\tglossinessFactor: 1.0,\n\t\t\tspecularGlossinessTexture: null,\n\t\t\tspecularGlossinessTextureInfo: new TextureInfo(this.graph, 'specularGlossinessTextureInfo'),\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * Diffuse.\n\t */\n\n\t/** Diffuse; Linear-sRGB components. See {@link PBRSpecularGlossiness.getDiffuseTexture getDiffuseTexture}. */\n\tpublic getDiffuseFactor(): vec4 {\n\t\treturn this.get('diffuseFactor');\n\t}\n\n\t/** Diffuse; Linear-sRGB components. See {@link PBRSpecularGlossiness.getDiffuseTexture getDiffuseTexture}. */\n\tpublic setDiffuseFactor(factor: vec4): this {\n\t\treturn this.set('diffuseFactor', factor);\n\t}\n\n\t/**\n\t * Diffuse texture; sRGB. Alternative to baseColorTexture, used within the\n\t * spec/gloss PBR workflow.\n\t */\n\tpublic getDiffuseTexture(): Texture | null {\n\t\treturn this.getRef('diffuseTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its diffuse texture. If no texture is attached,\n\t * {@link TextureInfo} is `null`.\n\t */\n\tpublic getDiffuseTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('diffuseTexture') ? this.getRef('diffuseTextureInfo') : null;\n\t}\n\n\t/** Sets diffuse texture. See {@link PBRSpecularGlossiness.getDiffuseTexture getDiffuseTexture}. */\n\tpublic setDiffuseTexture(texture: Texture | null): this {\n\t\treturn this.setRef('diffuseTexture', texture, { channels: R | G | B | A, isColor: true });\n\t}\n\n\t/**********************************************************************************************\n\t * Specular.\n\t */\n\n\t/** Specular; linear multiplier. */\n\tpublic getSpecularFactor(): vec3 {\n\t\treturn this.get('specularFactor');\n\t}\n\n\t/** Specular; linear multiplier. */\n\tpublic setSpecularFactor(factor: vec3): this {\n\t\treturn this.set('specularFactor', factor);\n\t}\n\n\t/**********************************************************************************************\n\t * Glossiness.\n\t */\n\n\t/** Glossiness; linear multiplier. */\n\tpublic getGlossinessFactor(): number {\n\t\treturn this.get('glossinessFactor');\n\t}\n\n\t/** Glossiness; linear multiplier. */\n\tpublic setGlossinessFactor(factor: number): this {\n\t\treturn this.set('glossinessFactor', factor);\n\t}\n\n\t/**********************************************************************************************\n\t * Specular/Glossiness.\n\t */\n\n\t/** Spec/gloss texture; linear multiplier. */\n\tpublic getSpecularGlossinessTexture(): Texture | null {\n\t\treturn this.getRef('specularGlossinessTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its spec/gloss texture. If no texture is attached,\n\t * {@link TextureInfo} is `null`.\n\t */\n\tpublic getSpecularGlossinessTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('specularGlossinessTexture') ? this.getRef('specularGlossinessTextureInfo') : null;\n\t}\n\n\t/** Spec/gloss texture; linear multiplier. */\n\tpublic setSpecularGlossinessTexture(texture: Texture | null): this {\n\t\treturn this.setRef('specularGlossinessTexture', texture, { channels: R | G | B | A });\n\t}\n}\n", "import {\n\tExtension,\n\ttype GLTF,\n\tPropertyType,\n\ttype ReaderContext,\n\ttype vec3,\n\ttype vec4,\n\ttype WriterContext,\n} from '@gltf-transform/core';\nimport { KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS } from '../constants.js';\nimport { PBRSpecularGlossiness } from './pbr-specular-glossiness.js';\n\ninterface SpecularGlossinessDef {\n\tdiffuseFactor?: vec4;\n\tspecularFactor: vec3;\n\tglossinessFactor: number;\n\tdiffuseTexture?: GLTF.ITextureInfo;\n\tspecularGlossinessTexture?: GLTF.ITextureInfo;\n}\n\n/**\n * [`KHR_materials_pbrSpecularGlossiness`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_pbrSpecularGlossiness/)\n * converts a PBR material from the default metal/rough workflow to a spec/gloss workflow.\n *\n * > _**NOTICE:** The spec/gloss workflow does _not_ support other PBR extensions such as clearcoat,\n * > transmission, IOR, etc. For the complete PBR feature set and specular data, use the\n * > {@link KHRMaterialsSpecular} extension instead, which provides specular data within a metal/rough\n * > workflow._\n *\n * ![Illustration](/media/extensions/khr-material-pbr-specular-glossiness.png)\n *\n * > _**Figure:** Components of a PBR spec/gloss material. Source: Khronos Group._\n *\n * Properties:\n * - {@link PBRSpecularGlossiness}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMaterialsPBRSpecularGlossiness } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const specGlossExtension = document.createExtension(KHRMaterialsPBRSpecularGlossiness);\n *\n * // Create a PBRSpecularGlossiness property.\n * const specGloss = specGlossExtension.createPBRSpecularGlossiness()\n * \t.setSpecularFactor(1.0);\n *\n * // // Assign to a Material.\n * material.setExtension('KHR_materials_pbrSpecularGlossiness', specGloss);\n * ```\n */\nexport class KHRMaterialsPBRSpecularGlossiness extends Extension {\n\tpublic static readonly EXTENSION_NAME: typeof KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS =\n\t\tKHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\n\tpublic readonly extensionName: typeof KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS = KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.MESH];\n\tpublic readonly prewriteTypes: PropertyType[] = [PropertyType.MESH];\n\n\t/** Creates a new PBRSpecularGlossiness property for use on a {@link Material}. */\n\tpublic createPBRSpecularGlossiness(): PBRSpecularGlossiness {\n\t\treturn new PBRSpecularGlossiness(this.document.getGraph());\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(_context: WriterContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\t\tconst materialDefs = jsonDoc.json.materials || [];\n\t\tconst textureDefs = jsonDoc.json.textures || [];\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\n\t\t\tif (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]) {\n\t\t\t\tconst specGloss = this.createPBRSpecularGlossiness();\n\t\t\t\tcontext.materials[materialIndex].setExtension(KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS, specGloss);\n\n\t\t\t\tconst specGlossDef = materialDef.extensions[\n\t\t\t\t\tKHR_MATERIALS_PBR_SPECULAR_GLOSSINESS\n\t\t\t\t] as SpecularGlossinessDef;\n\n\t\t\t\t// Factors.\n\n\t\t\t\tif (specGlossDef.diffuseFactor !== undefined) {\n\t\t\t\t\tspecGloss.setDiffuseFactor(specGlossDef.diffuseFactor);\n\t\t\t\t}\n\t\t\t\tif (specGlossDef.specularFactor !== undefined) {\n\t\t\t\t\tspecGloss.setSpecularFactor(specGlossDef.specularFactor);\n\t\t\t\t}\n\t\t\t\tif (specGlossDef.glossinessFactor !== undefined) {\n\t\t\t\t\tspecGloss.setGlossinessFactor(specGlossDef.glossinessFactor);\n\t\t\t\t}\n\n\t\t\t\t// Textures.\n\n\t\t\t\tif (specGlossDef.diffuseTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = specGlossDef.diffuseTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\tspecGloss.setDiffuseTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(specGloss.getDiffuseTextureInfo()!, textureInfoDef);\n\t\t\t\t}\n\t\t\t\tif (specGlossDef.specularGlossinessTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = specGlossDef.specularGlossinessTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\tspecGloss.setSpecularGlossinessTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(specGloss.getSpecularGlossinessTextureInfo()!, textureInfoDef);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic prewrite(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listMaterials()\n\t\t\t.forEach((material) => {\n\t\t\t\tconst specGloss = material.getExtension<PBRSpecularGlossiness>(KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS);\n\t\t\t\tif (specGloss) {\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\n\n\t\t\t\t\t// Factors.\n\n\t\t\t\t\tconst specGlossDef = (materialDef.extensions[KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS] = {\n\t\t\t\t\t\tdiffuseFactor: specGloss.getDiffuseFactor(),\n\t\t\t\t\t\tspecularFactor: specGloss.getSpecularFactor(),\n\t\t\t\t\t\tglossinessFactor: specGloss.getGlossinessFactor(),\n\t\t\t\t\t} as SpecularGlossinessDef);\n\n\t\t\t\t\t// Textures.\n\n\t\t\t\t\tif (specGloss.getDiffuseTexture()) {\n\t\t\t\t\t\tconst texture = specGloss.getDiffuseTexture()!;\n\t\t\t\t\t\tconst textureInfo = specGloss.getDiffuseTextureInfo()!;\n\t\t\t\t\t\tspecGlossDef.diffuseTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t\t\t}\n\t\t\t\t\tif (specGloss.getSpecularGlossinessTexture()) {\n\t\t\t\t\t\tconst texture = specGloss.getSpecularGlossinessTexture()!;\n\t\t\t\t\t\tconst textureInfo = specGloss.getSpecularGlossinessTextureInfo()!;\n\t\t\t\t\t\tspecGlossDef.specularGlossinessTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n", "import {\n\tExtensionProperty,\n\ttype IProperty,\n\ttype Nullable,\n\tPropertyType,\n\ttype Texture,\n\tTextureChannel,\n\tTextureInfo,\n\ttype vec3,\n} from '@gltf-transform/core';\nimport { KHR_MATERIALS_SHEEN } from '../constants.js';\n\ninterface ISheen extends IProperty {\n\tsheenColorFactor: vec3;\n\tsheenColorTexture: Texture;\n\tsheenColorTextureInfo: TextureInfo;\n\tsheenRoughnessFactor: number;\n\tsheenRoughnessTexture: Texture;\n\tsheenRoughnessTextureInfo: TextureInfo;\n}\n\nconst { R, G, B, A } = TextureChannel;\n\n/**\n * Defines sheen on a PBR {@link Material}. See {@link KHRMaterialsSheen}.\n */\nexport class Sheen extends ExtensionProperty<ISheen> {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_SHEEN = KHR_MATERIALS_SHEEN;\n\tpublic declare extensionName: typeof KHR_MATERIALS_SHEEN;\n\tpublic declare propertyType: 'Sheen';\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_SHEEN;\n\t\tthis.propertyType = 'Sheen';\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\n\t}\n\n\tprotected getDefaults(): Nullable<ISheen> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\n\t\t\tsheenColorFactor: [0.0, 0.0, 0.0] as vec3,\n\t\t\tsheenColorTexture: null,\n\t\t\tsheenColorTextureInfo: new TextureInfo(this.graph, 'sheenColorTextureInfo'),\n\t\t\tsheenRoughnessFactor: 0.0,\n\t\t\tsheenRoughnessTexture: null,\n\t\t\tsheenRoughnessTextureInfo: new TextureInfo(this.graph, 'sheenRoughnessTextureInfo'),\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * Sheen color.\n\t */\n\n\t/** Sheen; linear multiplier. */\n\tpublic getSheenColorFactor(): vec3 {\n\t\treturn this.get('sheenColorFactor');\n\t}\n\n\t/** Sheen; linear multiplier. */\n\tpublic setSheenColorFactor(factor: vec3): this {\n\t\treturn this.set('sheenColorFactor', factor);\n\t}\n\n\t/**\n\t * Sheen color texture, in sRGB colorspace.\n\t */\n\tpublic getSheenColorTexture(): Texture | null {\n\t\treturn this.getRef('sheenColorTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its sheen color texture. If no texture is attached,\n\t * {@link TextureInfo} is `null`.\n\t */\n\tpublic getSheenColorTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('sheenColorTexture') ? this.getRef('sheenColorTextureInfo') : null;\n\t}\n\n\t/** Sets sheen color texture. See {@link Sheen.getSheenColorTexture getSheenColorTexture}. */\n\tpublic setSheenColorTexture(texture: Texture | null): this {\n\t\treturn this.setRef('sheenColorTexture', texture, { channels: R | G | B, isColor: true });\n\t}\n\n\t/**********************************************************************************************\n\t * Sheen roughness.\n\t */\n\n\t/** Sheen roughness; linear multiplier. See {@link Sheen.getSheenRoughnessTexture getSheenRoughnessTexture}. */\n\tpublic getSheenRoughnessFactor(): number {\n\t\treturn this.get('sheenRoughnessFactor');\n\t}\n\n\t/** Sheen roughness; linear multiplier. See {@link Sheen.getSheenRoughnessTexture getSheenRoughnessTexture}. */\n\tpublic setSheenRoughnessFactor(factor: number): this {\n\t\treturn this.set('sheenRoughnessFactor', factor);\n\t}\n\n\t/**\n\t * Sheen roughness texture; linear multiplier. The `a` channel of this texture specifies\n\t * roughness, independent of the base layer's roughness.\n\t */\n\tpublic getSheenRoughnessTexture(): Texture | null {\n\t\treturn this.getRef('sheenRoughnessTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its sheen roughness texture. If no texture is\n\t * attached, {@link TextureInfo} is `null`.\n\t */\n\tpublic getSheenRoughnessTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('sheenRoughnessTexture') ? this.getRef('sheenRoughnessTextureInfo') : null;\n\t}\n\n\t/**\n\t * Sets sheen roughness texture.  The `a` channel of this texture specifies\n\t * roughness, independent of the base layer's roughness.\n\t */\n\tpublic setSheenRoughnessTexture(texture: Texture | null): this {\n\t\treturn this.setRef('sheenRoughnessTexture', texture, { channels: A });\n\t}\n}\n", "import {\n\tExtension,\n\ttype GLTF,\n\tPropertyType,\n\ttype ReaderContext,\n\ttype vec3,\n\ttype WriterContext,\n} from '@gltf-transform/core';\nimport { KHR_MATERIALS_SHEEN } from '../constants.js';\nimport { Sheen } from './sheen.js';\n\ninterface SheenDef {\n\tsheenColorFactor?: vec3;\n\tsheenRoughnessFactor?: number;\n\tsheenColorTexture?: GLTF.ITextureInfo;\n\tsheenRoughnessTexture?: GLTF.ITextureInfo;\n}\n\n/**\n * [`KHR_materials_sheen`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_sheen/)\n * defines a velvet-like sheen layered on a glTF PBR material.\n *\n * ![Illustration](/media/extensions/khr-materials-sheen.png)\n *\n * > _**Figure:** A cushion, showing high material roughness and low sheen roughness. Soft\n * > highlights at edges of the material show backscattering from microfibers. Source: Khronos\n * > Group._\n *\n * A sheen layer is a common technique used in Physically-Based Rendering to represent\n * cloth and fabric materials.\n *\n * Properties:\n * - {@link Sheen}\n *\n * ### Example\n *\n * The `KHRMaterialsSheen` class provides a single {@link ExtensionProperty} type, `Sheen`,\n * which may be attached to any {@link Material} instance. For example:\n *\n * ```typescript\n * import { KHRMaterialsSheen, Sheen } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const sheenExtension = document.createExtension(KHRMaterialsSheen);\n *\n * // Create a Sheen property.\n * const sheen = sheenExtension.createSheen()\n * \t.setSheenColorFactor([1.0, 1.0, 1.0]);\n *\n * // Attach the property to a Material.\n * material.setExtension('KHR_materials_sheen', sheen);\n * ```\n */\nexport class KHRMaterialsSheen extends Extension {\n\tpublic static readonly EXTENSION_NAME: typeof KHR_MATERIALS_SHEEN = KHR_MATERIALS_SHEEN;\n\tpublic readonly extensionName: typeof KHR_MATERIALS_SHEEN = KHR_MATERIALS_SHEEN;\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.MESH];\n\tpublic readonly prewriteTypes: PropertyType[] = [PropertyType.MESH];\n\n\t/** Creates a new Sheen property for use on a {@link Material}. */\n\tpublic createSheen(): Sheen {\n\t\treturn new Sheen(this.document.getGraph());\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(_context: WriterContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\t\tconst materialDefs = jsonDoc.json.materials || [];\n\t\tconst textureDefs = jsonDoc.json.textures || [];\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\n\t\t\tif (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_SHEEN]) {\n\t\t\t\tconst sheen = this.createSheen();\n\t\t\t\tcontext.materials[materialIndex].setExtension(KHR_MATERIALS_SHEEN, sheen);\n\n\t\t\t\tconst sheenDef = materialDef.extensions[KHR_MATERIALS_SHEEN] as SheenDef;\n\n\t\t\t\t// Factors.\n\n\t\t\t\tif (sheenDef.sheenColorFactor !== undefined) {\n\t\t\t\t\tsheen.setSheenColorFactor(sheenDef.sheenColorFactor);\n\t\t\t\t}\n\t\t\t\tif (sheenDef.sheenRoughnessFactor !== undefined) {\n\t\t\t\t\tsheen.setSheenRoughnessFactor(sheenDef.sheenRoughnessFactor);\n\t\t\t\t}\n\n\t\t\t\t// Textures.\n\n\t\t\t\tif (sheenDef.sheenColorTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = sheenDef.sheenColorTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\tsheen.setSheenColorTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(sheen.getSheenColorTextureInfo()!, textureInfoDef);\n\t\t\t\t}\n\t\t\t\tif (sheenDef.sheenRoughnessTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = sheenDef.sheenRoughnessTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\tsheen.setSheenRoughnessTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(sheen.getSheenRoughnessTextureInfo()!, textureInfoDef);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic prewrite(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listMaterials()\n\t\t\t.forEach((material) => {\n\t\t\t\tconst sheen = material.getExtension<Sheen>(KHR_MATERIALS_SHEEN);\n\t\t\t\tif (sheen) {\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\n\n\t\t\t\t\t// Factors.\n\n\t\t\t\t\tconst sheenDef = (materialDef.extensions[KHR_MATERIALS_SHEEN] = {\n\t\t\t\t\t\tsheenColorFactor: sheen.getSheenColorFactor(),\n\t\t\t\t\t\tsheenRoughnessFactor: sheen.getSheenRoughnessFactor(),\n\t\t\t\t\t} as SheenDef);\n\n\t\t\t\t\t// Textures.\n\n\t\t\t\t\tif (sheen.getSheenColorTexture()) {\n\t\t\t\t\t\tconst texture = sheen.getSheenColorTexture()!;\n\t\t\t\t\t\tconst textureInfo = sheen.getSheenColorTextureInfo()!;\n\t\t\t\t\t\tsheenDef.sheenColorTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t\t\t}\n\t\t\t\t\tif (sheen.getSheenRoughnessTexture()) {\n\t\t\t\t\t\tconst texture = sheen.getSheenRoughnessTexture()!;\n\t\t\t\t\t\tconst textureInfo = sheen.getSheenRoughnessTextureInfo()!;\n\t\t\t\t\t\tsheenDef.sheenRoughnessTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n", "import {\n\tExtensionProperty,\n\ttype IProperty,\n\ttype Nullable,\n\tPropertyType,\n\ttype Texture,\n\tTextureChannel,\n\tTextureInfo,\n\ttype vec3,\n} from '@gltf-transform/core';\nimport { KHR_MATERIALS_SPECULAR } from '../constants.js';\n\ninterface ISpecular extends IProperty {\n\tspecularFactor: number;\n\tspecularTexture: Texture;\n\tspecularTextureInfo: TextureInfo;\n\tspecularColorFactor: vec3;\n\tspecularColorTexture: Texture;\n\tspecularColorTextureInfo: TextureInfo;\n}\n\nconst { R, G, B, A } = TextureChannel;\n\n/**\n * Defines specular reflectivity on a PBR {@link Material}. See {@link KHRMaterialsSpecular}.\n */\nexport class Specular extends ExtensionProperty<ISpecular> {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_SPECULAR = KHR_MATERIALS_SPECULAR;\n\tpublic declare extensionName: typeof KHR_MATERIALS_SPECULAR;\n\tpublic declare propertyType: 'Specular';\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_SPECULAR;\n\t\tthis.propertyType = 'Specular';\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\n\t}\n\n\tprotected getDefaults(): Nullable<ISpecular> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\n\t\t\tspecularFactor: 1.0,\n\t\t\tspecularTexture: null,\n\t\t\tspecularTextureInfo: new TextureInfo(this.graph, 'specularTextureInfo'),\n\t\t\tspecularColorFactor: [1.0, 1.0, 1.0] as vec3,\n\t\t\tspecularColorTexture: null,\n\t\t\tspecularColorTextureInfo: new TextureInfo(this.graph, 'specularColorTextureInfo'),\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * Specular.\n\t */\n\n\t/** Specular; linear multiplier. See {@link Specular.getSpecularTexture getSpecularTexture}. */\n\tpublic getSpecularFactor(): number {\n\t\treturn this.get('specularFactor');\n\t}\n\n\t/** Specular; linear multiplier. See {@link Specular.getSpecularTexture getSpecularTexture}. */\n\tpublic setSpecularFactor(factor: number): this {\n\t\treturn this.set('specularFactor', factor);\n\t}\n\n\t/** Specular color; Linear-sRGB components. See {@link Specular.getSpecularTexture getSpecularTexture}. */\n\tpublic getSpecularColorFactor(): vec3 {\n\t\treturn this.get('specularColorFactor');\n\t}\n\n\t/** Specular color; Linear-sRGB components. See {@link Specular.getSpecularTexture getSpecularTexture}. */\n\tpublic setSpecularColorFactor(factor: vec3): this {\n\t\treturn this.set('specularColorFactor', factor);\n\t}\n\n\t/**\n\t * Specular texture; linear multiplier. Configures the strength of the specular reflection in\n\t * the dielectric BRDF. A value of zero disables the specular reflection, resulting in a pure\n\t * diffuse material.\n\t *\n\t * Only the alpha (A) channel is used for specular strength, but this texture may optionally\n\t * be packed with specular color (RGB) into a single texture.\n\t */\n\tpublic getSpecularTexture(): Texture | null {\n\t\treturn this.getRef('specularTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its specular texture. If no texture is attached,\n\t * {@link TextureInfo} is `null`.\n\t */\n\tpublic getSpecularTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('specularTexture') ? this.getRef('specularTextureInfo') : null;\n\t}\n\n\t/** Sets specular texture. See {@link Specular.getSpecularTexture getSpecularTexture}. */\n\tpublic setSpecularTexture(texture: Texture | null): this {\n\t\treturn this.setRef('specularTexture', texture, { channels: A });\n\t}\n\n\t/**\n\t * Specular color texture; linear multiplier. Defines the F0 color of the specular reflection\n\t * (RGB channels, encoded in sRGB) in the the dielectric BRDF.\n\t *\n\t * Only RGB channels are used here, but this texture may optionally be packed with a specular\n\t * factor (A) into a single texture.\n\t */\n\tpublic getSpecularColorTexture(): Texture | null {\n\t\treturn this.getRef('specularColorTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its specular color texture. If no texture is\n\t * attached, {@link TextureInfo} is `null`.\n\t */\n\tpublic getSpecularColorTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('specularColorTexture') ? this.getRef('specularColorTextureInfo') : null;\n\t}\n\n\t/** Sets specular color texture. See {@link Specular.getSpecularColorTexture getSpecularColorTexture}. */\n\tpublic setSpecularColorTexture(texture: Texture | null): this {\n\t\treturn this.setRef('specularColorTexture', texture, { channels: R | G | B, isColor: true });\n\t}\n}\n", "import {\n\tExtension,\n\ttype GLTF,\n\tMathUtils,\n\tPropertyType,\n\ttype ReaderContext,\n\ttype vec3,\n\ttype WriterContext,\n} from '@gltf-transform/core';\nimport { KHR_MATERIALS_SPECULAR } from '../constants.js';\nimport { Specular } from './specular.js';\n\ninterface SpecularDef {\n\tspecularFactor?: number;\n\tspecularColorFactor?: vec3;\n\tspecularTexture?: GLTF.ITextureInfo;\n\tspecularColorTexture?: GLTF.ITextureInfo;\n}\n\n/**\n * [`KHR_materials_specular`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_specular/)\n * adjusts the strength of the specular reflection in the dielectric BRDF.\n *\n * KHRMaterialsSpecular is a better alternative to the older\n * {@link KHRMaterialsPBRSpecularGlossiness KHR_materials_pbrSpecularGlossiness} extension, and\n * provides specular information while remaining within a metal/rough PBR workflow. A\n * value of zero disables the specular reflection, resulting in a pure diffuse material.\n *\n * Properties:\n * - {@link Specular}\n *\n * ### Example\n *\n * The `KHRMaterialsSpecular` class provides a single {@link ExtensionProperty} type, `Specular`,\n * which may be attached to any {@link Material} instance. For example:\n *\n * ```typescript\n * import { KHRMaterialsSpecular, Specular } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const specularExtension = document.createExtension(KHRMaterialsSpecular);\n *\n * // Create a Specular property.\n * const specular = specularExtension.createSpecular()\n * \t.setSpecularFactor(1.0);\n *\n * // Attach the property to a Material.\n * material.setExtension('KHR_materials_specular', specular);\n * ```\n */\nexport class KHRMaterialsSpecular extends Extension {\n\tpublic static readonly EXTENSION_NAME: typeof KHR_MATERIALS_SPECULAR = KHR_MATERIALS_SPECULAR;\n\tpublic readonly extensionName: typeof KHR_MATERIALS_SPECULAR = KHR_MATERIALS_SPECULAR;\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.MESH];\n\tpublic readonly prewriteTypes: PropertyType[] = [PropertyType.MESH];\n\n\t/** Creates a new Specular property for use on a {@link Material}. */\n\tpublic createSpecular(): Specular {\n\t\treturn new Specular(this.document.getGraph());\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(_context: WriterContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\t\tconst materialDefs = jsonDoc.json.materials || [];\n\t\tconst textureDefs = jsonDoc.json.textures || [];\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\n\t\t\tif (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_SPECULAR]) {\n\t\t\t\tconst specular = this.createSpecular();\n\t\t\t\tcontext.materials[materialIndex].setExtension(KHR_MATERIALS_SPECULAR, specular);\n\n\t\t\t\tconst specularDef = materialDef.extensions[KHR_MATERIALS_SPECULAR] as SpecularDef;\n\n\t\t\t\t// Factors.\n\n\t\t\t\tif (specularDef.specularFactor !== undefined) {\n\t\t\t\t\tspecular.setSpecularFactor(specularDef.specularFactor);\n\t\t\t\t}\n\t\t\t\tif (specularDef.specularColorFactor !== undefined) {\n\t\t\t\t\tspecular.setSpecularColorFactor(specularDef.specularColorFactor);\n\t\t\t\t}\n\n\t\t\t\t// Textures.\n\n\t\t\t\tif (specularDef.specularTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = specularDef.specularTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\tspecular.setSpecularTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(specular.getSpecularTextureInfo()!, textureInfoDef);\n\t\t\t\t}\n\t\t\t\tif (specularDef.specularColorTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = specularDef.specularColorTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\tspecular.setSpecularColorTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(specular.getSpecularColorTextureInfo()!, textureInfoDef);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic prewrite(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listMaterials()\n\t\t\t.forEach((material) => {\n\t\t\t\tconst specular = material.getExtension<Specular>(KHR_MATERIALS_SPECULAR);\n\t\t\t\tif (specular) {\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\n\n\t\t\t\t\t// Factors.\n\n\t\t\t\t\tconst specularDef = (materialDef.extensions[KHR_MATERIALS_SPECULAR] = {} as SpecularDef);\n\n\t\t\t\t\tif (specular.getSpecularFactor() !== 1) {\n\t\t\t\t\t\tspecularDef.specularFactor = specular.getSpecularFactor();\n\t\t\t\t\t}\n\t\t\t\t\tif (!MathUtils.eq(specular.getSpecularColorFactor(), [1, 1, 1])) {\n\t\t\t\t\t\tspecularDef.specularColorFactor = specular.getSpecularColorFactor();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Textures.\n\n\t\t\t\t\tif (specular.getSpecularTexture()) {\n\t\t\t\t\t\tconst texture = specular.getSpecularTexture()!;\n\t\t\t\t\t\tconst textureInfo = specular.getSpecularTextureInfo()!;\n\t\t\t\t\t\tspecularDef.specularTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t\t\t}\n\t\t\t\t\tif (specular.getSpecularColorTexture()) {\n\t\t\t\t\t\tconst texture = specular.getSpecularColorTexture()!;\n\t\t\t\t\t\tconst textureInfo = specular.getSpecularColorTextureInfo()!;\n\t\t\t\t\t\tspecularDef.specularColorTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n", "import {\n\tExtensionProperty,\n\ttype IProperty,\n\ttype Nullable,\n\tPropertyType,\n\ttype Texture,\n\tTextureChannel,\n\tTextureInfo,\n} from '@gltf-transform/core';\nimport { KHR_MATERIALS_TRANSMISSION } from '../constants.js';\n\ninterface ITransmission extends IProperty {\n\ttransmissionFactor: number;\n\ttransmissionTexture: Texture;\n\ttransmissionTextureInfo: TextureInfo;\n}\n\nconst { R } = TextureChannel;\n\n/**\n * Defines optical transmission on a PBR {@link Material}. See {@link KHRMaterialsTransmission}.\n */\nexport class Transmission extends ExtensionProperty<ITransmission> {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_TRANSMISSION = KHR_MATERIALS_TRANSMISSION;\n\tpublic declare extensionName: typeof KHR_MATERIALS_TRANSMISSION;\n\tpublic declare propertyType: 'Transmission';\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_TRANSMISSION;\n\t\tthis.propertyType = 'Transmission';\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\n\t}\n\n\tprotected getDefaults(): Nullable<ITransmission> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\n\t\t\ttransmissionFactor: 0.0,\n\t\t\ttransmissionTexture: null,\n\t\t\ttransmissionTextureInfo: new TextureInfo(this.graph, 'transmissionTextureInfo'),\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * Transmission.\n\t */\n\n\t/** Transmission; linear multiplier. See {@link Transmission.getTransmissionTexture getTransmissionTexture}. */\n\tpublic getTransmissionFactor(): number {\n\t\treturn this.get('transmissionFactor');\n\t}\n\n\t/** Transmission; linear multiplier. See {@link Transmission.getTransmissionTexture getTransmissionTexture}. */\n\tpublic setTransmissionFactor(factor: number): this {\n\t\treturn this.set('transmissionFactor', factor);\n\t}\n\n\t/**\n\t * Transmission texture; linear multiplier. The `r` channel of this texture specifies\n\t * transmission [0-1] of the material's surface. By default this is a thin transparency\n\t * effect, but volume effects (refraction, subsurface scattering) may be introduced with the\n\t * addition of the `KHR_materials_volume` extension.\n\t */\n\tpublic getTransmissionTexture(): Texture | null {\n\t\treturn this.getRef('transmissionTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its transmission texture. If no texture is attached,\n\t * {@link TextureInfo} is `null`.\n\t */\n\tpublic getTransmissionTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('transmissionTexture') ? this.getRef('transmissionTextureInfo') : null;\n\t}\n\n\t/** Sets transmission texture. See {@link Transmission.getTransmissionTexture getTransmissionTexture}. */\n\tpublic setTransmissionTexture(texture: Texture | null): this {\n\t\treturn this.setRef('transmissionTexture', texture, { channels: R });\n\t}\n}\n", "import { Extension, type GLTF, PropertyType, type ReaderContext, type WriterContext } from '@gltf-transform/core';\nimport { KHR_MATERIALS_TRANSMISSION } from '../constants.js';\nimport { Transmission } from './transmission.js';\n\ninterface TransmissionDef {\n\ttransmissionFactor?: number;\n\ttransmissionTexture?: GLTF.ITextureInfo;\n}\n\n/**\n * [`KHR_materials_transmission`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_transmission/)\n * provides a common type of optical transparency: infinitely-thin materials with no refraction,\n * scattering, or dispersion.\n *\n * ![Illustration](/media/extensions/khr-materials-transmission.png)\n *\n * > _**Figure:** Sphere using `KHR_materials_transmission` with varying roughness (0.0, 0.2, 0.4).\n * > Source: Khronos Group._\n *\n * While default PBR materials using alpha blending become invisible as their opacity approaches\n * zero, a transmissive material continues to reflect light in a glass-like manner, even at low\n * transmission values. When combined with {@link KHRMaterialsVolume}, transmission may be used for\n * thicker materials and refractive effects.\n *\n * Properties:\n * - {@link Transmission}\n *\n * ### Example\n *\n * The `KHRMaterialsTransmission` class provides a single {@link ExtensionProperty} type,\n * `Transmission`, which may be attached to any {@link Material} instance. For example:\n *\n * ```typescript\n * import { KHRMaterialsTransmission, Transmission } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const transmissionExtension = document.createExtension(KHRMaterialsTransmission);\n *\n * // Create a Transmission property.\n * const transmission = transmissionExtension.createTransmission()\n * \t.setTransmissionFactor(1.0);\n *\n * // Attach the property to a Material.\n * material.setExtension('KHR_materials_transmission', transmission);\n * ```\n */\nexport class KHRMaterialsTransmission extends Extension {\n\tpublic static readonly EXTENSION_NAME: typeof KHR_MATERIALS_TRANSMISSION = KHR_MATERIALS_TRANSMISSION;\n\tpublic readonly extensionName: typeof KHR_MATERIALS_TRANSMISSION = KHR_MATERIALS_TRANSMISSION;\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.MESH];\n\tpublic readonly prewriteTypes: PropertyType[] = [PropertyType.MESH];\n\n\t/** Creates a new Transmission property for use on a {@link Material}. */\n\tpublic createTransmission(): Transmission {\n\t\treturn new Transmission(this.document.getGraph());\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(_context: WriterContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\t\tconst materialDefs = jsonDoc.json.materials || [];\n\t\tconst textureDefs = jsonDoc.json.textures || [];\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\n\t\t\tif (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_TRANSMISSION]) {\n\t\t\t\tconst transmission = this.createTransmission();\n\t\t\t\tcontext.materials[materialIndex].setExtension(KHR_MATERIALS_TRANSMISSION, transmission);\n\n\t\t\t\tconst transmissionDef = materialDef.extensions[KHR_MATERIALS_TRANSMISSION] as TransmissionDef;\n\n\t\t\t\t// Factors.\n\n\t\t\t\tif (transmissionDef.transmissionFactor !== undefined) {\n\t\t\t\t\ttransmission.setTransmissionFactor(transmissionDef.transmissionFactor);\n\t\t\t\t}\n\n\t\t\t\t// Textures.\n\n\t\t\t\tif (transmissionDef.transmissionTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = transmissionDef.transmissionTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\ttransmission.setTransmissionTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(transmission.getTransmissionTextureInfo()!, textureInfoDef);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic prewrite(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listMaterials()\n\t\t\t.forEach((material) => {\n\t\t\t\tconst transmission = material.getExtension<Transmission>(KHR_MATERIALS_TRANSMISSION);\n\t\t\t\tif (transmission) {\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\n\n\t\t\t\t\t// Factors.\n\n\t\t\t\t\tconst transmissionDef = (materialDef.extensions[KHR_MATERIALS_TRANSMISSION] = {\n\t\t\t\t\t\ttransmissionFactor: transmission.getTransmissionFactor(),\n\t\t\t\t\t} as TransmissionDef);\n\n\t\t\t\t\t// Textures.\n\n\t\t\t\t\tif (transmission.getTransmissionTexture()) {\n\t\t\t\t\t\tconst texture = transmission.getTransmissionTexture()!;\n\t\t\t\t\t\tconst textureInfo = transmission.getTransmissionTextureInfo()!;\n\t\t\t\t\t\ttransmissionDef.transmissionTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n", "import { ExtensionProperty, PropertyType } from '@gltf-transform/core';\nimport { KHR_MATERIALS_UNLIT } from '../constants.js';\n\n/**\n * Converts a PBR {@link Material} to an unlit shading model. See {@link KHRMaterialsUnlit}.\n */\nexport class Unlit extends ExtensionProperty {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_UNLIT = KHR_MATERIALS_UNLIT;\n\tpublic declare extensionName: typeof KHR_MATERIALS_UNLIT;\n\tpublic declare propertyType: 'Unlit';\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_UNLIT;\n\t\tthis.propertyType = 'Unlit';\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\n\t}\n}\n", "import { Extension, PropertyType, type ReaderContext, type WriterContext } from '@gltf-transform/core';\nimport { KHR_MATERIALS_UNLIT } from '../constants.js';\nimport { Unlit } from './unlit.js';\n\n/**\n * [`KHR_materials_unlit`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_unlit/)\n * defines an unlit shading model for use in glTF 2.0 materials.\n *\n * ![Illustration](/media/extensions/khr-materials-unlit.png)\n *\n * > _**Figure:** Unlit materials are useful for flat shading, stylized effects, and for improving\n * > performance on mobile devices. Source: [Model by Hayden VanEarden](https://sketchfab.com/3d-models/summertime-kirby-c5711316103a4d67a62c34cfe8710938)._\n *\n * Unlit (also \"Shadeless\" or \"Constant\") materials provide a simple alternative to the Physically\n * Based Rendering (PBR) shading models provided by the core specification. Unlit materials are\n * often useful for cheaper rendering on performance-contrained devices, e.g. mobile phones.\n * Additionally, unlit materials can be very useful in achieving stylized, non-photo-realistic\n * effects like hand painted illustrative styles or baked toon shaders.\n *\n * Properties:\n * - {@link Unlit}\n *\n * ### Example\n *\n * The `KHRMaterialsUnlit` class provides a single {@link ExtensionProperty} type, `Unlit`, which may\n * be attached to any {@link Material} instance. For example:\n *\n * ```typescript\n * import { KHRMaterialsUnlit, Unlit } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const unlitExtension = document.createExtension(KHRMaterialsUnlit);\n *\n * // Create an Unlit property.\n * const unlit = unlitExtension.createUnlit();\n *\n * // Attach the property to a Material.\n * material.setExtension('KHR_materials_unlit', unlit);\n * ```\n */\nexport class KHRMaterialsUnlit extends Extension {\n\tpublic static readonly EXTENSION_NAME: typeof KHR_MATERIALS_UNLIT = KHR_MATERIALS_UNLIT;\n\tpublic readonly extensionName: typeof KHR_MATERIALS_UNLIT = KHR_MATERIALS_UNLIT;\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.MESH];\n\tpublic readonly prewriteTypes: PropertyType[] = [PropertyType.MESH];\n\n\t/** Creates a new Unlit property for use on a {@link Material}. */\n\tpublic createUnlit(): Unlit {\n\t\treturn new Unlit(this.document.getGraph());\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(_context: WriterContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tconst materialDefs = context.jsonDoc.json.materials || [];\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\n\t\t\tif (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_UNLIT]) {\n\t\t\t\tcontext.materials[materialIndex].setExtension(KHR_MATERIALS_UNLIT, this.createUnlit());\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic prewrite(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listMaterials()\n\t\t\t.forEach((material) => {\n\t\t\t\tif (material.getExtension<Unlit>(KHR_MATERIALS_UNLIT)) {\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\n\t\t\t\t\tmaterialDef.extensions[KHR_MATERIALS_UNLIT] = {};\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n", "import { ExtensionProperty, type IProperty, type Material, type Nullable, RefSet } from '@gltf-transform/core';\nimport { KHR_MATERIALS_VARIANTS } from '../constants.js';\nimport type { Variant } from './variant.js';\n\ninterface IMapping extends IProperty {\n\tmaterial: Material;\n\tvariants: RefSet<Variant>;\n}\n\n/**\n * Maps {@link Variant}s to {@link Material}s. See {@link KHRMaterialsVariants}.\n */\nexport class Mapping extends ExtensionProperty<IMapping> {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_VARIANTS = KHR_MATERIALS_VARIANTS;\n\tpublic declare extensionName: typeof KHR_MATERIALS_VARIANTS;\n\tpublic declare propertyType: 'Mapping';\n\tpublic declare parentTypes: ['MappingList'];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_VARIANTS;\n\t\tthis.propertyType = 'Mapping';\n\t\tthis.parentTypes = ['MappingList'];\n\t}\n\n\tprotected getDefaults(): Nullable<IMapping> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, { material: null, variants: new RefSet<Variant>() });\n\t}\n\n\t/** The {@link Material} designated for this {@link Primitive}, under the given variants. */\n\tpublic getMaterial(): Material | null {\n\t\treturn this.getRef('material');\n\t}\n\n\t/** The {@link Material} designated for this {@link Primitive}, under the given variants. */\n\tpublic setMaterial(material: Material | null): this {\n\t\treturn this.setRef('material', material);\n\t}\n\n\t/** Adds a {@link Variant} to this mapping. */\n\tpublic addVariant(variant: Variant): this {\n\t\treturn this.addRef('variants', variant);\n\t}\n\n\t/** Removes a {@link Variant} from this mapping. */\n\tpublic removeVariant(variant: Variant): this {\n\t\treturn this.removeRef('variants', variant);\n\t}\n\n\t/** Lists {@link Variant}s in this mapping. */\n\tpublic listVariants(): Variant[] {\n\t\treturn this.listRefs('variants');\n\t}\n}\n", "import { ExtensionProperty, type IProperty, type Nullable, PropertyType, RefSet } from '@gltf-transform/core';\nimport { KHR_MATERIALS_VARIANTS } from '../constants.js';\nimport type { Mapping } from './mapping.js';\n\ninterface IMappingList extends IProperty {\n\tmappings: RefSet<Mapping>;\n}\n\n/**\n * List of material variant {@link Mapping}s. See {@link KHRMaterialsVariants}.\n */\nexport class MappingList extends ExtensionProperty<IMappingList> {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_VARIANTS = KHR_MATERIALS_VARIANTS;\n\tpublic declare extensionName: typeof KHR_MATERIALS_VARIANTS;\n\tpublic declare propertyType: 'MappingList';\n\tpublic declare parentTypes: [PropertyType.PRIMITIVE];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_VARIANTS;\n\t\tthis.propertyType = 'MappingList';\n\t\tthis.parentTypes = [PropertyType.PRIMITIVE];\n\t}\n\n\tprotected getDefaults(): Nullable<IMappingList> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, { mappings: new RefSet<Mapping>() });\n\t}\n\n\t/** Adds a {@link Mapping} to this mapping. */\n\tpublic addMapping(mapping: Mapping): this {\n\t\treturn this.addRef('mappings', mapping);\n\t}\n\n\t/** Removes a {@link Mapping} from the list for this {@link Primitive}. */\n\tpublic removeMapping(mapping: Mapping): this {\n\t\treturn this.removeRef('mappings', mapping);\n\t}\n\n\t/** Lists {@link Mapping}s in this {@link Primitive}. */\n\tpublic listMappings(): Mapping[] {\n\t\treturn this.listRefs('mappings');\n\t}\n}\n", "import { ExtensionProperty } from '@gltf-transform/core';\nimport { KHR_MATERIALS_VARIANTS } from '../constants.js';\n\n/**\n * Defines a variant of a {@link Material}. See {@link KHRMaterialsVariants}.\n */\nexport class Variant extends ExtensionProperty {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_VARIANTS = KHR_MATERIALS_VARIANTS;\n\tpublic declare extensionName: typeof KHR_MATERIALS_VARIANTS;\n\tpublic declare propertyType: 'Variant';\n\tpublic declare parentTypes: ['MappingList'];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_VARIANTS;\n\t\tthis.propertyType = 'Variant';\n\t\tthis.parentTypes = ['MappingList'];\n\t}\n}\n", "import { Extension, type ReaderContext, type WriterContext } from '@gltf-transform/core';\nimport { KHR_MATERIALS_VARIANTS } from '../constants.js';\nimport { Mapping } from './mapping.js';\nimport { MappingList } from './mapping-list.js';\nimport { Variant } from './variant.js';\n\ninterface VariantsRootDef {\n\tvariants: VariantDef[];\n}\n\ninterface VariantDef {\n\tname?: string;\n}\n\ninterface VariantPrimDef {\n\tmappings: VariantMappingDef[];\n}\n\ninterface VariantMappingDef {\n\tmaterial: number;\n\tvariants: number[];\n}\n\n/**\n * [`KHR_materials_variants`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_variants/)\n * defines alternate {@link Material} states for any {@link Primitive} in the scene.\n *\n * ![Illustration](/media/extensions/khr-materials-variants.jpg)\n *\n * > _**Figure:** A sneaker, in three material variants. Source: Khronos Group._\n *\n * Uses include product configurators, night/day states, healthy/damaged states, etc. The\n * `KHRMaterialsVariants` class provides three {@link ExtensionProperty} types: `Variant`, `Mapping`,\n * and `MappingList`. When attached to {@link Primitive} properties, these offer flexible ways of\n * defining the variants available to an application. Triggering a variant is out of scope of this\n * extension, but could be handled in the application with a UI dropdown, particular game states,\n * and so on.\n *\n * Mesh geometry cannot be changed by this extension, although another extension\n * (tentative: `KHR_mesh_variants`) is under consideration by the Khronos Group, for that purpose.\n *\n * Properties:\n * - {@link Variant}\n * - {@link Mapping}\n * - {@link MappingList}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMaterialsVariants } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const variantExtension = document.createExtension(KHRMaterialsVariants);\n *\n * // Create some Variant states.\n * const healthyVariant = variantExtension.createVariant('Healthy');\n * const damagedVariant = variantExtension.createVariant('Damaged');\n *\n * // Create mappings from a Variant state to a Material.\n * const healthyMapping = variantExtension.createMapping()\n * \t.addVariant(healthyVariant)\n * \t.setMaterial(healthyMat);\n * const damagedMapping = variantExtension.createMapping()\n * \t.addVariant(damagedVariant)\n * \t.setMaterial(damagedMat);\n *\n * // Attach the mappings to a Primitive.\n * primitive.setExtension(\n * \t'KHR_materials_variants',\n * \tvariantExtension.createMappingList()\n * \t\t.addMapping(healthyMapping)\n * \t\t.addMapping(damagedMapping)\n * );\n * ```\n *\n * A few notes about this extension:\n *\n * 1. Viewers that don't recognized this extension will show the default material for each primitive\n * \t instead, so assign that material accordingly. This material can be — but doesn't have to be —\n * \t associated with one of the available variants.\n * 2. Mappings can list multiple Variants. In that case, the first Mapping containing an active\n * \t Variant will be chosen by the viewer.\n * 3. Variant names are how these states are identified, so choose informative names.\n * 4. When writing the file to an unpacked `.gltf`, instead of an embedded `.glb`, viewers will have\n * \t the option of downloading only textures associated with the default state, and lazy-loading\n * \t any textures for inactive Variants only when they are needed.\n */\nexport class KHRMaterialsVariants extends Extension {\n\tpublic readonly extensionName: typeof KHR_MATERIALS_VARIANTS = KHR_MATERIALS_VARIANTS;\n\tpublic static readonly EXTENSION_NAME: typeof KHR_MATERIALS_VARIANTS = KHR_MATERIALS_VARIANTS;\n\n\t/** Creates a new MappingList property. */\n\tpublic createMappingList(): MappingList {\n\t\treturn new MappingList(this.document.getGraph());\n\t}\n\n\t/** Creates a new Variant property. */\n\tpublic createVariant(name = ''): Variant {\n\t\treturn new Variant(this.document.getGraph(), name);\n\t}\n\n\t/** Creates a new Mapping property. */\n\tpublic createMapping(): Mapping {\n\t\treturn new Mapping(this.document.getGraph());\n\t}\n\n\t/** Lists all Variants on the current Document. */\n\tpublic listVariants(): Variant[] {\n\t\treturn Array.from(this.properties).filter((prop) => prop instanceof Variant) as Variant[];\n\t}\n\n\t/** @hidden */\n\tpublic read(context: ReaderContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tif (!jsonDoc.json.extensions || !jsonDoc.json.extensions[KHR_MATERIALS_VARIANTS]) return this;\n\n\t\t// Read all top-level variant names.\n\t\tconst variantsRootDef = jsonDoc.json.extensions[KHR_MATERIALS_VARIANTS] as VariantsRootDef;\n\t\tconst variantDefs = variantsRootDef.variants || [];\n\t\tconst variants = variantDefs.map((variantDef) => this.createVariant().setName(variantDef.name || ''));\n\n\t\t// For each mesh primitive, read its material/variant mappings.\n\t\tconst meshDefs = jsonDoc.json.meshes || [];\n\t\tmeshDefs.forEach((meshDef, meshIndex) => {\n\t\t\tconst mesh = context.meshes[meshIndex];\n\t\t\tconst primDefs = meshDef.primitives || [];\n\n\t\t\tprimDefs.forEach((primDef, primIndex) => {\n\t\t\t\tif (!primDef.extensions || !primDef.extensions[KHR_MATERIALS_VARIANTS]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst mappingList = this.createMappingList();\n\n\t\t\t\tconst variantPrimDef = primDef.extensions[KHR_MATERIALS_VARIANTS] as VariantPrimDef;\n\t\t\t\tfor (const mappingDef of variantPrimDef.mappings) {\n\t\t\t\t\tconst mapping = this.createMapping();\n\n\t\t\t\t\tif (mappingDef.material !== undefined) {\n\t\t\t\t\t\tmapping.setMaterial(context.materials[mappingDef.material]);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const variantIndex of mappingDef.variants || []) {\n\t\t\t\t\t\tmapping.addVariant(variants[variantIndex]);\n\t\t\t\t\t}\n\n\t\t\t\t\tmappingList.addMapping(mapping);\n\t\t\t\t}\n\n\t\t\t\tmesh.listPrimitives()[primIndex].setExtension(KHR_MATERIALS_VARIANTS, mappingList);\n\t\t\t});\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tconst variants = this.listVariants();\n\t\tif (!variants.length) return this;\n\n\t\t// Write all top-level variant names.\n\t\tconst variantDefs = [];\n\t\tconst variantIndexMap = new Map<Variant, number>();\n\t\tfor (const variant of variants) {\n\t\t\tvariantIndexMap.set(variant, variantDefs.length);\n\t\t\tvariantDefs.push(context.createPropertyDef(variant));\n\t\t}\n\n\t\t// For each mesh primitive, write its material/variant mappings.\n\t\tfor (const mesh of this.document.getRoot().listMeshes()) {\n\t\t\tconst meshIndex = context.meshIndexMap.get(mesh)!;\n\n\t\t\tmesh.listPrimitives().forEach((prim, primIndex) => {\n\t\t\t\tconst mappingList = prim.getExtension<MappingList>(KHR_MATERIALS_VARIANTS);\n\t\t\t\tif (!mappingList) return;\n\n\t\t\t\tconst primDef = context.jsonDoc.json.meshes![meshIndex].primitives[primIndex];\n\n\t\t\t\tconst mappingDefs = mappingList.listMappings().map((mapping) => {\n\t\t\t\t\tconst mappingDef = context.createPropertyDef(mapping) as VariantMappingDef;\n\n\t\t\t\t\tconst material = mapping.getMaterial();\n\t\t\t\t\tif (material) {\n\t\t\t\t\t\tmappingDef.material = context.materialIndexMap.get(material)!;\n\t\t\t\t\t}\n\n\t\t\t\t\tmappingDef.variants = mapping.listVariants().map((variant) => variantIndexMap.get(variant)!);\n\n\t\t\t\t\treturn mappingDef;\n\t\t\t\t});\n\n\t\t\t\tprimDef.extensions = primDef.extensions || {};\n\t\t\t\tprimDef.extensions[KHR_MATERIALS_VARIANTS] = { mappings: mappingDefs };\n\t\t\t});\n\t\t}\n\n\t\tjsonDoc.json.extensions = jsonDoc.json.extensions || {};\n\t\tjsonDoc.json.extensions[KHR_MATERIALS_VARIANTS] = { variants: variantDefs };\n\n\t\treturn this;\n\t}\n}\n", "import {\n\tExtensionProperty,\n\ttype IProperty,\n\ttype Nullable,\n\tPropertyType,\n\ttype Texture,\n\tTextureChannel,\n\tTextureInfo,\n\ttype vec3,\n} from '@gltf-transform/core';\nimport { KHR_MATERIALS_VOLUME } from '../constants.js';\n\ninterface IVolume extends IProperty {\n\tthicknessFactor: number;\n\tthicknessTexture: Texture;\n\tthicknessTextureInfo: TextureInfo;\n\tattenuationDistance: number;\n\tattenuationColor: vec3;\n}\n\nconst { G } = TextureChannel;\n\n/**\n * Defines volume on a PBR {@link Material}. See {@link KHRMaterialsVolume}.\n */\nexport class Volume extends ExtensionProperty<IVolume> {\n\tpublic static EXTENSION_NAME: typeof KHR_MATERIALS_VOLUME = KHR_MATERIALS_VOLUME;\n\tpublic declare extensionName: typeof KHR_MATERIALS_VOLUME;\n\tpublic declare propertyType: 'Volume';\n\tpublic declare parentTypes: [PropertyType.MATERIAL];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_MATERIALS_VOLUME;\n\t\tthis.propertyType = 'Volume';\n\t\tthis.parentTypes = [PropertyType.MATERIAL];\n\t}\n\n\tprotected getDefaults(): Nullable<IVolume> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\n\t\t\tthicknessFactor: 0.0,\n\t\t\tthicknessTexture: null,\n\t\t\tthicknessTextureInfo: new TextureInfo(this.graph, 'thicknessTexture'),\n\t\t\tattenuationDistance: Infinity,\n\t\t\tattenuationColor: [1.0, 1.0, 1.0] as vec3,\n\t\t});\n\t}\n\n\t/**********************************************************************************************\n\t * Thickness.\n\t */\n\n\t/**\n\t * Thickness of the volume beneath the surface in meters in the local coordinate system of the\n\t * node. If the value is 0 the material is thin-walled. Otherwise the material is a volume\n\t * boundary. The doubleSided property has no effect on volume boundaries.\n\t */\n\tpublic getThicknessFactor(): number {\n\t\treturn this.get('thicknessFactor');\n\t}\n\n\t/**\n\t * Thickness of the volume beneath the surface in meters in the local coordinate system of the\n\t * node. If the value is 0 the material is thin-walled. Otherwise the material is a volume\n\t * boundary. The doubleSided property has no effect on volume boundaries.\n\t */\n\tpublic setThicknessFactor(factor: number): this {\n\t\treturn this.set('thicknessFactor', factor);\n\t}\n\n\t/**\n\t * Texture that defines the thickness, stored in the G channel. This will be multiplied by\n\t * thicknessFactor.\n\t */\n\tpublic getThicknessTexture(): Texture | null {\n\t\treturn this.getRef('thicknessTexture');\n\t}\n\n\t/**\n\t * Settings affecting the material's use of its thickness texture. If no texture is attached,\n\t * {@link TextureInfo} is `null`.\n\t */\n\tpublic getThicknessTextureInfo(): TextureInfo | null {\n\t\treturn this.getRef('thicknessTexture') ? this.getRef('thicknessTextureInfo') : null;\n\t}\n\n\t/**\n\t * Texture that defines the thickness, stored in the G channel. This will be multiplied by\n\t * thicknessFactor.\n\t */\n\tpublic setThicknessTexture(texture: Texture | null): this {\n\t\treturn this.setRef('thicknessTexture', texture, { channels: G });\n\t}\n\n\t/**********************************************************************************************\n\t * Attenuation.\n\t */\n\n\t/**\n\t * Density of the medium given as the average distance in meters that light travels in the\n\t * medium before interacting with a particle.\n\t */\n\tpublic getAttenuationDistance(): number {\n\t\treturn this.get('attenuationDistance');\n\t}\n\n\t/**\n\t * Density of the medium given as the average distance in meters that light travels in the\n\t * medium before interacting with a particle.\n\t */\n\tpublic setAttenuationDistance(distance: number): this {\n\t\treturn this.set('attenuationDistance', distance);\n\t}\n\n\t/**\n\t * Color (linear) that white light turns into due to absorption when reaching the attenuation\n\t * distance.\n\t */\n\tpublic getAttenuationColor(): vec3 {\n\t\treturn this.get('attenuationColor');\n\t}\n\n\t/**\n\t * Color (linear) that white light turns into due to absorption when reaching the attenuation\n\t * distance.\n\t */\n\tpublic setAttenuationColor(color: vec3): this {\n\t\treturn this.set('attenuationColor', color);\n\t}\n}\n", "import {\n\tExtension,\n\ttype GLTF,\n\tMathUtils,\n\tPropertyType,\n\ttype ReaderContext,\n\ttype vec3,\n\ttype WriterContext,\n} from '@gltf-transform/core';\nimport { KHR_MATERIALS_VOLUME } from '../constants.js';\nimport { Volume } from './volume.js';\n\ninterface VolumeDef {\n\tthicknessFactor?: number;\n\tthicknessTexture?: GLTF.ITextureInfo;\n\tattenuationDistance?: number;\n\tattenuationColor?: vec3;\n}\n\n/**\n * [KHR_materials_volume](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_materials_volume/)\n * adds refraction, absorption, or scattering to a glTF PBR material already using transmission or\n * translucency.\n *\n * ![Illustration](/media/extensions/khr-materials-volume.png)\n *\n * > _**Figure:** Base color changes the amount of light passing through the volume boundary\n * > (left). The overall color of the object is the same everywhere, as if the object is covered\n * > with a colored, transparent foil. Absorption changes the amount of light traveling through the\n * > volume (right). The overall color depends on the distance the light traveled through it; at\n * > small distances (tail of the dragon) less light is absorbed and the color is brighter than at\n * > large distances. Source: Khronos Group._\n *\n * By default, a glTF 2.0 material describes the scattering properties of a surface enclosing an\n * infinitely thin volume. The surface defined by the mesh represents a thin wall. The volume\n * extension makes it possible to turn the surface into an interface between volumes. The mesh to\n * which the material is attached defines the boundaries of an homogeneous medium and therefore must\n * be manifold. Volumes provide effects like refraction, absorption and scattering. Scattering\n * effects will require future (TBD) extensions.\n *\n * The volume extension must be combined with {@link KHRMaterialsTransmission} or\n * `KHR_materials_translucency` in order to define entry of light into the volume.\n *\n * Properties:\n * - {@link Volume}\n *\n * ### Example\n *\n * The `KHRMaterialsVolume` class provides a single {@link ExtensionProperty} type, `Volume`, which\n * may be attached to any {@link Material} instance. For example:\n *\n * ```typescript\n * import { KHRMaterialsVolume, Volume } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const volumeExtension = document.createExtension(KHRMaterialsVolume);\n *\n * // Create a Volume property.\n * const volume = volumeExtension.createVolume()\n * \t.setThicknessFactor(1.0)\n * \t.setThicknessTexture(texture)\n * \t.setAttenuationDistance(1.0)\n * \t.setAttenuationColorFactor([1, 0.5, 0.5]);\n *\n * // Attach the property to a Material.\n * material.setExtension('KHR_materials_volume', volume);\n * ```\n *\n * A thickness texture is required in most realtime renderers, and can be baked in software such as\n * Blender or Substance Painter. When `thicknessFactor = 0`, all volumetric effects are disabled.\n */\nexport class KHRMaterialsVolume extends Extension {\n\tpublic static readonly EXTENSION_NAME: typeof KHR_MATERIALS_VOLUME = KHR_MATERIALS_VOLUME;\n\tpublic readonly extensionName: typeof KHR_MATERIALS_VOLUME = KHR_MATERIALS_VOLUME;\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.MESH];\n\tpublic readonly prewriteTypes: PropertyType[] = [PropertyType.MESH];\n\n\t/** Creates a new Volume property for use on a {@link Material}. */\n\tpublic createVolume(): Volume {\n\t\treturn new Volume(this.document.getGraph());\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(_context: WriterContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\t\tconst materialDefs = jsonDoc.json.materials || [];\n\t\tconst textureDefs = jsonDoc.json.textures || [];\n\t\tmaterialDefs.forEach((materialDef, materialIndex) => {\n\t\t\tif (materialDef.extensions && materialDef.extensions[KHR_MATERIALS_VOLUME]) {\n\t\t\t\tconst volume = this.createVolume();\n\t\t\t\tcontext.materials[materialIndex].setExtension(KHR_MATERIALS_VOLUME, volume);\n\n\t\t\t\tconst volumeDef = materialDef.extensions[KHR_MATERIALS_VOLUME] as VolumeDef;\n\n\t\t\t\t// Factors.\n\n\t\t\t\tif (volumeDef.thicknessFactor !== undefined) {\n\t\t\t\t\tvolume.setThicknessFactor(volumeDef.thicknessFactor);\n\t\t\t\t}\n\t\t\t\tif (volumeDef.attenuationDistance !== undefined) {\n\t\t\t\t\tvolume.setAttenuationDistance(volumeDef.attenuationDistance);\n\t\t\t\t}\n\t\t\t\tif (volumeDef.attenuationColor !== undefined) {\n\t\t\t\t\tvolume.setAttenuationColor(volumeDef.attenuationColor);\n\t\t\t\t}\n\n\t\t\t\t// Textures.\n\n\t\t\t\tif (volumeDef.thicknessTexture !== undefined) {\n\t\t\t\t\tconst textureInfoDef = volumeDef.thicknessTexture;\n\t\t\t\t\tconst texture = context.textures[textureDefs[textureInfoDef.index].source!];\n\t\t\t\t\tvolume.setThicknessTexture(texture);\n\t\t\t\t\tcontext.setTextureInfo(volume.getThicknessTextureInfo()!, textureInfoDef);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic prewrite(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listMaterials()\n\t\t\t.forEach((material) => {\n\t\t\t\tconst volume = material.getExtension<Volume>(KHR_MATERIALS_VOLUME);\n\t\t\t\tif (volume) {\n\t\t\t\t\tconst materialIndex = context.materialIndexMap.get(material)!;\n\t\t\t\t\tconst materialDef = jsonDoc.json.materials![materialIndex];\n\t\t\t\t\tmaterialDef.extensions = materialDef.extensions || {};\n\n\t\t\t\t\t// Factors.\n\n\t\t\t\t\tconst volumeDef = (materialDef.extensions[KHR_MATERIALS_VOLUME] = {} as VolumeDef);\n\n\t\t\t\t\tif (volume.getThicknessFactor() > 0) {\n\t\t\t\t\t\tvolumeDef.thicknessFactor = volume.getThicknessFactor();\n\t\t\t\t\t}\n\t\t\t\t\tif (Number.isFinite(volume.getAttenuationDistance())) {\n\t\t\t\t\t\tvolumeDef.attenuationDistance = volume.getAttenuationDistance();\n\t\t\t\t\t}\n\t\t\t\t\tif (!MathUtils.eq(volume.getAttenuationColor(), [1, 1, 1])) {\n\t\t\t\t\t\tvolumeDef.attenuationColor = volume.getAttenuationColor();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Textures.\n\n\t\t\t\t\tif (volume.getThicknessTexture()) {\n\t\t\t\t\t\tconst texture = volume.getThicknessTexture()!;\n\t\t\t\t\t\tconst textureInfo = volume.getThicknessTextureInfo()!;\n\t\t\t\t\t\tvolumeDef.thicknessTexture = context.createTextureInfoDef(texture, textureInfo);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n", "import { Extension, type ReaderContext, type WriterContext } from '@gltf-transform/core';\nimport { KHR_MESH_QUANTIZATION } from '../constants.js';\n\n/**\n * [`KHR_mesh_quantization`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_mesh_quantization/)\n * expands allowed component types for vertex attributes to include 16- and 8-bit storage.\n *\n * Quantization provides a memory/precision tradeoff — depending on the application needs, 16-bit or\n * 8-bit storage can be sufficient for mesh geometry, at 1/2 or 1/4 the size. For example, a 10x10\n * mesh might be written to a uint16 {@link Accessor}, with values `0–65536`, normalized to be\n * interpreted as `0–1`. With an additional 10x scale on any node {@link Node} instantiating the\n * quantized {@link Mesh}, the model retains its original scale with a minimal quality loss and\n * up to 50% file size reduction.\n *\n * Defining no {@link ExtensionProperty} types, this {@link Extension} is simply attached to the\n * {@link Document}, and affects the entire Document by allowing more flexible use of\n * {@link Accessor} types for vertex attributes. Without the Extension, the same use of these data\n * types would yield an invalid glTF document, under the stricter core glTF specification.\n *\n * Properties:\n * - N/A\n *\n * ### Example\n *\n * ```typescript\n * import { KHRMeshQuantization } from '@gltf-transform/extensions';\n * import { quantize } from '@gltf-transform/functions';\n *\n * // Create an Extension attached to the Document.\n * const quantizationExtension = document.createExtension(KHRMeshQuantization).setRequired(true);\n *\n * // Use Uint16Array, Uint8Array, Int16Array, and Int8Array in vertex accessors manually,\n * // or apply the provided quantize() function to compute quantized accessors automatically:\n * await document.transform(quantize({\n * \tquantizePosition: 16,\n * \tquantizeNormal: 12,\n * \tquantizeTexcoord: 14\n * }));\n * ```\n *\n * For more documentation about automatic quantization, see the {@link quantize} function.\n */\nexport class KHRMeshQuantization extends Extension {\n\tpublic readonly extensionName: typeof KHR_MESH_QUANTIZATION = KHR_MESH_QUANTIZATION;\n\tpublic static readonly EXTENSION_NAME: typeof KHR_MESH_QUANTIZATION = KHR_MESH_QUANTIZATION;\n\n\t/** @hidden */\n\tread(_: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\twrite(_: WriterContext): this {\n\t\treturn this;\n\t}\n}\n", "import {\n\tExtension,\n\tImageUtils,\n\ttype ImageUtilsFormat,\n\tPropertyType,\n\ttype ReaderContext,\n\ttype vec2,\n\ttype WriterContext,\n} from '@gltf-transform/core';\nimport { KHR_DF_MODEL_ETC1S, KHR_DF_MODEL_UASTC, read as readKTX } from 'ktx-parse';\nimport { KHR_TEXTURE_BASISU } from '../constants.js';\n\ninterface BasisuDef {\n\tsource: number;\n}\n\nclass KTX2ImageUtils implements ImageUtilsFormat {\n\tmatch(array: Uint8Array): boolean {\n\t\treturn (\n\t\t\tarray[0] === 0xab &&\n\t\t\tarray[1] === 0x4b &&\n\t\t\tarray[2] === 0x54 &&\n\t\t\tarray[3] === 0x58 &&\n\t\t\tarray[4] === 0x20 &&\n\t\t\tarray[5] === 0x32 &&\n\t\t\tarray[6] === 0x30 &&\n\t\t\tarray[7] === 0xbb &&\n\t\t\tarray[8] === 0x0d &&\n\t\t\tarray[9] === 0x0a &&\n\t\t\tarray[10] === 0x1a &&\n\t\t\tarray[11] === 0x0a\n\t\t);\n\t}\n\tgetSize(array: Uint8Array): vec2 {\n\t\tconst container = readKTX(array);\n\t\treturn [container.pixelWidth, container.pixelHeight];\n\t}\n\tgetChannels(array: Uint8Array): number {\n\t\tconst container = readKTX(array);\n\t\tconst dfd = container.dataFormatDescriptor[0];\n\t\tif (dfd.colorModel === KHR_DF_MODEL_ETC1S) {\n\t\t\treturn dfd.samples.length === 2 && (dfd.samples[1].channelType & 0xf) === 15 ? 4 : 3;\n\t\t} else if (dfd.colorModel === KHR_DF_MODEL_UASTC) {\n\t\t\treturn (dfd.samples[0].channelType & 0xf) === 3 ? 4 : 3;\n\t\t}\n\t\tthrow new Error(`Unexpected KTX2 colorModel, \"${dfd.colorModel}\".`);\n\t}\n\tgetVRAMByteLength(array: Uint8Array): number {\n\t\tconst container = readKTX(array);\n\t\tconst hasAlpha = this.getChannels(array) > 3;\n\n\t\tlet uncompressedBytes = 0;\n\t\tfor (let i = 0; i < container.levels.length; i++) {\n\t\t\tconst level = container.levels[i];\n\n\t\t\t// Use level.uncompressedByteLength for UASTC; for ETC1S it's 0.\n\t\t\tif (level.uncompressedByteLength) {\n\t\t\t\tuncompressedBytes += level.uncompressedByteLength;\n\t\t\t} else {\n\t\t\t\tconst levelWidth = Math.max(1, Math.floor(container.pixelWidth / Math.pow(2, i)));\n\t\t\t\tconst levelHeight = Math.max(1, Math.floor(container.pixelHeight / Math.pow(2, i)));\n\t\t\t\tconst blockSize = hasAlpha ? 16 : 8;\n\t\t\t\tuncompressedBytes += (levelWidth / 4) * (levelHeight / 4) * blockSize;\n\t\t\t}\n\t\t}\n\n\t\treturn uncompressedBytes;\n\t}\n}\n\n/**\n * [`KHR_texture_basisu`](https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu)\n * enables KTX2 GPU textures with Basis Universal supercompression for any material texture.\n *\n * GPU texture formats, unlike traditional image formats, remain compressed in GPU memory. As a\n * result, they (1) upload to the GPU much more quickly, and (2) require much less GPU memory. In\n * certain cases they may also have smaller filesizes than PNG or JPEG textures, but this is not\n * guaranteed. GPU textures often require more careful tuning during compression to maintain image\n * quality, but this extra effort is worthwhile for applications that need to maintain a smooth\n * framerate while uploading images, or where GPU memory is limited.\n *\n * Defining no {@link ExtensionProperty} types, this {@link Extension} is simply attached to the\n * {@link Document}, and affects the entire Document by allowing use of the `image/ktx2` MIME type\n * and passing KTX2 image data to the {@link Texture.setImage} method. Without the Extension, the\n * same MIME types and image data would yield an invalid glTF document, under the stricter core glTF\n * specification.\n *\n * Properties:\n * - N/A\n *\n * ### Example\n *\n * ```typescript\n * import { KHRTextureBasisu } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const basisuExtension = document.createExtension(KHRTextureBasisu)\n * \t.setRequired(true);\n * document.createTexture('MyCompressedTexture')\n * \t.setMimeType('image/ktx2')\n * \t.setImage(fs.readFileSync('my-texture.ktx2'));\n * ```\n *\n * Compression is not done automatically when adding the extension as shown above — you must\n * compress the image data first, then pass the `.ktx2` payload to {@link Texture.setImage}. The\n * glTF Transform CLI has functions to help with this, or any similar KTX2-capable\n * utility will work.\n *\n * When the `KHR_texture_basisu` extension is added to a file by glTF Transform, the extension\n * should always be required. This tool does not support writing assets that \"fall back\" to optional\n * PNG or JPEG image data.\n *\n * > _**NOTICE:** Compressing some textures — particularly 3-component (RGB) normal maps, and\n * > occlusion/roughness/metalness maps, may give poor results with the ETC1S compression option.\n * > These issues can often be avoided with the larger UASTC compression option, or by upscaling the\n * > texture before compressing it.\n * >\n * > For best results when authoring new textures, use\n * > [texture dilation](https://docs.substance3d.com/spdoc/padding-134643719.html) and minimize\n * > prominent UV seams._\n */\nexport class KHRTextureBasisu extends Extension {\n\tpublic static readonly EXTENSION_NAME: typeof KHR_TEXTURE_BASISU = KHR_TEXTURE_BASISU;\n\tpublic readonly extensionName: typeof KHR_TEXTURE_BASISU = KHR_TEXTURE_BASISU;\n\t/** @hidden */\n\tpublic readonly prereadTypes: PropertyType[] = [PropertyType.TEXTURE];\n\n\t/** @hidden */\n\tpublic static register(): void {\n\t\tImageUtils.registerFormat('image/ktx2', new KTX2ImageUtils());\n\t}\n\n\t/** @hidden */\n\tpublic preread(context: ReaderContext): this {\n\t\tcontext.jsonDoc.json.textures!.forEach((textureDef) => {\n\t\t\tif (textureDef.extensions && textureDef.extensions[KHR_TEXTURE_BASISU]) {\n\t\t\t\tconst basisuDef = textureDef.extensions[KHR_TEXTURE_BASISU] as BasisuDef;\n\t\t\t\ttextureDef.source = basisuDef.source;\n\t\t\t}\n\t\t});\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic read(_context: ReaderContext): this {\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(context: WriterContext): this {\n\t\tconst jsonDoc = context.jsonDoc;\n\n\t\tthis.document\n\t\t\t.getRoot()\n\t\t\t.listTextures()\n\t\t\t.forEach((texture) => {\n\t\t\t\tif (texture.getMimeType() === 'image/ktx2') {\n\t\t\t\t\tconst imageIndex = context.imageIndexMap.get(texture);\n\t\t\t\t\tjsonDoc.json.textures!.forEach((textureDef) => {\n\t\t\t\t\t\tif (textureDef.source === imageIndex) {\n\t\t\t\t\t\t\ttextureDef.extensions = textureDef.extensions || {};\n\t\t\t\t\t\t\ttextureDef.extensions[KHR_TEXTURE_BASISU] = { source: textureDef.source };\n\t\t\t\t\t\t\tdelete textureDef.source;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn this;\n\t}\n}\n", "import { ExtensionProperty, type IProperty, type Nullable, PropertyType, type vec2 } from '@gltf-transform/core';\nimport { KHR_TEXTURE_TRANSFORM } from '../constants.js';\n\ninterface ITransform extends IProperty {\n\toffset: vec2;\n\trotation: number;\n\tscale: vec2;\n\ttexCoord: number | null; // null → do not override TextureInfo.\n}\n\n/**\n * Defines UV transform for a {@link TextureInfo}. See {@link KHRTextureTransform}.\n */\nexport class Transform extends ExtensionProperty<ITransform> {\n\tpublic static EXTENSION_NAME: typeof KHR_TEXTURE_TRANSFORM = KHR_TEXTURE_TRANSFORM;\n\tpublic declare extensionName: typeof KHR_TEXTURE_TRANSFORM;\n\tpublic declare propertyType: 'Transform';\n\tpublic declare parentTypes: [PropertyType.TEXTURE_INFO];\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_TEXTURE_TRANSFORM;\n\t\tthis.propertyType = 'Transform';\n\t\tthis.parentTypes = [PropertyType.TEXTURE_INFO];\n\t}\n\n\tprotected getDefaults(): Nullable<ITransform> {\n\t\treturn Object.assign(super.getDefaults() as IProperty, {\n\t\t\toffset: [0.0, 0.0] as vec2,\n\t\t\trotation: 0,\n\t\t\tscale: [1.0, 1.0] as vec2,\n\t\t\ttexCoord: null,\n\t\t});\n\t}\n\n\tpublic getOffset(): vec2 {\n\t\treturn this.get('offset');\n\t}\n\tpublic setOffset(offset: vec2): this {\n\t\treturn this.set('offset', offset);\n\t}\n\n\tpublic getRotation(): number {\n\t\treturn this.get('rotation');\n\t}\n\tpublic setRotation(rotation: number): this {\n\t\treturn this.set('rotation', rotation);\n\t}\n\n\tpublic getScale(): vec2 {\n\t\treturn this.get('scale');\n\t}\n\tpublic setScale(scale: vec2): this {\n\t\treturn this.set('scale', scale);\n\t}\n\n\tpublic getTexCoord(): number | null {\n\t\treturn this.get('texCoord');\n\t}\n\tpublic setTexCoord(texCoord: number | null): this {\n\t\treturn this.set('texCoord', texCoord);\n\t}\n}\n", "import { Extension, MathUtils, type ReaderContext, type vec2, type WriterContext } from '@gltf-transform/core';\nimport { KHR_TEXTURE_TRANSFORM } from '../constants.js';\nimport { Transform } from './transform.js';\n\ninterface TransformDef {\n\toffset?: vec2;\n\trotation?: number;\n\tscale?: vec2;\n\ttexCoord?: number;\n}\n\n/**\n * [`KHR_texture_transform`](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_texture_transform/)\n * adds offset, rotation, and scale to {@link TextureInfo} properties.\n *\n * Affine UV transforms are useful for reducing the number of textures the GPU must load, improving\n * performance when used in techniques like texture atlases. UV transforms cannot be animated at\n * this time.\n *\n * Properties:\n * - {@link Transform}\n *\n * ### Example\n *\n * The `KHRTextureTransform` class provides a single {@link ExtensionProperty} type, `Transform`, which\n * may be attached to any {@link TextureInfo} instance. For example:\n *\n * ```typescript\n * import { KHRTextureTransform } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const transformExtension = document.createExtension(KHRTextureTransform)\n * \t.setRequired(true);\n *\n * // Create a reusable Transform.\n * const transform = transformExtension.createTransform()\n * \t.setScale([100, 100]);\n *\n * // Apply the Transform to a Material's baseColorTexture.\n * document.createMaterial()\n * \t.setBaseColorTexture(myTexture)\n * \t.getBaseColorTextureInfo()\n * \t.setExtension('KHR_texture_transform', transform);\n * ```\n */\nexport class KHRTextureTransform extends Extension {\n\tpublic readonly extensionName: typeof KHR_TEXTURE_TRANSFORM = KHR_TEXTURE_TRANSFORM;\n\tpublic static readonly EXTENSION_NAME: typeof KHR_TEXTURE_TRANSFORM = KHR_TEXTURE_TRANSFORM;\n\n\t/** Creates a new Transform property for use on a {@link TextureInfo}. */\n\tpublic createTransform(): Transform {\n\t\treturn new Transform(this.document.getGraph());\n\t}\n\n\t/** @hidden */\n\tpublic read(context: ReaderContext): this {\n\t\tfor (const [textureInfo, textureInfoDef] of Array.from(context.textureInfos.entries())) {\n\t\t\tif (!textureInfoDef.extensions || !textureInfoDef.extensions[KHR_TEXTURE_TRANSFORM]) continue;\n\n\t\t\tconst transform = this.createTransform();\n\t\t\tconst transformDef = textureInfoDef.extensions[KHR_TEXTURE_TRANSFORM] as TransformDef;\n\n\t\t\tif (transformDef.offset !== undefined) transform.setOffset(transformDef.offset);\n\t\t\tif (transformDef.rotation !== undefined) transform.setRotation(transformDef.rotation);\n\t\t\tif (transformDef.scale !== undefined) transform.setScale(transformDef.scale);\n\t\t\tif (transformDef.texCoord !== undefined) transform.setTexCoord(transformDef.texCoord);\n\n\t\t\ttextureInfo.setExtension(KHR_TEXTURE_TRANSFORM, transform);\n\t\t}\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(context: WriterContext): this {\n\t\tconst textureInfoEntries = Array.from(context.textureInfoDefMap.entries());\n\t\tfor (const [textureInfo, textureInfoDef] of textureInfoEntries) {\n\t\t\tconst transform = textureInfo.getExtension<Transform>(KHR_TEXTURE_TRANSFORM);\n\t\t\tif (!transform) continue;\n\n\t\t\ttextureInfoDef.extensions = textureInfoDef.extensions || {};\n\t\t\tconst transformDef = {} as TransformDef;\n\n\t\t\tconst eq = MathUtils.eq;\n\t\t\tif (!eq(transform.getOffset(), [0, 0])) transformDef.offset = transform.getOffset();\n\t\t\tif (transform.getRotation() !== 0) transformDef.rotation = transform.getRotation();\n\t\t\tif (!eq(transform.getScale(), [1, 1])) transformDef.scale = transform.getScale();\n\t\t\tif (transform.getTexCoord() != null) transformDef.texCoord = transform.getTexCoord()!;\n\n\t\t\ttextureInfoDef.extensions[KHR_TEXTURE_TRANSFORM] = transformDef;\n\t\t}\n\t\treturn this;\n\t}\n}\n", "import { ExtensionProperty, type IProperty, type Nullable, PropertyType } from '@gltf-transform/core';\nimport { KHR_XMP_JSON_LD } from '../constants.js';\n\ntype Term = string;\ntype TermDefinition = string | Record<string, string>;\n\ntype Value = string | number | boolean;\n\nconst PARENT_TYPES: PropertyType[] = [\n\tPropertyType.ROOT,\n\tPropertyType.SCENE,\n\tPropertyType.NODE,\n\tPropertyType.MESH,\n\tPropertyType.MATERIAL,\n\tPropertyType.TEXTURE,\n\tPropertyType.ANIMATION,\n];\n\ninterface IPacket extends IProperty {\n\t// https://json-ld.org/spec/latest/json-ld/#the-context\n\tcontext: Record<Term, TermDefinition>;\n\tproperties: Record<string, Value | Record<string, unknown>>;\n}\n\n/**\n * Defines an XMP packet associated with a Document or Property. See {@link KHRXMP}.\n */\nexport class Packet extends ExtensionProperty<IPacket> {\n\tpublic declare propertyType: 'Packet';\n\tpublic declare parentTypes: typeof PARENT_TYPES;\n\tpublic declare extensionName: typeof KHR_XMP_JSON_LD;\n\tpublic static EXTENSION_NAME: typeof KHR_XMP_JSON_LD = KHR_XMP_JSON_LD;\n\n\tprotected init(): void {\n\t\tthis.extensionName = KHR_XMP_JSON_LD;\n\t\tthis.propertyType = 'Packet';\n\t\tthis.parentTypes = PARENT_TYPES;\n\t}\n\n\tprotected getDefaults(): Nullable<IPacket> {\n\t\treturn Object.assign(super.getDefaults(), { context: {}, properties: {} });\n\t}\n\n\t/**********************************************************************************************\n\t * Context.\n\t */\n\n\t/**\n\t * Returns the XMP context definition URL for the given term.\n\t * See: https://json-ld.org/spec/latest/json-ld/#the-context\n\t * @param term Case-sensitive term. Usually a concise, lowercase, alphanumeric identifier.\n\t */\n\tpublic getContext(): Record<Term, TermDefinition> {\n\t\treturn this.get('context');\n\t}\n\n\t/**\n\t * Sets the XMP context definition URL for the given term.\n\t * See: https://json-ld.org/spec/latest/json-ld/#the-context\n\t *\n\t * Example:\n\t *\n\t * ```typescript\n\t * packet.setContext({\n\t *   dc: 'http://purl.org/dc/elements/1.1/',\n\t *   model3d: 'https://schema.khronos.org/model3d/xsd/1.0/',\n\t * });\n\t * ```\n\t *\n\t * @param term Case-sensitive term. Usually a concise, lowercase, alphanumeric identifier.\n\t * @param definition URI for XMP namespace.\n\t */\n\tpublic setContext(context: Record<Term, TermDefinition>): this {\n\t\treturn this.set('context', { ...context });\n\t}\n\n\t/**********************************************************************************************\n\t * Properties.\n\t */\n\n\t/**\n\t * Lists properties defined in this packet.\n\t *\n\t * Example:\n\t *\n\t * ```typescript\n\t * packet.listProperties(); // → ['dc:Language', 'dc:Creator', 'xmp:CreateDate']\n\t * ```\n\t */\n\tpublic listProperties(): string[] {\n\t\treturn Object.keys(this.get('properties'));\n\t}\n\n\t/**\n\t * Returns the value of a property, as a literal or JSONLD object.\n\t *\n\t * Example:\n\t *\n\t * ```typescript\n\t * packet.getProperty('dc:Creator'); // → {\"@list\": [\"Acme, Inc.\"]}\n\t * packet.getProperty('dc:Title'); // → {\"@type\": \"rdf:Alt\", \"rdf:_1\": {\"@language\": \"en-US\", \"@value\": \"Lamp\"}}\n\t * packet.getProperty('xmp:CreateDate'); // → \"2022-01-01\"\n\t * ```\n\t */\n\tpublic getProperty(name: string): Value | Record<string, unknown> | null {\n\t\tconst properties = this.get('properties');\n\t\treturn name in properties ? properties[name] : null;\n\t}\n\n\t/**\n\t * Sets the value of a property, as a literal or JSONLD object.\n\t *\n\t * Example:\n\t *\n\t * ```typescript\n\t * packet.setProperty('dc:Creator', {'@list': ['Acme, Inc.']});\n\t * packet.setProperty('dc:Title', {\n\t * \t'@type': 'rdf:Alt',\n\t * \t'rdf:_1': {'@language': 'en-US', '@value': 'Lamp'}\n\t * });\n\t * packet.setProperty('model3d:preferredSurfaces', {'@list': ['vertical']});\n\t * ```\n\t */\n\tpublic setProperty(name: string, value: Value | Record<string, unknown>): this {\n\t\tthis._assertContext(name);\n\n\t\tconst properties = { ...this.get('properties') };\n\t\tif (value) {\n\t\t\tproperties[name] = value;\n\t\t} else {\n\t\t\tdelete properties[name];\n\t\t}\n\t\treturn this.set('properties', properties);\n\t}\n\n\t/**********************************************************************************************\n\t * Serialize / Deserialize.\n\t */\n\n\t/**\n\t * Serializes the packet context and properties to a JSONLD object.\n\t */\n\tpublic toJSONLD(): Record<string, unknown> {\n\t\tconst context = copyJSON(this.get('context'));\n\t\tconst properties = copyJSON(this.get('properties'));\n\t\treturn { '@context': context, ...properties };\n\t}\n\n\t/**\n\t * Deserializes a JSONLD packet, then overwrites existing context and properties with\n\t * the new values.\n\t */\n\tpublic fromJSONLD(jsonld: Record<string, unknown>): this {\n\t\tjsonld = copyJSON(jsonld);\n\n\t\t// Context.\n\t\tconst context = jsonld['@context'] as Record<Term, TermDefinition>;\n\t\tif (context) this.set('context', context);\n\t\tdelete jsonld['@context'];\n\n\t\t// Properties.\n\t\treturn this.set('properties', jsonld as Record<string, string | Record<string, unknown>>);\n\t}\n\n\t/**********************************************************************************************\n\t * Validation.\n\t */\n\n\t/** @hidden */\n\tprivate _assertContext(name: string) {\n\t\tconst prefix = name.split(':')[0];\n\t\tif (!(prefix in this.get('context'))) {\n\t\t\tthrow new Error(`${KHR_XMP_JSON_LD}: Missing context for term, \"${name}\".`);\n\t\t}\n\t}\n}\n\nfunction copyJSON<T>(object: T): T {\n\treturn JSON.parse(JSON.stringify(object));\n}\n", "import {\n\ttype Animation,\n\tExtension,\n\ttype GLTF,\n\ttype Material,\n\ttype Mesh,\n\ttype Node,\n\tPropertyType,\n\ttype ReaderContext,\n\ttype Scene,\n\ttype Texture,\n\ttype WriterContext,\n} from '@gltf-transform/core';\nimport { KHR_XMP_JSON_LD } from '../constants.js';\nimport { Packet } from './packet.js';\n\ntype XMPPacketDef = Record<string, unknown>;\n\ntype XMPParentDef =\n\t| GLTF.IAsset\n\t| GLTF.IScene\n\t| GLTF.INode\n\t| GLTF.IMesh\n\t| GLTF.IMaterial\n\t| GLTF.ITexture\n\t| GLTF.IAnimation;\n\ninterface XMPPropertyDef {\n\tpacket: number;\n}\n\ninterface XMPRootDef {\n\tpackets?: XMPPacketDef[];\n}\n\n/**\n * [KHR_xmp_json_ld](https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_xmp_json_ld/)\n * defines XMP metadata associated with a glTF asset.\n *\n * XMP metadata provides standardized fields describing the content, provenance, usage\n * restrictions, or other attributes of a 3D model. XMP metadata does not generally affect the\n * parsing or runtime behavior of the content — for that, use custom extensions, custom vertex\n * attributes, or extras. Similarly, storage mechanisms other than XMP should be preferred\n * for binary content like mesh data, animations, or textures.\n *\n * Generally XMP metadata is associated with the entire glTF asset by attaching an XMP {@link Packet}\n * to the document {@link Root}. In less common cases where metadata must be associated with\n * specific subsets of a document, XMP Packets may be attached to {@link Scene}, {@link Node},\n * {@link Mesh}, {@link Material}, {@link Texture}, or {@link Animation} properties.\n *\n * Within each packet, XMP properties become available when an\n * [XMP namespace](https://www.adobe.io/xmp/docs/XMPNamespaces/) is registered\n * with {@link Packet.setContext}. Packets cannot use properties whose namespaces are not\n * registered as context. While not all XMP namespaces are relevant to 3D assets, some common\n * namespaces provide useful metadata about authorship and provenance. Additionally, the `model3d`\n * namespace provides certain properties specific to 3D content, such as Augmented Reality (AR)\n * orientation data.\n *\n * Common XMP contexts for 3D models include:\n *\n * | Prefix      | URI                                         | Name                           |\n * |:------------|:--------------------------------------------|:-------------------------------|\n * | `dc`        | http://purl.org/dc/elements/1.1/            | Dublin Core                    |\n * | `model3d`   | https://schema.khronos.org/model3d/xsd/1.0/ | Model 3D                       |\n * | `rdf`       | http://www.w3.org/1999/02/22-rdf-syntax-ns# | Resource Description Framework |\n * | `xmp`       | http://ns.adobe.com/xap/1.0/                | XMP                            |\n * | `xmpRights` | http://ns.adobe.com/xap/1.0/rights/         | XMP Rights Management          |\n *\n * Only the XMP contexts required for a packet should be assigned, and different packets\n * in the same asset may use different contexts. For greater detail on available XMP\n * contexts and how to use them in glTF assets, see the\n * [3DC Metadata Recommendations](https://github.com/KhronosGroup/3DC-Metadata-Recommendations/blob/main/model3d.md).\n *\n * Properties:\n * - {@link Packet}\n *\n * ### Example\n *\n * ```typescript\n * import { KHRXMP, Packet } from '@gltf-transform/extensions';\n *\n * // Create an Extension attached to the Document.\n * const xmpExtension = document.createExtension(KHRXMP);\n *\n * // Create Packet property.\n * const packet = xmpExtension.createPacket()\n * \t.setContext({\n * \t\tdc: 'http://purl.org/dc/elements/1.1/',\n * \t})\n *\t.setProperty('dc:Creator', {\"@list\": [\"Acme, Inc.\"]});\n *\n * // Option 1: Assign to Document Root.\n * document.getRoot().setExtension('KHR_xmp_json_ld', packet);\n *\n * // Option 2: Assign to a specific Property.\n * texture.setExtension('KHR_xmp_json_ld', packet);\n * ```\n */\nexport class KHRXMP extends Extension {\n\tpublic readonly extensionName: typeof KHR_XMP_JSON_LD = KHR_XMP_JSON_LD;\n\tpublic static readonly EXTENSION_NAME: typeof KHR_XMP_JSON_LD = KHR_XMP_JSON_LD;\n\n\t/** Creates a new XMP packet, to be linked with a {@link Document} or {@link Property Properties}. */\n\tpublic createPacket(): Packet {\n\t\treturn new Packet(this.document.getGraph());\n\t}\n\n\t/** Lists XMP packets currently defined in a {@link Document}. */\n\tpublic listPackets(): Packet[] {\n\t\treturn Array.from(this.properties) as Packet[];\n\t}\n\n\t/** @hidden */\n\tpublic read(context: ReaderContext): this {\n\t\tconst extensionDef = context.jsonDoc.json.extensions?.[KHR_XMP_JSON_LD] as XMPRootDef | undefined;\n\t\tif (!extensionDef || !extensionDef.packets) return this;\n\n\t\t// Deserialize packets.\n\t\tconst json = context.jsonDoc.json;\n\t\tconst root = this.document.getRoot();\n\t\tconst packets = extensionDef.packets.map((packetDef) => this.createPacket().fromJSONLD(packetDef));\n\n\t\tconst defLists = [\n\t\t\t[json.asset],\n\t\t\tjson.scenes,\n\t\t\tjson.nodes,\n\t\t\tjson.meshes,\n\t\t\tjson.materials,\n\t\t\tjson.images,\n\t\t\tjson.animations,\n\t\t];\n\n\t\tconst propertyLists = [\n\t\t\t[root],\n\t\t\troot.listScenes(),\n\t\t\troot.listNodes(),\n\t\t\troot.listMeshes(),\n\t\t\troot.listMaterials(),\n\t\t\troot.listTextures(),\n\t\t\troot.listAnimations(),\n\t\t];\n\n\t\t// Assign packets.\n\t\tfor (let i = 0; i < defLists.length; i++) {\n\t\t\tconst defs = defLists[i] || [];\n\t\t\tfor (let j = 0; j < defs.length; j++) {\n\t\t\t\tconst def = defs[j];\n\t\t\t\tif (def.extensions && def.extensions[KHR_XMP_JSON_LD]) {\n\t\t\t\t\tconst xmpDef = def.extensions[KHR_XMP_JSON_LD] as XMPPropertyDef;\n\t\t\t\t\tpropertyLists[i][j].setExtension(KHR_XMP_JSON_LD, packets[xmpDef.packet]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/** @hidden */\n\tpublic write(context: WriterContext): this {\n\t\tconst { json } = context.jsonDoc;\n\n\t\tconst packetDefs = [];\n\n\t\tfor (const packet of this.properties as Set<Packet>) {\n\t\t\t// Serialize packets.\n\t\t\tpacketDefs.push(packet.toJSONLD());\n\n\t\t\t// Assign packets.\n\n\t\t\tfor (const parent of packet.listParents()) {\n\t\t\t\tlet parentDef: XMPParentDef | null;\n\n\t\t\t\tswitch (parent.propertyType) {\n\t\t\t\t\tcase PropertyType.ROOT:\n\t\t\t\t\t\tparentDef = json.asset;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PropertyType.SCENE:\n\t\t\t\t\t\tparentDef = json.scenes![context.sceneIndexMap.get(parent as Scene)!];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PropertyType.NODE:\n\t\t\t\t\t\tparentDef = json.nodes![context.nodeIndexMap.get(parent as Node)!];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PropertyType.MESH:\n\t\t\t\t\t\tparentDef = json.meshes![context.meshIndexMap.get(parent as Mesh)!];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PropertyType.MATERIAL:\n\t\t\t\t\t\tparentDef = json.materials![context.materialIndexMap.get(parent as Material)!];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PropertyType.TEXTURE:\n\t\t\t\t\t\tparentDef = json.images![context.imageIndexMap.get(parent as Texture)!];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PropertyType.ANIMATION:\n\t\t\t\t\t\tparentDef = json.animations![context.animationIndexMap.get(parent as Animation)!];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tparentDef = null;\n\t\t\t\t\t\tthis.document\n\t\t\t\t\t\t\t.getLogger()\n\t\t\t\t\t\t\t.warn(`[${KHR_XMP_JSON_LD}]: Unsupported parent property, \"${parent.propertyType}\"`);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!parentDef) continue;\n\n\t\t\t\tparentDef.extensions = parentDef.extensions || {};\n\t\t\t\tparentDef.extensions[KHR_XMP_JSON_LD] = { packet: packetDefs.length - 1 };\n\t\t\t}\n\t\t}\n\n\t\tif (packetDefs.length > 0) {\n\t\t\tjson.extensions = json.extensions || {};\n\t\t\tjson.extensions[KHR_XMP_JSON_LD] = { packets: packetDefs };\n\t\t}\n\n\t\treturn this;\n\t}\n}\n", "import type { Extension } from '@gltf-transform/core';\nimport { EXTMeshGPUInstancing } from './ext-mesh-gpu-instancing/index.js';\nimport { EXTMeshoptCompression } from './ext-meshopt-compression/index.js';\nimport { EXTTextureAVIF } from './ext-texture-avif/index.js';\nimport { EXTTextureWebP } from './ext-texture-webp/index.js';\nimport { KHRDracoMeshCompression } from './khr-draco-mesh-compression/index.js';\nimport { KHRLightsPunctual } from './khr-lights-punctual/index.js';\nimport { KHRMaterialsAnisotropy } from './khr-materials-anisotropy/index.js';\nimport { KHRMaterialsClearcoat } from './khr-materials-clearcoat/index.js';\nimport { KHRMaterialsDiffuseTransmission } from './khr-materials-diffuse-transmission/materials-diffuse-transmission.js';\nimport { KHRMaterialsDispersion } from './khr-materials-dispersion/index.js';\nimport { KHRMaterialsEmissiveStrength } from './khr-materials-emissive-strength/index.js';\nimport { KHRMaterialsIOR } from './khr-materials-ior/index.js';\nimport { KHRMaterialsIridescence } from './khr-materials-iridescence/index.js';\nimport { KHRMaterialsPBRSpecularGlossiness } from './khr-materials-pbr-specular-glossiness/index.js';\nimport { KHRMaterialsSheen } from './khr-materials-sheen/index.js';\nimport { KHRMaterialsSpecular } from './khr-materials-specular/index.js';\nimport { KHRMaterialsTransmission } from './khr-materials-transmission/index.js';\nimport { KHRMaterialsUnlit } from './khr-materials-unlit/index.js';\nimport { KHRMaterialsVariants } from './khr-materials-variants/index.js';\nimport { KHRMaterialsVolume } from './khr-materials-volume/index.js';\nimport { KHRMeshQuantization } from './khr-mesh-quantization/index.js';\nimport { KHRTextureBasisu } from './khr-texture-basisu/index.js';\nimport { KHRTextureTransform } from './khr-texture-transform/index.js';\nimport { KHRXMP } from './khr-xmp-json-ld/index.js';\n\nexport const KHRONOS_EXTENSIONS: (typeof Extension)[] = [\n\tKHRDracoMeshCompression,\n\tKHRLightsPunctual,\n\tKHRMaterialsAnisotropy,\n\tKHRMaterialsClearcoat,\n\tKHRMaterialsDiffuseTransmission,\n\tKHRMaterialsDispersion,\n\tKHRMaterialsEmissiveStrength,\n\tKHRMaterialsIOR,\n\tKHRMaterialsIridescence,\n\tKHRMaterialsPBRSpecularGlossiness,\n\tKHRMaterialsSpecular,\n\tKHRMaterialsSheen,\n\tKHRMaterialsTransmission,\n\tKHRMaterialsUnlit,\n\tKHRMaterialsVariants,\n\tKHRMaterialsVolume,\n\tKHRMeshQuantization,\n\tKHRTextureBasisu,\n\tKHRTextureTransform,\n\tKHRXMP,\n];\n\nexport const ALL_EXTENSIONS: (typeof Extension)[] = [\n\tEXTMeshGPUInstancing,\n\tEXTMeshoptCompression,\n\tEXTTextureAVIF,\n\tEXTTextureWebP,\n\t...KHRONOS_EXTENSIONS,\n];\n\nexport * from './ext-mesh-gpu-instancing/index.js';\nexport * from './ext-meshopt-compression/index.js';\nexport * from './ext-texture-avif/index.js';\nexport * from './ext-texture-webp/index.js';\nexport * from './khr-draco-mesh-compression/index.js';\nexport * from './khr-lights-punctual/index.js';\nexport * from './khr-materials-anisotropy/index.js';\nexport * from './khr-materials-clearcoat/index.js';\nexport * from './khr-materials-diffuse-transmission/index.js';\nexport * from './khr-materials-dispersion/index.js';\nexport * from './khr-materials-emissive-strength/index.js';\nexport * from './khr-materials-ior/index.js';\nexport * from './khr-materials-iridescence/index.js';\nexport * from './khr-materials-pbr-specular-glossiness/index.js';\nexport * from './khr-materials-sheen/index.js';\nexport * from './khr-materials-specular/index.js';\nexport * from './khr-materials-transmission/index.js';\nexport * from './khr-materials-unlit/index.js';\nexport * from './khr-materials-variants/index.js';\nexport * from './khr-materials-volume/index.js';\nexport * from './khr-mesh-quantization/index.js';\nexport * from './khr-texture-basisu/index.js';\nexport * from './khr-texture-transform/index.js';\nexport * from './khr-xmp-json-ld/index.js';\n"],
  "mappings": "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",
  "names": ["KHR_SUPERCOMPRESSION_NONE", "KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT", "KHR_DF_VENDORID_KHRONOS", "KHR_DF_VERSION", "KHR_DF_MODEL_UNSPECIFIED", "KHR_DF_MODEL_ETC1S", "KHR_DF_MODEL_UASTC", "KHR_DF_FLAG_ALPHA_STRAIGHT", "KHR_DF_TRANSFER_SRGB", "KHR_DF_PRIMARIES_BT709", "KHR_DF_SAMPLE_DATATYPE_SIGNED", "VK_FORMAT_UNDEFINED", "createDefaultContainer", "vkFormat", "VK_FORMAT_UNDEFINED", "typeSize", "pixelWidth", "pixelHeight", "pixelDepth", "layerCount", "faceCount", "levelCount", "supercompressionScheme", "KHR_SUPERCOMPRESSION_NONE", "levels", "dataFormatDescriptor", "vendorId", "KHR_DF_VENDORID_KHRONOS", "descriptorType", "KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT", "versionNumber", "KHR_DF_VERSION", "colorModel", "KHR_DF_MODEL_UNSPECIFIED", "colorPrimaries", "KHR_DF_PRIMARIES_BT709", "transferFunction", "KHR_DF_TRANSFER_SRGB", "flags", "KHR_DF_FLAG_ALPHA_STRAIGHT", "texelBlockDimension", "bytesPlane", "samples", "keyValue", "globalData", "BufferReader", "constructor", "data", "byteOffset", "byteLength", "littleEndian", "_dataView", "_littleEndian", "_offset", "DataView", "buffer", "_nextUint8", "value", "getUint8", "_nextUint16", "getUint16", "_nextUint32", "getUint32", "_nextUint64", "left", "right", "_nextInt32", "getInt32", "_nextUint8Array", "len", "Uint8Array", "_skip", "bytes", "_scan", "maxByteLength", "term", "NUL", "Uint8Array", "KTX2_ID", "decodeText", "buffer", "TextDecoder", "decode", "read", "data", "id", "Uint8Array", "buffer", "byteOffset", "KTX2_ID", "length", "Error", "container", "createDefaultContainer", "headerByteLength", "Uint32Array", "BYTES_PER_ELEMENT", "headerReader", "BufferReader", "vkFormat", "_nextUint32", "typeSize", "pixelWidth", "pixelHeight", "pixelDepth", "layerCount", "faceCount", "levelCount", "supercompressionScheme", "dfdByteOffset", "dfdByteLength", "kvdByteOffset", "kvdByteLength", "sgdByteOffset", "_nextUint64", "sgdByteLength", "levelByteLength", "Math", "max", "levelReader", "i", "il", "levels", "push", "levelData", "uncompressedByteLength", "dfdReader", "_skip", "vendorId", "_nextUint16", "descriptorType", "versionNumber", "descriptorBlockSize", "colorModel", "_nextUint8", "colorPrimaries", "transferFunction", "flags", "texelBlockDimension", "bytesPlane", "samples", "dfd", "sampleStart", "sampleWords", "numSamples", "sample", "bitOffset", "bitLength", "channelType", "samplePosition", "sampleLower", "Number", "NEGATIVE_INFINITY", "sampleUpper", "POSITIVE_INFINITY", "KHR_DF_SAMPLE_DATATYPE_SIGNED", "_nextInt32", "dataFormatDescriptor", "kvdReader", "_offset", "keyValueByteLength", "keyData", "_scan", "key", "decodeText", "keyValue", "_nextUint8Array", "byteLength", "match", "text", "substring", "lastIndexOf", "kvPadding", "sgdReader", "endpointCount", "selectorCount", "endpointsByteLength", "selectorsByteLength", "tablesByteLength", "extendedByteLength", "imageDescs", "imageFlags", "rgbSliceByteOffset", "rgbSliceByteLength", "alphaSliceByteOffset", "alphaSliceByteLength", "endpointsByteOffset", "selectorsByteOffset", "tablesByteOffset", "extendedByteOffset", "endpointsData", "selectorsData", "tablesData", "extendedData", "globalData", "EXT_MESH_GPU_INSTANCING", "EXT_MESHOPT_COMPRESSION", "EXT_TEXTURE_WEBP", "EXT_TEXTURE_AVIF", "KHR_DRACO_MESH_COMPRESSION", "KHR_LIGHTS_PUNCTUAL", "KHR_MATERIALS_ANISOTROPY", "KHR_MATERIALS_CLEARCOAT", "KHR_MATERIALS_DIFFUSE_TRANSMISSION", "KHR_MATERIALS_DISPERSION", "KHR_MATERIALS_EMISSIVE_STRENGTH", "KHR_MATERIALS_IOR", "KHR_MATERIALS_IRIDESCENCE", "KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS", "KHR_MATERIALS_SHEEN", "KHR_MATERIALS_SPECULAR", "KHR_MATERIALS_TRANSMISSION", "KHR_MATERIALS_UNLIT", "KHR_MATERIALS_VOLUME", "KHR_MATERIALS_VARIANTS", "KHR_MESH_QUANTIZATION", "KHR_TEXTURE_BASISU", "KHR_TEXTURE_TRANSFORM", "KHR_XMP_JSON_LD", "INSTANCE_ATTRIBUTE", "InstancedMesh", "ExtensionProperty", "init", "extensionName", "propertyType", "parentTypes", "PropertyType", "NODE", "getDefaults", "Object", "assign", "attributes", "RefMap", "getAttribute", "semantic", "getRefMap", "setAttribute", "accessor", "setRefMap", "usage", "listAttributes", "listRefMapValues", "listSemantics", "listRefMapKeys", "EXTENSION_NAME", "EXTMeshGPUInstancing", "Extension", "constructor", "args", "provideTypes", "prewriteTypes", "ACCESSOR", "createInstancedMesh", "document", "getGraph", "read", "context", "jsonDoc", "nodeDefs", "json", "nodes", "forEach", "nodeDef", "nodeIndex", "extensions", "instancedMeshDef", "instancedMesh", "accessors", "setExtension", "prewrite", "accessorUsageGroupedByParent", "add", "prop", "properties", "attribute", "addAccessorToUsageGroup", "write", "getRoot", "listNodes", "node", "getExtension", "nodeIndexMap", "get", "accessorIndexMap", "EncoderMethod", "MeshoptMode", "MeshoptFilter", "isFallbackBuffer", "bufferDef", "fallbackDef", "fallback", "BYTE", "SHORT", "FLOAT", "Accessor", "ComponentType", "encodeNormalizedInt", "decodeNormalizedInt", "MathUtils", "prepareAccessor", "encoder", "mode", "filterOptions", "filter", "bits", "result", "array", "getArray", "byteStride", "getElementSize", "getComponentSize", "componentType", "getComponentType", "normalized", "getNormalized", "ATTRIBUTES", "NONE", "decodeNormalizedIntArray", "Float32Array", "EXPONENTIAL", "encodeFilterExp", "getCount", "OCTAHEDRAL", "padNormals", "encodeFilterOct", "QUATERNION", "encodeFilterQuat", "Error", "min", "getMin", "max", "getMax", "map", "v", "padArrayElements", "byteLength", "srcArray", "dstArray", "length", "i", "elementSize", "BufferUtils", "padNumber", "BYTES_PER_ELEMENT", "elementStride", "elementCount", "j", "il", "getMeshoptMode", "WriterContext", "BufferViewUsage", "ELEMENT_ARRAY_BUFFER", "isTriangles", "listParents", "some", "parent", "Primitive", "getMode", "Mode", "TRIANGLES", "INDICES", "getMeshoptFilter", "doc", "refs", "listParentEdges", "edge", "getParent", "Root", "ref", "refName", "getName", "refKey", "getAttributes", "key", "isDelta", "PRIMITIVE_TARGET", "startsWith", "targetPath", "getTargetPath", "sampler", "AnimationSampler", "channel", "AnimationChannel", "DEFAULT_ENCODER_OPTIONS", "method", "QUANTIZE", "EXTMeshoptCompression", "prereadTypes", "BUFFER", "PRIMITIVE", "readDependencies", "writeDependencies", "_decoder", "_decoderFallbackBufferMap", "Map", "_encoder", "_encoderOptions", "_encoderFallbackBuffer", "_encoderBufferViews", "_encoderBufferViewData", "_encoderBufferViewAccessors", "install", "dependency", "setEncoderOptions", "options", "_extends", "preread", "isRequired", "supported", "_prereadBuffers", "_prereadPrimitives", "viewDefs", "bufferViews", "viewDef", "index", "meshoptDef", "byteOffset", "count", "stride", "Uint8Array", "buffers", "buffer", "resource", "uri", "resources", "GLB_BUFFER", "source", "toView", "decodeGltfBuffer", "fallbackBuffer", "fallbackBufferDef", "set", "_context", "swap", "dispose", "_prewriteAccessors", "_prewriteBuffers", "graph", "createBuffer", "fallbackBufferIndex", "listBuffers", "indexOf", "nextID", "parentToID", "getParentID", "property", "ROOT", "id", "undefined", "listAccessors", "getSparse", "getAccessorUsage", "parentID", "has", "FILTER", "preparedAccessor", "getBuffer", "bufferIndex", "join", "bufferView", "bufferViewData", "bufferViewAccessors", "target", "USAGE_TO_TARGET", "ARRAY_BUFFER", "accessorDef", "createAccessorDef", "push", "EXT_meshopt_compression", "otherBufferViews", "concat", "encodeGltfBuffer", "compressedData", "pad", "fallbackBufferByteOffset", "bufferViewIndex", "otherBufferViewsIndexMap", "finalBufferViewDef", "compressedByteOffset", "bufferViewExtensionDef", "bufferIndexMap", "AVIFImageUtils", "match", "decodeText", "slice", "getSize", "view", "DataView", "box", "unbox", "offset", "end", "type", "start", "getUint32", "getChannels", "_buffer", "EXTTextureAVIF", "TEXTURE", "register", "ImageUtils", "registerFormat", "textureDefs", "textures", "textureDef", "listTextures", "texture", "getMimeType", "imageIndex", "imageIndexMap", "data", "size", "WEBPImageUtils", "RIFF", "WEBP", "chunkId", "getUint8", "chunkByteLength", "width", "getInt16", "height", "b0", "b1", "b2", "b3", "EXTTextureWebP", "decoderModule", "COMPONENT_ARRAY", "DATA_TYPE", "decodeGeometry", "decoder", "DecoderBuffer", "Init", "geometryType", "GetEncodedGeometryType", "TRIANGULAR_MESH", "dracoMesh", "Mesh", "status", "DecodeBufferToMesh", "ok", "ptr", "destroy", "decodeIndex", "mesh", "numFaces", "num_faces", "numIndices", "indices", "num_points", "Uint16Array", "_malloc", "GetTrianglesUInt16Array", "HEAPU16", "Uint32Array", "GetTrianglesUInt32Array", "HEAPU32", "_free", "decodeAttribute", "dataType", "ArrayCtor", "numComponents", "num_components", "numPoints", "numValues", "GetAttributeDataArrayForAllPoints", "HEAPF32", "initDecoderModule", "_decoderModule", "UNSIGNED_INT", "UNSIGNED_SHORT", "UNSIGNED_BYTE", "Int16Array", "Int8Array", "DT_FLOAT32", "DT_UINT32", "DT_UINT16", "DT_UINT8", "DT_INT16", "DT_INT8", "encoderModule", "AttributeEnum", "DEFAULT_QUANTIZATION_BITS", "POSITION", "NORMAL", "COLOR", "TEX_COORD", "GENERIC", "decodeSpeed", "encodeSpeed", "EDGEBREAKER", "quantizationBits", "quantizationVolume", "initEncoderModule", "_encoderModule", "encodeGeometry", "prim", "_options", "builder", "MeshBuilder", "ExpertEncoder", "attributeIDs", "dracoBuffer", "DracoInt8Array", "hasMorphTargets", "listTargets", "hasSparseAttributes", "attributeEnum", "getAttributeEnum", "attributeID", "addAttribute", "SetAttributeQuantization", "range", "Math", "SetAttributeExplicitQuantization", "getIndices", "EncodingError", "AddFacesToMesh", "SetSpeedOptions", "SetTrackEncodedProperties", "SEQUENTIAL", "SetEncodingMethod", "MESH_SEQUENTIAL_ENCODING", "MESH_EDGEBREAKER_ENCODING", "EncodeToDracoBuffer", "GetValue", "numVertices", "GetNumberOfEncodedPoints", "GetNumberOfEncodedFaces", "itemSize", "AddUInt8Attribute", "AddInt8Attribute", "AddUInt16Attribute", "AddInt16Attribute", "AddUInt32Attribute", "AddFloatAttribute", "KHRDracoMeshCompression", "logger", "getLogger", "dracoMeshes", "meshDefs", "meshes", "meshDef", "primDef", "primitives", "dracoDef", "bufferViewDef", "Decoder", "debug", "dracoAttribute", "GetAttributeByUniqueId", "attributeArray", "setArray", "Array", "from", "values", "_propertyType", "JSON", "stringify", "primitiveHashMap", "listDracoPrimitives", "primitiveEncodingMap", "listScenes", "warn", "getBounds", "pop", "keys", "primHash", "accessorDefs", "encodedPrim", "e", "message", "indicesDef", "attributeDef", "extensionData", "dracoContext", "listMeshes", "meshIndexMap", "listPrimitives", "extensionsUsed", "name", "extensionsRequired", "included", "Set", "excluded", "nonIndexed", "nonTriangles", "accessorIndices", "includedAccessors", "includedHashKeys", "primToHashKey", "hashKey", "createHashKey", "dstIndices", "clone", "dstAttribute", "attr", "indexMap", "hashElements", "sort", "Light", "color", "intensity", "Type", "POINT", "innerConeAngle", "outerConeAngle", "PI", "getColor", "setColor", "getIntensity", "setIntensity", "getType", "setType", "getRange", "setRange", "getInnerConeAngle", "setInnerConeAngle", "angle", "getOuterConeAngle", "setOuterConeAngle", "SPOT", "DIRECTIONAL", "KHRLightsPunctual", "createLight", "rootDef", "lightDefs", "lights", "lightDef", "_lightDef$spot", "_lightDef$spot2", "light", "setName", "spot", "lightNodeDef", "lightIndexMap", "eq", "R", "G", "B", "TextureChannel", "Anisotropy", "MATERIAL", "anisotropyStrength", "anisotropyRotation", "anisotropyTexture", "anisotropyTextureInfo", "TextureInfo", "getAnisotropyStrength", "setAnisotropyStrength", "strength", "getAnisotropyRotation", "setAnisotropyRotation", "rotation", "getAnisotropyTexture", "getRef", "getAnisotropyTextureInfo", "setAnisotropyTexture", "setRef", "channels", "KHRMaterialsAnisotropy", "MESH", "createAnisotropy", "materialDefs", "materials", "materialDef", "materialIndex", "anisotropy", "anisotropyDef", "textureInfoDef", "setTextureInfo", "listMaterials", "material", "materialIndexMap", "textureInfo", "createTextureInfoDef", "Clearcoat", "clearcoatFactor", "clearcoatTexture", "clearcoatTextureInfo", "clearcoatRoughnessFactor", "clearcoatRoughnessTexture", "clearcoatRoughnessTextureInfo", "clearcoatNormalScale", "clearcoatNormalTexture", "clearcoatNormalTextureInfo", "getClearcoatFactor", "setClearcoatFactor", "factor", "getClearcoatTexture", "getClearcoatTextureInfo", "setClearcoatTexture", "getClearcoatRoughnessFactor", "setClearcoatRoughnessFactor", "getClearcoatRoughnessTexture", "getClearcoatRoughnessTextureInfo", "setClearcoatRoughnessTexture", "getClearcoatNormalScale", "setClearcoatNormalScale", "scale", "getClearcoatNormalTexture", "getClearcoatNormalTextureInfo", "setClearcoatNormalTexture", "KHRMaterialsClearcoat", "createClearcoat", "clearcoat", "clearcoatDef", "A", "DiffuseTransmission", "diffuseTransmissionFactor", "diffuseTransmissionTexture", "diffuseTransmissionTextureInfo", "diffuseTransmissionColorFactor", "diffuseTransmissionColorTexture", "diffuseTransmissionColorTextureInfo", "getDiffuseTransmissionFactor", "setDiffuseTransmissionFactor", "getDiffuseTransmissionTexture", "getDiffuseTransmissionTextureInfo", "setDiffuseTransmissionTexture", "getDiffuseTransmissionColorFactor", "setDiffuseTransmissionColorFactor", "getDiffuseTransmissionColorTexture", "getDiffuseTransmissionColorTextureInfo", "setDiffuseTransmissionColorTexture", "KHRMaterialsDiffuseTransmission", "createDiffuseTransmission", "transmission", "transmissionDef", "Dispersion", "dispersion", "getDispersion", "setDispersion", "KHRMaterialsDispersion", "createDispersion", "dispersionDef", "EmissiveStrength", "emissiveStrength", "getEmissiveStrength", "setEmissiveStrength", "KHRMaterialsEmissiveStrength", "createEmissiveStrength", "emissiveStrengthDef", "IOR", "ior", "getIOR", "setIOR", "KHRMaterialsIOR", "createIOR", "iorDef", "Iridescence", "iridescenceFactor", "iridescenceTexture", "iridescenceTextureInfo", "iridescenceIOR", "iridescenceThicknessMinimum", "iridescenceThicknessMaximum", "iridescenceThicknessTexture", "iridescenceThicknessTextureInfo", "getIridescenceFactor", "setIridescenceFactor", "getIridescenceTexture", "getIridescenceTextureInfo", "setIridescenceTexture", "getIridescenceIOR", "setIridescenceIOR", "getIridescenceThicknessMinimum", "setIridescenceThicknessMinimum", "thickness", "getIridescenceThicknessMaximum", "setIridescenceThicknessMaximum", "getIridescenceThicknessTexture", "getIridescenceThicknessTextureInfo", "setIridescenceThicknessTexture", "KHRMaterialsIridescence", "createIridescence", "iridescence", "iridescenceDef", "iridescenceIor", "PBRSpecularGlossiness", "diffuseFactor", "diffuseTexture", "diffuseTextureInfo", "specularFactor", "glossinessFactor", "specularGlossinessTexture", "specularGlossinessTextureInfo", "getDiffuseFactor", "setDiffuseFactor", "getDiffuseTexture", "getDiffuseTextureInfo", "setDiffuseTexture", "isColor", "getSpecularFactor", "setSpecularFactor", "getGlossinessFactor", "setGlossinessFactor", "getSpecularGlossinessTexture", "getSpecularGlossinessTextureInfo", "setSpecularGlossinessTexture", "KHRMaterialsPBRSpecularGlossiness", "createPBRSpecularGlossiness", "specGloss", "specGlossDef", "Sheen", "sheenColorFactor", "sheenColorTexture", "sheenColorTextureInfo", "sheenRoughnessFactor", "sheenRoughnessTexture", "sheenRoughnessTextureInfo", "getSheenColorFactor", "setSheenColorFactor", "getSheenColorTexture", "getSheenColorTextureInfo", "setSheenColorTexture", "getSheenRoughnessFactor", "setSheenRoughnessFactor", "getSheenRoughnessTexture", "getSheenRoughnessTextureInfo", "setSheenRoughnessTexture", "KHRMaterialsSheen", "createSheen", "sheen", "sheenDef", "Specular", "specularTexture", "specularTextureInfo", "specularColorFactor", "specularColorTexture", "specularColorTextureInfo", "getSpecularColorFactor", "setSpecularColorFactor", "getSpecularTexture", "getSpecularTextureInfo", "setSpecularTexture", "getSpecularColorTexture", "getSpecularColorTextureInfo", "setSpecularColorTexture", "KHRMaterialsSpecular", "createSpecular", "specular", "specularDef", "Transmission", "transmissionFactor", "transmissionTexture", "transmissionTextureInfo", "getTransmissionFactor", "setTransmissionFactor", "getTransmissionTexture", "getTransmissionTextureInfo", "setTransmissionTexture", "KHRMaterialsTransmission", "createTransmission", "Unlit", "KHRMaterialsUnlit", "createUnlit", "Mapping", "variants", "RefSet", "getMaterial", "setMaterial", "addVariant", "variant", "addRef", "removeVariant", "removeRef", "listVariants", "listRefs", "MappingList", "mappings", "addMapping", "mapping", "removeMapping", "listMappings", "Variant", "KHRMaterialsVariants", "createMappingList", "createVariant", "createMapping", "variantsRootDef", "variantDefs", "variantDef", "meshIndex", "primDefs", "primIndex", "mappingList", "variantPrimDef", "mappingDef", "variantIndex", "variantIndexMap", "createPropertyDef", "mappingDefs", "Volume", "thicknessFactor", "thicknessTexture", "thicknessTextureInfo", "attenuationDistance", "Infinity", "attenuationColor", "getThicknessFactor", "setThicknessFactor", "getThicknessTexture", "getThicknessTextureInfo", "setThicknessTexture", "getAttenuationDistance", "setAttenuationDistance", "distance", "getAttenuationColor", "setAttenuationColor", "KHRMaterialsVolume", "createVolume", "volume", "volumeDef", "Number", "isFinite", "KHRMeshQuantization", "_", "KTX2ImageUtils", "container", "readKTX", "pixelWidth", "pixelHeight", "dfd", "dataFormatDescriptor", "colorModel", "KHR_DF_MODEL_ETC1S", "samples", "channelType", "KHR_DF_MODEL_UASTC", "getVRAMByteLength", "hasAlpha", "uncompressedBytes", "levels", "level", "uncompressedByteLength", "levelWidth", "floor", "pow", "levelHeight", "blockSize", "KHRTextureBasisu", "basisuDef", "Transform", "TEXTURE_INFO", "texCoord", "getOffset", "setOffset", "getRotation", "setRotation", "getScale", "setScale", "getTexCoord", "setTexCoord", "KHRTextureTransform", "createTransform", "textureInfos", "entries", "transform", "transformDef", "textureInfoEntries", "textureInfoDefMap", "PARENT_TYPES", "SCENE", "ANIMATION", "Packet", "getContext", "setContext", "listProperties", "getProperty", "setProperty", "value", "_assertContext", "toJSONLD", "copyJSON", "fromJSONLD", "jsonld", "prefix", "split", "object", "parse", "KHRXMP", "createPacket", "listPackets", "_context$jsonDoc$json", "extensionDef", "packets", "root", "packetDef", "defLists", "asset", "scenes", "images", "animations", "propertyLists", "listAnimations", "defs", "def", "xmpDef", "packet", "packetDefs", "parentDef", "sceneIndexMap", "animationIndexMap", "KHRONOS_EXTENSIONS", "ALL_EXTENSIONS"]
}
